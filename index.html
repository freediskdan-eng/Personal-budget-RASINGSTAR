<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–õ–∏—á–Ω—ã–π –ë—é–¥–∂–µ—Ç</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Chart.js –¥–ª—è –¥–∏–∞–≥—Ä–∞–º–º -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Font Awesome –¥–ª—è –∏–∫–æ–Ω–æ–∫ –∫–∞—Ç–µ–≥–æ—Ä–∏–π (–º–æ–∂–Ω–æ –∑–∞–º–µ–Ω–∏—Ç—å –Ω–∞ Heroicons –∏–ª–∏ –¥—Ä—É–≥–∏–µ) -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">

    <style>
        body {
            overflow-x: hidden;
            /* –£–±–µ–¥–∏–º—Å—è, —á—Ç–æ –≤—ã–¥–µ–ª–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç */
            -webkit-user-select: auto;
            -moz-user-select: auto;
            -ms-user-select: auto;
            user-select: auto;
        }
        
        ::selection { color: white; background-color: #7c3aed; }  

        html { scroll-behavior: smooth; }
        
        /* –û–±—â–∏–µ —Å—Ç–∏–ª–∏ –¥–ª—è —Å—Å—ã–ª–æ–∫ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ */
        .nav-link, .nav-link-mobile {
            word-wrap: break-word; /* –ü–æ–∑–≤–æ–ª—è–µ—Ç –¥–ª–∏–Ω–Ω—ã–º —Å–ª–æ–≤–∞–º –ø–µ—Ä–µ–Ω–æ—Å–∏—Ç—å—Å—è */
            overflow-wrap: break-word; /* –°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π –∞–Ω–∞–ª–æ–≥ */
        }
        /* –ö–ª–∞—Å—Å active –¥–ª—è –≤—ã–±—Ä–∞–Ω–Ω–æ–π —Å—Å—ã–ª–∫–∏ */
        .nav-link.active, .nav-link-mobile.active { background-color: #7c3aed; color: white; } /* bg-violet-600 */
        /* –ö–ª–∞—Å—Å active-parent –¥–ª—è —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–π —Å—Å—ã–ª–∫–∏ –≤—ã–ø–∞–¥–∞—é—â–µ–≥–æ –º–µ–Ω—é, –∫–æ–≥–¥–∞ –æ–¥–∏–Ω –∏–∑ –µ—ë –¥–æ—á–µ—Ä–Ω–∏—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –∞–∫—Ç–∏–≤–µ–Ω –∏–ª–∏ —Å–∞–º–æ –º–µ–Ω—é –æ—Ç–∫—Ä—ã—Ç–æ */
        .nav-link.active-parent, .nav-link-mobile.active-parent { background-color: #5b21b6; color: white; } /* bg-violet-700 */

        /* –î–ª—è –∫–Ω–æ–ø–æ–∫ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –≥—Ä–∞—Ñ–∏–∫–æ–≤ */
        .chart-toggle-btn.active, .chart-toggle-type-btn.active { background-color: #7c3aed; color: white; } /* bg-violet-600 */

        /* –°—Ç–∏–ª—å –¥–ª—è –∞–∫—Ç–∏–≤–Ω–æ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è –∫–Ω–æ–ø–∫–∏ "–°–±—Ä–æ—Å–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä" –ø—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏–∏ */
        .clear-filter-btn:hover {
            color: #ef4444; /* –ö—Ä–∞—Å–Ω—ã–π —Ü–≤–µ—Ç –ø—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏–∏ */
        }
        /* –°—Ç–∏–ª–∏ –¥–ª—è –ø—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä–∞ */
        .budget-progress-bar, .saving-goal-progress-bar {
            background-color: #e5e7eb; /* gray-200 */
            border-radius: 9999px; /* rounded-full */
            height: 8px; /* h-2 */
            overflow: hidden;
        }
        .budget-progress-fill, .saving-goal-progress-fill {
            height: 100%;
            border-radius: 9999px;
            transition: width 0.3s ease-in-out, background-color 0.3s ease-in-out;
        }

        /* –ö–∞—Å—Ç–æ–º–Ω—ã–π —Å–∫—Ä–æ–ª–ª–±–∞—Ä –¥–ª—è –≤—Å–µ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã –∏ –º–æ–¥–∞–ª—å–Ω—ã—Ö –æ–∫–æ–Ω */
        ::-webkit-scrollbar {
            width: 10px;
        }
        ::-webkit-scrollbar-track {
            background: #f1f5f9; /* slate-100 */
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb {
            background: #7c3aed; /* violet-600 */
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #6d28d9; /* violet-700 */
        }

        /* Dropdown specific styles */
        .nav-dropdown-content {
            max-height: 0;
            opacity: 0;
            overflow: hidden;
            transition: max-height 0.3s ease-out, opacity 0.3s ease-out;
        }
        .nav-dropdown-content.open { /* –î–ª—è –º–æ–±–∏–ª—å–Ω–æ–≥–æ –º–µ–Ω—é –ø–æ –∫–ª–∏–∫—É */
            max-height: 200px; /* –î–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –±–æ–ª—å—à–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ */
            opacity: 1;
        }
        .nav-dropdown-content a { /* –ü—Ä–∏–º–µ–Ω—è–µ–º –∫ –ø–æ–¥—Å—Å—ã–ª–∫–∞–º –≤–Ω—É—Ç—Ä–∏ –¥—Ä–æ–ø–¥–∞—É–Ω–∞ */
            display: block; /* –î–µ–ª–∞–µ—Ç –∏—Ö –±–ª–æ—á–Ω—ã–º–∏ –¥–ª—è –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–æ–≥–æ —Å—Ç–µ–∫–∞ */
            /* padding-left: 1rem; */ /* –û—Ç—Å—Ç—É–ø –¥–ª—è –ø–æ–¥–ø—É–Ω–∫—Ç–æ–≤ - —Ç–µ–ø–µ—Ä—å –∑–∞–¥–∞–µ–º –≤ HTML —á–µ—Ä–µ–∑ ml-4 */
        }

        /* –ê–Ω–∏–º–∞—Ü–∏—è —à–µ–≤—Ä–æ–Ω–∞ –¥–ª—è –≤—Å–µ—Ö –¥—Ä–æ–ø–¥–∞—É–Ω–æ–≤ */
        .fas.fa-chevron-down {
            transition: transform 0.3s ease-out;
        }
        /* –ü–æ–≤–æ—Ä–æ—Ç —à–µ–≤—Ä–æ–Ω–∞, –∫–æ–≥–¥–∞ –¥—Ä–æ–ø–¥–∞—É–Ω –æ—Ç–∫—Ä—ã—Ç (–¥–ª—è –¥–µ—Å–∫—Ç–æ–ø–∞ –ø–æ —Ö–æ–≤–µ—Ä—É, –¥–ª—è –º–æ–±–∏–ª—å–Ω–æ–≥–æ –ø–æ –∫–ª–∏–∫—É) */
        .nav-dropdown-toggle:hover > a .fas.fa-chevron-down,
        .nav-dropdown-toggle-mobile > a.dropdown-expanded .fas.fa-chevron-down {
            transform: rotate(180deg);
        }

        /* –î–µ—Å–∫—Ç–æ–ø–Ω—ã–π –¥—Ä–æ–ø–¥–∞—É–Ω: –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏–∏ */
        .nav-dropdown-toggle:hover > .nav-dropdown-content {
            max-height: 200px; /* –î–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –±–æ–ª—å—à–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ */
            opacity: 1;
        }
        /* –ú–æ–±–∏–ª—å–Ω—ã–π –¥—Ä–æ–ø–¥–∞—É–Ω: –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è –ø–æ –∫–ª–∞—Å—Å—É dropdown-expanded –Ω–∞ —Å—Å—ã–ª–∫–µ */
        .nav-dropdown-toggle-mobile > a.dropdown-expanded + .nav-dropdown-content {
            max-height: 200px; /* –î–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –±–æ–ª—å—à–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ */
            opacity: 1;
        }
    </style>
</head>
<body class="bg-slate-100 text-slate-800 font-sans">

    <!-- –ú–æ–±–∏–ª—å–Ω–æ–µ –±–æ–∫–æ–≤–æ–µ –º–µ–Ω—é (—Å–∫—Ä—ã—Ç–æ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é) -->
    <div id="mobile-menu" class="fixed inset-y-0 left-0 z-50 w-64 bg-slate-800 text-white p-4 flex flex-col transform -translate-x-full transition-transform duration-300 ease-in-out">
        <div class="flex justify-between items-center mb-8">
            <h1 class="text-2xl font-bold text-violet-400">–õ–∏—á–Ω—ã–π –ë—é–¥–∂–µ—Ç</h1>
            <button id="close-mobile-menu-btn" class="text-white text-4xl leading-none font-light hover:text-violet-400 transition-colors">&times;</button>
        </div>
        <nav class="flex flex-col space-y-2 flex-grow">
            <!-- Dropdown for Dashboard - Mobile -->
            <div class="nav-dropdown-toggle-mobile">
                <a href="#dashboard" id="dashboard-toggle-mobile" class="nav-link-mobile p-3 rounded-md hover:bg-violet-600 transition-colors flex justify-between items-center">
                    <span>üìä –û–±–∑–æ—Ä</span>
                    <i class="fas fa-chevron-down text-xs"></i>
                </a>
                <div class="nav-dropdown-content space-y-2 mt-1 ml-4">
                    <!-- –ó–∞–º–µ–Ω–∏–ª id, —á—Ç–æ–±—ã —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–æ–≤–∞—Ç—å –Ω–æ–≤–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä–µ -->
                    <a href="#category-charts" class="nav-link-mobile block p-3 rounded-md hover:bg-violet-600 transition-colors text-slate-300 hover:text-white">üìà –ê–Ω–∞–ª–∏—Ç–∏–∫–∞</a>
                    <a href="#budget-summary-section" class="nav-link-mobile block p-3 rounded-md hover:bg-violet-600 transition-colors text-slate-300 hover:text-white">üí∞ –ë—é–¥–∂–µ—Ç –Ω–∞ –º–µ—Å—è—Ü</a>
                    <a href="#saving-goals-summary-section" class="nav-link-mobile block p-3 rounded-md hover:bg-violet-600 transition-colors text-slate-300 hover:text-white">üéØ –¶–µ–ª–∏ –Ω–∞–∫–æ–ø–ª–µ–Ω–∏—è</a>
                </div>
            </div>
            <!-- End Dropdown -->
            <a href="#transactions" class="nav-link-mobile p-3 rounded-md hover:bg-violet-600 transition-colors">üìã –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏</a>
            <a href="#settings" class="nav-link-mobile p-3 rounded-md hover:bg-violet-600 transition-colors">‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏</a>
        </nav>
    </div>

    <!-- –û–≤–µ—Ä–ª–µ–π –¥–ª—è –º–æ–±–∏–ª—å–Ω–æ–≥–æ –º–µ–Ω—é (—Å–∫—Ä—ã—Ç–æ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é) -->
    <div id="mobile-menu-overlay" class="fixed inset-0 bg-black/50 z-40 hidden transition-opacity duration-300 opacity-0"></div>

    <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –¥–ª—è —ç—Ñ—Ñ–µ–∫—Ç–∞ —Ä–∞–∑–º—ã—Ç–∏—è -->
    <div id="app-container" class="flex min-h-screen">
        <!-- –ë–æ–∫–æ–≤–∞—è –ø–∞–Ω–µ–ª—å –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ –¥–ª—è –¥–µ—Å–∫—Ç–æ–ø–∞ -->
        <aside class="fixed inset-y-0 left-0 w-64 bg-slate-800 text-white p-4 flex-shrink-0 hidden md:flex flex-col h-screen z-40">
            <div class="flex items-center gap-2 mb-8">
                <img src="logo.jpg" alt="–õ–æ–≥–æ—Ç–∏–ø" class="h-20 w-20 rounded-full">
                <h1 class="text-2xl font-bold text-violet-400">–õ–∏—á–Ω—ã–π –ë—é–¥–∂–µ—Ç</h1>
            </div>
            <nav class="flex flex-col space-y-2 flex-grow">
                <!-- Dropdown for Dashboard - Desktop -->
                <div class="nav-dropdown-toggle">
                    <a href="#dashboard" id="dashboard-toggle-desktop" class="nav-link p-3 rounded-md hover:bg-violet-600 transition-colors flex justify-between items-center">
                        <span>üìä –û–±–∑–æ—Ä</span>
                        <i class="fas fa-chevron-down text-xs"></i>
                    </a>
                    <div class="nav-dropdown-content space-y-2 mt-1 ml-4">
                        <!-- –ó–∞–º–µ–Ω–∏–ª id, —á—Ç–æ–±—ã —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–æ–≤–∞—Ç—å –Ω–æ–≤–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä–µ -->
                        <a href="#category-charts" class="nav-link block p-3 rounded-md hover:bg-violet-600 transition-colors text-slate-300 hover:text-white">üìà –ê–Ω–∞–ª–∏—Ç–∏–∫–∞</a>
                        <a href="#budget-summary-section" class="nav-link block p-3 rounded-md hover:bg-violet-600 transition-colors text-slate-300 hover:text-white">üí∞ –ë—é–¥–∂–µ—Ç –Ω–∞ –º–µ—Å—è—Ü</a>
                        <a href="#saving-goals-summary-section" class="nav-link block p-3 rounded-md hover:bg-violet-600 transition-colors text-slate-300 hover:text-white">üéØ –¶–µ–ª–∏ –Ω–∞–∫–æ–ø–ª–µ–Ω–∏—è</a>
                    </div>
                </div>
                <!-- End Dropdown -->
                <a href="#transactions" class="nav-link p-3 rounded-md hover:bg-violet-600 transition-colors">üìã –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏</a>
                <a href="#settings" class="nav-link p-3 rounded-md hover:bg-violet-600 transition-colors">‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏</a>
            </nav>
            <div class="mt-auto pt-4 border-t border-slate-700 text-xs text-slate-400">
                <p class="font-semibold text-violet-300">–õ–∏—á–Ω—ã–π –ë—é–¥–∂–µ—Ç</p>
                <p>–í–µ—Ä—Å–∏—è: v0.0.1</p>
                <p>&copy; 2025</p>
                <p>–†–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫: <a href="https://vk.com/rasingstar" target="_blank" class="text-violet-400 hover:underline">–î–∞–Ω–∏–ª –¢—ë—Ç—É—à–∫–∏–Ω</a></p>
            </div>
        </aside>

        <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç -->
        <!-- pt-20 –∫–æ–º–ø–µ–Ω—Å–∏—Ä—É–µ—Ç –≤—ã—Å–æ—Ç—É —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –∑–∞–≥–æ–ª–æ–≤–∫–∞ –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö, md:ml-64 —Å–¥–≤–∏–≥–∞–µ—Ç –∫–æ–Ω—Ç–µ–Ω—Ç –æ—Ç —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ —Å–∞–π–¥–±–∞—Ä–∞ -->
        <main class="flex-1 p-4 sm:p-6 lg:p-8 pt-20 md:ml-64">
            <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö —Å –∫–Ω–æ–ø–∫–æ–π –≥–∞–º–±—É—Ä–≥–µ—Ä–∞ -->
            <header id="mobile-header" class="md:hidden flex items-center justify-between p-4 bg-white shadow-md rounded-b-lg fixed top-0 left-0 w-full z-40 transition-transform duration-300 ease-out">
                <button id="open-mobile-menu-btn" class="text-slate-700 text-3xl leading-none hover:text-violet-600 transition-colors">‚ò∞</button>
                <!-- –õ–æ–≥–æ—Ç–∏–ø –∏ –∑–∞–≥–æ–ª–æ–≤–æ–∫ -->
                <div class="flex items-center gap-2">
                    <img src="logo.jpg" alt="–õ–æ–≥–æ—Ç–∏–ø" class="h-8 w-8 rounded-full">
                    <h2 class="text-xl font-bold text-violet-600">–ë—é–¥–∂–µ—Ç</h2>
                </div>
                <div class="w-8"></div> <!-- –ó–∞–≥–ª—É—à–∫–∞ –¥–ª—è —Ü–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏—è –Ω–∞–∑–≤–∞–Ω–∏—è -->
            </header>

            <!-- –°–µ–∫—Ü–∏—è: –û–±–∑–æ—Ä (Dashboard) -->
            <section id="dashboard" class="mb-12">
                <h2 class="text-3xl font-bold mb-6">–û–±–∑–æ—Ä</h2>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                    <div class="bg-green-100 border-l-4 border-green-500 text-green-800 p-4 rounded-lg shadow">
                        <h3 class="font-bold">–û–±—â–∏–µ –¥–æ—Ö–æ–¥—ã</h3>
                        <p id="total-income" class="text-2xl font-semibold">0 ‚ÇΩ</p>
                    </div>
                    <div class="bg-red-100 border-l-4 border-red-500 text-red-800 p-4 rounded-lg shadow">
                        <h3 class="font-bold">–û–±—â–∏–µ —Ä–∞—Å—Ö–æ–¥—ã</h3>
                        <p id="total-expenses" class="text-2xl font-semibold">0 ‚ÇΩ</p>
                    </div>
                    <div class="bg-violet-100 border-l-4 border-violet-500 text-violet-800 p-4 rounded-lg shadow" id="total-balance-card">
                        <h3 class="font-bold">–û–±—â–∏–π –±–∞–ª–∞–Ω—Å</h3>
                        <p id="total-balance" class="text-2xl font-semibold">0 ‚ÇΩ</p>
                    </div>
                </div>

                <!-- –ë–∞–ª–∞–Ω—Å –ø–æ —Å—á–µ—Ç–∞–º -->
                <div class="bg-white p-6 rounded-lg shadow mb-8">
                    <h3 class="text-xl font-bold mb-4">–ë–∞–ª–∞–Ω—Å –ø–æ —Å—á–µ—Ç–∞–º</h3>
                    <div id="accounts-summary" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
                        <p class="text-gray-500">–î–æ–±–∞–≤—å—Ç–µ —Å—á–µ—Ç–∞ –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö.</p>
                    </div>
                </div>

                <!-- –¶–µ–ª–∏ –Ω–∞–∫–æ–ø–ª–µ–Ω–∏—è –Ω–∞ —Ç–µ–∫—É—â–∏–π –≥–æ–¥ -->
                <div id="saving-goals-summary-section" class="bg-white p-6 rounded-lg shadow mb-8">
                    <h3 class="text-xl font-bold mb-4">–¶–µ–ª–∏ –Ω–∞–∫–æ–ø–ª–µ–Ω–∏—è –Ω–∞ —Ç–µ–∫—É—â–∏–π –≥–æ–¥</h3>
                    <div id="saving-goals-summary-list" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                        <p class="text-gray-500">–î–æ–±–∞–≤—å—Ç–µ —Ü–µ–ª–∏ –Ω–∞–∫–æ–ø–ª–µ–Ω–∏—è –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö.</p>
                    </div>
                </div>

                <!-- –†–∞—Å—Ö–æ–¥—ã –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º (–¥–∏–∞–≥—Ä–∞–º–º–∞) - –û–±–Ω–æ–≤–ª–µ–Ω–Ω–∞—è —Å–µ–∫—Ü–∏—è –ê–Ω–∞–ª–∏—Ç–∏–∫–∏ -->
                <div id="category-charts" class="bg-white p-6 rounded-lg shadow mb-8">
                    <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-4 flex-wrap gap-2">
                        <h3 id="chart-section-title" class="text-xl font-bold">–§–∏–Ω–∞–Ω—Å–æ–≤–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞</h3>
                        <!-- –û—Å–Ω–æ–≤–Ω–æ–π –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å —Ç–∏–ø–æ–≤ –¥–∏–∞–≥—Ä–∞–º–º -->
                        <div class="flex flex-wrap gap-2 border border-slate-300 rounded-lg p-1">
                            <button id="show-pie-chart-btn" class="chart-toggle-type-btn active px-3 py-1 text-sm font-semibold rounded-md transition-colors">–ü–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º</button>
                            <button id="show-monthly-bar-chart-btn" class="chart-toggle-type-btn px-3 py-1 text-sm font-semibold rounded-md transition-colors">–ü–æ –º–µ—Å—è—Ü–∞–º</button>
                            <button id="show-balance-line-chart-btn" class="chart-toggle-type-btn px-3 py-1 text-sm font-semibold rounded-md transition-colors">–ë–∞–ª–∞–Ω—Å (–¥–∏–Ω–∞–º–∏–∫–∞)</button>
                            <button id="show-cumulative-area-chart-btn" class="chart-toggle-type-btn px-3 py-1 text-sm font-semibold rounded-md transition-colors">–ö—É–º—É–ª—è—Ç–∏–≤–Ω–æ</button>
                        </div>
                    </div>

                    <!-- –ü–æ–¥-–ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å –¥–ª—è –∫–∞—Ç–µ–≥–æ—Ä–∏–π–Ω—ã—Ö –¥–∏–∞–≥—Ä–∞–º–º (Pie/Bar), —Å–∫—Ä—ã—Ç –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é -->
                    <div id="category-sub-toggle" class="flex justify-center mb-4 flex-wrap gap-2">
                        <div class="flex border border-slate-300 rounded-lg p-1">
                            <button id="show-category-expense-btn" class="chart-toggle-btn active px-3 py-1 text-sm font-semibold rounded-md transition-colors">–†–∞—Å—Ö–æ–¥—ã</button>
                            <button id="show-category-income-btn" class="chart-toggle-btn px-3 py-1 text-sm font-semibold rounded-md transition-colors">–î–æ—Ö–æ–¥—ã</button>
                        </div>
                    </div>

                    <div class="relative h-96">
                         <canvas id="categoryPieChartCanvas" class="chart-canvas"></canvas>
                         <canvas id="monthlyBarChartCanvas" class="chart-canvas hidden"></canvas>
                         <canvas id="balanceLineChartCanvas" class="chart-canvas hidden"></canvas>
                         <canvas id="cumulativeAreaChartCanvas" class="chart-canvas hidden"></canvas>
                    </div>
                </div>

                <!-- –ë—é–¥–∂–µ—Ç –Ω–∞ —Ç–µ–∫—É—â–∏–π –º–µ—Å—è—Ü -->
                <div id="budget-summary-section" class="bg-white p-6 rounded-lg shadow">
                    <h3 class="text-xl font-bold mb-4">–ë—é–¥–∂–µ—Ç –Ω–∞ —Ç–µ–∫—É—â–∏–π –º–µ—Å—è—Ü</h3>
                    <div id="budget-summary-list" class="space-y-4">
                        <p class="text-gray-500">–î–æ–±–∞–≤—å—Ç–µ –±—é–¥–∂–µ—Ç—ã –∫ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º —Ä–∞—Å—Ö–æ–¥–æ–≤ –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö.</p>
                    </div>
                </div>

            </section>

            <!-- –°–µ–∫—Ü–∏—è: –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ -->
            <section id="transactions" class="mb-12">
                <div class="flex justify-between items-center mb-6 flex-wrap gap-4">
                    <h2 class="text-3xl font-bold">–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏</h2>
                    <div class="flex items-center gap-4 flex-wrap">
                        <button id="add-transaction-btn" class="bg-violet-600 text-white px-4 py-2 rounded-lg shadow hover:bg-violet-700 transition-colors">
                            + –î–æ–±–∞–≤–∏—Ç—å
                        </button>
                    </div>
                </div>

                <!-- –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã –∏ –ø–æ–∏—Å–∫ -->
                <div class="bg-white p-6 rounded-lg shadow mb-6">
                    <h3 class="text-xl font-bold mb-4">–§–∏–ª—å—Ç—Ä—ã –∏ –ø–æ–∏—Å–∫</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                        <div>
                            <label for="filter-type" class="block text-sm font-medium text-slate-700 mb-1">–¢–∏–ø</label>
                            <select id="filter-type" class="w-full p-2 border border-slate-300 rounded-md bg-white text-slate-800">
                                <option value="all">–í—Å–µ</option>
                                <option value="income">–î–æ—Ö–æ–¥—ã</option>
                                <option value="expense">–†–∞—Å—Ö–æ–¥—ã</option>
                            </select>
                        </div>
                        <div>
                            <label for="filter-category" class="block text-sm font-medium text-slate-700 mb-1">–ö–∞—Ç–µ–≥–æ—Ä–∏—è</label>
                            <select id="filter-category" class="w-full p-2 border border-slate-300 rounded-md bg-white text-slate-800">
                                <option value="all">–í—Å–µ</option>
                                <!-- –û–ø—Ü–∏–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–π –±—É–¥—É—Ç –∑–∞–ø–æ–ª–Ω–µ–Ω—ã –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ (–î–û–•–û–î–´ + –†–ê–°–•–û–î–´) -->
                            </select>
                        </div>
                        <div>
                            <label for="filter-account" class="block text-sm font-medium text-slate-700 mb-1">–°—á–µ—Ç</label>
                            <select id="filter-account" class="w-full p-2 border border-slate-300 rounded-md bg-white text-slate-800">
                                <option value="all">–í—Å–µ</option>
                                <!-- –û–ø—Ü–∏–∏ —Å—á–µ—Ç–æ–≤ –±—É–¥—É—Ç –∑–∞–ø–æ–ª–Ω–µ–Ω—ã –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                            </select>
                        </div>
                        <div>
                            <label for="filter-description" class="block text-sm font-medium text-slate-700 mb-1">–ü–æ–∏—Å–∫ –ø–æ –æ–ø–∏—Å–∞–Ω–∏—é</label>
                            <input type="text" id="filter-description" placeholder="–ù–∞–π—Ç–∏..." class="w-full p-2 border border-slate-300 rounded-md bg-slate-50 text-slate-800">
                        </div>
                        <div class="col-span-1 md:col-span-2 lg:col-span-2 flex flex-wrap gap-4 items-end">
                            <div class="flex-1 min-w-[120px]">
                                <label for="filter-amount-min" class="block text-sm font-medium text-slate-700 mb-1">–°—É–º–º–∞ –æ—Ç</label>
                                <input type="number" id="filter-amount-min" placeholder="–ú–∏–Ω. —Å—É–º–º–∞" class="w-full p-2 border border-slate-300 rounded-md bg-slate-50 text-slate-800">
                            </div>
                            <div class="flex-1 min-w-[120px]">
                                <label for="filter-amount-max" class="block text-sm font-medium text-slate-700 mb-1">–°—É–º–º–∞ –¥–æ</label>
                                <input type="number" id="filter-amount-max" placeholder="–ú–∞–∫—Å. —Å—É–º–º–∞" class="w-full p-2 border border-slate-300 rounded-md bg-slate-50 text-slate-800">
                            </div>
                        </div>
                        <div class="col-span-1 md:col-span-2 lg:col-span-2 flex flex-wrap gap-4 items-end">
                            <div class="flex-1 min-w-[120px]">
                                <label for="filter-date-start" class="block text-sm font-medium text-slate-700 mb-1">–î–∞—Ç–∞ –æ—Ç</label>
                                <input type="date" id="filter-date-start" class="w-full p-2 border border-slate-300 rounded-md bg-slate-50 text-slate-800">
                            </div>
                            <div class="flex-1 min-w-[120px]">
                                <label for="filter-date-end" class="block text-sm font-medium text-slate-700 mb-1">–î–∞—Ç–∞ –¥–æ</label>
                                <input type="date" id="filter-date-end" class="w-full p-2 border border-slate-300 rounded-md bg-slate-50 text-slate-800">
                            </div>
                        </div>
                        <div class="col-span-full flex justify-between items-center gap-4 mt-2">
                             <select id="sort-order" class="p-2 border border-slate-300 rounded-md bg-white text-slate-800">
                                 <option value="date-desc">–°–Ω–∞—á–∞–ª–∞ –Ω–æ–≤—ã–µ</option>
                                 <option value="date-asc">–°–Ω–∞—á–∞–ª–∞ —Å—Ç–∞—Ä—ã–µ</option>
                                 <option value="amount-desc">–°—É–º–º–∞ (—É–±—ã–≤.)</option>
                                 <option value="amount-asc">–°—É–º–º–∞ (–≤–æ–∑—Ä.)</option>
                             </select>
                             <button id="reset-filters-btn" class="text-violet-600 hover:text-violet-700 font-semibold transition-colors">–°–±—Ä–æ—Å–∏—Ç—å –≤—Å–µ —Ñ–∏–ª—å—Ç—Ä—ã</button>
                        </div>
                    </div>
                </div>
                <!-- –ö–û–ù–ï–¶ –ù–û–í–û–ì–û -->

                <!-- –≠–ª–µ–º–µ–Ω—Ç—ã –ø–∞–≥–∏–Ω–∞—Ü–∏–∏ -->
                <div id="pagination-controls" class="flex justify-center items-center gap-4 mt-6 mb-4">
                    <button id="prev-page-btn" class="bg-slate-200 text-slate-700 px-4 py-2 rounded-lg hover:bg-slate-300 disabled:opacity-50 disabled:cursor-not-allowed transition-colors">&larr;</button>
                    <span id="page-info" class="text-slate-600 font-medium">1/1</span>
                    <button id="next-page-btn" class="bg-slate-200 text-slate-700 px-4 py-2 rounded-lg hover:bg-slate-300 disabled:opacity-50 disabled:cursor-not-allowed transition-colors">&rarr;</button>
                </div>

                <div id="transaction-list" class="space-y-3">
                    <!-- –°–ø–∏—Å–æ–∫ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –±—É–¥–µ—Ç –∑–¥–µ—Å—å -->
                </div>
            </section>

            <!-- –°–µ–∫—Ü–∏—è: –ù–∞—Å—Ç—Ä–æ–π–∫–∏ -->
            <section id="settings">
                <h2 class="text-3xl font-bold mb-6">–ù–∞—Å—Ç—Ä–æ–π–∫–∏</h2>
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                    <div class="bg-white p-6 rounded-lg shadow">
                        <h3 class="text-xl font-bold mb-4">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º–∏</h3>
                        <div class="grid grid-cols-1 sm:grid-cols-2 gap-6">
                            <div>
                                <h4 class="font-semibold mb-2 text-green-600">–î–æ—Ö–æ–¥—ã</h4>
                                <div id="income-categories-list" class="space-y-2 mb-3"></div>
                                <div class="flex gap-2 items-center">
                                    <input type="text" id="new-income-category-name" placeholder="–ù–æ–≤–∞—è –∫–∞—Ç–µ–≥–æ—Ä–∏—è" class="w-full p-2 border border-slate-300 rounded-md bg-slate-50 text-slate-800">
                                    <button onclick="addCategory('income')" class="bg-green-500 text-white px-3 rounded-md hover:bg-green-600 transition-colors">+</button>
                                </div>
                            </div>
                            <div>
                                <h4 class="font-semibold mb-2 text-red-600">–†–∞—Å—Ö–æ–¥—ã</h4>
                                <div id="expense-categories-list" class="space-y-2 mb-3"></div>
                                <div class="flex gap-2 items-center">
                                    <input type="text" id="new-expense-category-name" placeholder="–ù–æ–≤–∞—è –∫–∞—Ç–µ–≥–æ—Ä–∏—è" class="w-full p-2 border border-slate-300 rounded-md bg-slate-50 text-slate-800">
                                    <button onclick="addCategory('expense')" class="bg-red-500 text-white px-3 rounded-md hover:bg-red-600 transition-colors">+</button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å—á–µ—Ç–∞–º–∏ -->
                    <div class="bg-white p-6 rounded-lg shadow">
                        <h3 class="text-xl font-bold mb-4">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å—á–µ—Ç–∞–º–∏</h3>
                        <div id="accounts-list" class="space-y-2 mb-3">
                            <!-- –°–ø–∏—Å–æ–∫ —Å—á–µ—Ç–æ–≤ –±—É–¥–µ—Ç –∑–¥–µ—Å—å -->
                        </div>
                        <div class="flex gap-2">
                            <input type="text" id="new-account-name" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ —Å—á–µ—Ç–∞" class="w-full p-2 border border-slate-300 rounded-md bg-slate-50 text-slate-800">
                            <button onclick="addAccount()" class="bg-violet-500 text-white px-3 rounded-md hover:bg-violet-600 transition-colors">+</button>
                        </div>
                    </div>

                    <!-- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ü–µ–ª—è–º–∏ –Ω–∞–∫–æ–ø–ª–µ–Ω–∏—è -->
                    <div class="bg-white p-6 rounded-lg shadow lg:col-span-2">
                        <h3 class="text-xl font-bold mb-4">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ü–µ–ª—è–º–∏ –Ω–∞–∫–æ–ø–ª–µ–Ω–∏—è</h3>
                        <div id="saving-goals-list" class="space-y-3 mb-3">
                             <p class="text-gray-500">–¶–µ–ª–∏ –Ω–∞–∫–æ–ø–ª–µ–Ω–∏—è –±—É–¥—É—Ç –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è –∑–¥–µ—Å—å.</p>
                        </div>
                        <div class="flex flex-col sm:flex-row gap-2">
                            <input type="text" id="new-saving-goal-name" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ —Ü–µ–ª–∏" class="w-full p-2 border border-slate-300 rounded-md bg-slate-50 text-slate-800 flex-1">
                            <input type="number" id="new-saving-goal-amount" placeholder="–¶–µ–ª–µ–≤–∞—è —Å—É–º–º–∞" min="0" step="0.01" class="w-full p-2 border border-slate-300 rounded-md bg-slate-50 text-slate-800 flex-1">
                            <button onclick="addSavingGoal()" class="bg-emerald-500 text-white px-3 py-2 rounded-md hover:bg-emerald-600 transition-colors">–î–æ–±–∞–≤–∏—Ç—å —Ü–µ–ª—å</button>
                        </div>
                    </div>
                    <!-- –ö–û–ù–ï–¶ –ù–û–í–û–ì–û -->

                    <!-- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–≤—Ç–æ—Ä—è—é—â–∏–º–∏—Å—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è–º–∏ -->
                    <div class="bg-white p-6 rounded-lg shadow lg:col-span-2">
                        <h3 class="text-xl font-bold mb-4">–ü–æ–≤—Ç–æ—Ä—è—é—â–∏–µ—Å—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏</h3>
                        <div id="recurring-transactions-list" class="space-y-3">
                            <p class="text-gray-500">–ü–æ–≤—Ç–æ—Ä—è—é—â–∏–µ—Å—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –±—É–¥—É—Ç –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è –∑–¥–µ—Å—å –ø–æ—Å–ª–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è.</p>
                        </div>
                        <p class="mt-4 text-sm text-gray-600">–ü–æ–≤—Ç–æ—Ä—è—é—â–∏–µ—Å—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞—é—Ç—Å—è –≤ –¥–∞—Ç—É –∏—Ö –Ω–∞—Å—Ç—É–ø–ª–µ–Ω–∏—è. –í—ã –º–æ–∂–µ—Ç–µ –¥–æ–±–∞–≤–∏—Ç—å –∏—Ö —á–µ—Ä–µ–∑ —Ñ–æ—Ä–º—É –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏.</p>
                    </div>

                    <div class="bg-white p-6 rounded-lg shadow">
                        <h3 class="text-xl font-bold mb-4">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã–º–∏</h3>
                        <div class="flex flex-col sm:flex-row gap-4">
                            <button onclick="exportData()" class="flex-1 bg-violet-500 text-white px-4 py-2 rounded-lg hover:bg-violet-600 transition-colors">–≠–∫—Å–ø–æ—Ä—Ç –≤ JSON</button>
                            <!-- –£–¥–∞–ª–µ–Ω–∞ –∫–Ω–æ–ø–∫–∞ "–ò–º–ø–æ—Ä—Ç –∏–∑ JSON" –∏ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π input type="file" -->
                        </div>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <!-- –ö–Ω–æ–ø–∫–∞ "–°–ø—Ä–∞–≤–∫–∞" –≤ —É–≥–ª—É -->
    <button id="open-help-modal-btn" class="fixed bottom-4 right-4 z-50 bg-violet-600 text-white p-3 rounded-full shadow-lg hover:bg-violet-700 transition-colors flex items-center justify-center text-xl">
        ?
    </button>

    <!-- –ú–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ –Ω–∞—Ö–æ–¥—è—Ç—Å—è –í–ù–ï –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ -->
    <div id="transaction-modal" class="fixed inset-0 z-50 bg-black/60 flex justify-center items-center p-4 hidden">
        <div class="bg-white rounded-lg shadow-2xl p-6 w-full max-w-md relative max-h-[90vh] overflow-y-auto modal-scrollable-content">
            <span id="close-modal-btn" class="absolute top-3 right-4 text-gray-400 hover:text-gray-700 text-3xl font-bold cursor-pointer">&times;</span>
            <h2 id="modal-title" class="text-2xl font-bold text-center mb-6">–ù–æ–≤–∞—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è</h2>
            <form id="transaction-form" class="space-y-4">
                <input type="hidden" id="transaction-id">
                <input type="hidden" id="is-recurring-edit" value="false"> <!-- –î–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ø–æ–≤—Ç–æ—Ä—è—é—â–∏—Ö—Å—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π -->

                <div class="flex justify-around">
                    <label class="flex items-center gap-2 cursor-pointer"><input type="radio" name="type" value="income" class="form-radio text-green-500" checked><span class="text-green-600 font-semibold">–î–æ—Ö–æ–¥</span></label>
                    <label class="flex items-center gap-2 cursor-pointer"><input type="radio" name="type" value="expense" class="form-radio text-red-500"><span class="text-red-600 font-semibold">–†–∞—Å—Ö–æ–¥</span></label>
                </div>
                <div><label for="amount" class="block mb-1 font-semibold">–°—É–º–º–∞</label><input type="number" id="amount" class="w-full p-2 border border-slate-300 rounded-md bg-slate-50 text-slate-800" placeholder="0.00" required step="0.01"></div>
                <div><label for="category" class="block mb-1 font-semibold">–ö–∞—Ç–µ–≥–æ—Ä–∏—è</label><select id="category" class="w-full p-2 border border-slate-300 rounded-md bg-white text-slate-800"></select></div>
                <!-- –í—ã–±–æ—Ä —Å—á–µ—Ç–∞ -->
                <div><label for="account" class="block mb-1 font-semibold">–°—á–µ—Ç</label><select id="account" class="w-full p-2 border border-slate-300 rounded-md bg-white text-slate-800"></select></div>
                
                <!-- –ù–û–í–û–ï: –ü—Ä–∏–≤—è–∑–∞—Ç—å –∫ —Ü–µ–ª–∏ (—Ç–æ–ª—å–∫–æ –¥–ª—è –¥–æ—Ö–æ–¥–æ–≤) -->
                <div id="saving-goal-field" class="hidden">
                    <label for="saving-goal" class="block mb-1 font-semibold">–ü—Ä–∏–≤—è–∑–∞—Ç—å –∫ —Ü–µ–ª–∏</label>
                    <select id="saving-goal" class="w-full p-2 border border-slate-300 rounded-md bg-white text-slate-800">
                        <option value="">–ù–µ –ø—Ä–∏–≤—è–∑—ã–≤–∞—Ç—å</option>
                    </select>
                </div>
                <!-- –ö–û–ù–ï–¶ –ù–û–í–û–ì–û -->

                <div class="grid grid-cols-2 gap-4">
                    <div><label for="date" class="block mb-1 font-semibold">–î–∞—Ç–∞</label><input type="date" id="date" class="w-full p-2 border border-slate-300 rounded-md bg-slate-50 text-slate-800" required></div>
                    <!-- –ü–æ–ª–µ –¥–ª—è –≤—Ä–µ–º–µ–Ω–∏ -->
                    <div><label for="time" class="block mb-1 font-semibold">–í—Ä–µ–º—è</label><input type="time" id="time" class="w-full p-2 border border-slate-300 rounded-md bg-slate-50 text-slate-800"></div>
                </div>
                <div><label for="description" class="block mb-1 font-semibold">–û–ø–∏—Å–∞–Ω–∏–µ</label><textarea id="description" class="w-full p-2 border border-slate-300 rounded-md bg-slate-50 text-slate-800" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä, –∑–∞—Ä–ø–ª–∞—Ç–∞ –∑–∞ –º–µ—Å—è—Ü"></textarea></div>

                <!-- –ü–æ–ª—è –¥–ª—è –ø–æ–≤—Ç–æ—Ä—è—é—â–µ–π—Å—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ -->
                <div class="bg-slate-50 p-4 rounded-md border border-slate-200">
                    <label class="flex items-center gap-2 cursor-pointer mb-3">
                        <input type="checkbox" id="is-recurring" class="form-checkbox text-violet-600">
                        <span class="font-semibold text-slate-700">–ü–æ–≤—Ç–æ—Ä—è—é—â–∞—è—Å—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è</span>
                    </label>
                    <div id="recurring-options" class="space-y-3 hidden">
                        <div>
                            <label for="frequency" class="block mb-1 text-sm font-semibold">–ß–∞—Å—Ç–æ—Ç–∞</label>
                            <select id="frequency" class="w-full p-2 border border-slate-300 rounded-md bg-white text-slate-800">
                                <option value="daily">–ï–∂–µ–¥–Ω–µ–≤–Ω–æ</option>
                                <option value="weekly">–ï–∂–µ–Ω–µ–¥–µ–ª—å–Ω–æ</option>
                                <option value="monthly">–ï–∂–µ–º–µ—Å—è—á–Ω–æ</option>
                                <option value="yearly">–ï–∂–µ–≥–æ–¥–Ω–æ</option>
                            </select>
                        </div>
                        <div>
                            <label for="recurring-start-date" class="block mb-1 text-sm font-semibold">–î–∞—Ç–∞ –Ω–∞—á–∞–ª–∞</label>
                            <input type="date" id="recurring-start-date" class="w-full p-2 border border-slate-300 rounded-md bg-slate-50 text-slate-800">
                        </div>
                        <div>
                            <label for="recurring-end-date" class="block mb-1 text-sm font-semibold">–î–∞—Ç–∞ –æ–∫–æ–Ω—á–∞–Ω–∏—è (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)</label>
                            <input type="date" id="recurring-end-date" class="w-full p-2 border border-slate-300 rounded-md bg-slate-50 text-slate-800">
                        </div>
                    </div>
                </div>

                <div class="flex justify-end pt-4"><button type="submit" class="bg-violet-600 text-white px-6 py-2 rounded-lg shadow hover:bg-violet-700 transition-colors">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button></div>
            </form>
        </div>
    </div>

    <div id="view-modal" class="fixed inset-0 z-50 bg-black/60 flex justify-center items-center p-4 hidden">
        <div class="bg-white rounded-lg shadow-2xl p-6 w-full max-w-md relative max-h-[90vh] overflow-y-auto modal-scrollable-content">
            <span id="close-view-modal-btn" class="absolute top-3 right-4 text-gray-400 hover:text-gray-700 text-3xl font-bold cursor-pointer">&times;</span>
            <h2 id="view-modal-title" class="text-2xl font-bold text-center mb-6">–î–µ—Ç–∞–ª–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏</h2>
            <div class="space-y-4">
                <div class="flex justify-between items-center"><span class="font-semibold text-gray-500">–¢–∏–ø:</span><span id="view-type" class="font-bold"></span></div>
                <div class="flex justify-between items-center"><span class="font-semibold text-gray-500">–°—É–º–º–∞:</span><span id="view-amount" class="font-bold text-lg"></span></div>
                <div class="flex justify-between items-center"><span class="font-semibold text-gray-500">–ö–∞—Ç–µ–≥–æ—Ä–∏—è:</span><span id="view-category"></span></div>
                <!-- –ü—Ä–æ—Å–º–æ—Ç—Ä —Å—á–µ—Ç–∞ -->
                <div class="flex justify-between items-center"><span class="font-semibold text-gray-500">–°—á–µ—Ç:</span><span id="view-account"></span></div>
                <!-- –ù–û–í–û–ï: –ü—Ä–æ—Å–º–æ—Ç—Ä –ø—Ä–∏–≤—è–∑–∞–Ω–Ω–æ–π —Ü–µ–ª–∏ -->
                <div id="view-saving-goal-row" class="flex justify-between items-center hidden"><span class="font-semibold text-gray-500">–ü—Ä–∏–≤—è–∑–∞–Ω–æ –∫ —Ü–µ–ª–∏:</span><span id="view-saving-goal"></span></div>
                <!-- –ö–û–ù–ï–¶ –ù–û–í–û–ì–û -->
                <div class="flex justify-between items-center"><span class="font-semibold text-gray-500">–î–∞—Ç–∞:</span><span id="view-date"></span></div>
                <!-- –ü—Ä–æ—Å–º–æ—Ç—Ä –≤—Ä–µ–º–µ–Ω–∏ -->
                <div class="flex justify-between items-center"><span class="font-semibold text-gray-500">–í—Ä–µ–º—è:</span><span id="view-time"></span></div>
                <div>
                    <p class="font-semibold text-gray-500 mb-1">–û–ø–∏—Å–∞–Ω–∏–µ:</p>
                    <p id="view-description" class="bg-slate-100 p-3 rounded-md min-h-[60px]"></p>
                </div>
            </div>
        </div>
    </div>

    <div id="confirm-modal" class="fixed inset-0 z-50 bg-black/60 flex justify-center items-center p-4 hidden">
        <div class="bg-white rounded-lg shadow-2xl p-6 w-full max-w-sm relative max-h-[90vh] overflow-y-auto modal-scrollable-content">
            <h2 id="confirm-modal-title" class="text-2xl font-bold text-center mb-4 text-slate-800">–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ</h2>
            <p id="confirm-modal-message" class="text-center mb-6 text-slate-600">–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å?</p>
            <div class="flex justify-center gap-4">
                <button id="confirm-cancel-btn" class="bg-gray-300 text-gray-800 px-6 py-2 rounded-lg shadow hover:bg-gray-400 transition-colors">–û—Ç–º–µ–Ω–∞</button>
                <button id="confirm-ok-btn" class="bg-red-600 text-white px-6 py-2 rounded-lg shadow hover:bg-red-700 transition-colors">–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å</button>
            </div>
        </div>
    </div>

    <!-- –ù–æ–≤—ã–π –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å–ø—Ä–∞–≤–∫–∏ -->
    <div id="help-modal" class="fixed inset-0 z-50 bg-black/60 flex justify-center items-center p-4 hidden">
        <div class="bg-white rounded-lg shadow-2xl p-6 w-full max-w-2xl relative max-h-[90vh] overflow-y-auto modal-scrollable-content">
            <span id="close-help-modal-btn" class="absolute top-3 right-4 text-gray-400 hover:text-gray-700 text-3xl font-bold cursor-pointer">&times;</span>
            <h2 id="help-modal-title" class="text-2xl font-bold text-center mb-6 text-slate-800">–ö–∞–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –ø—Ä–æ–≥—Ä–∞–º–º–æ–π "–õ–∏—á–Ω—ã–π –ë—é–¥–∂–µ—Ç"</h2>
            <div class="space-y-4 text-slate-700">
                <p>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –≤–∞—à–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ª–∏—á–Ω—ã–º –±—é–¥–∂–µ—Ç–æ–º! –°–ª–µ–¥—É–π—Ç–µ —ç—Ç–∏–º —à–∞–≥–∞–º, —á—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å:</p>

                <h3 class="font-semibold text-lg text-violet-600">1. –ù–∞—á–Ω–∏—Ç–µ —Å –û–±–∑–æ—Ä–∞ (–î–∞—à–±–æ—Ä–¥)</h3>
                <p>–ù–∞ –≤–∫–ª–∞–¥–∫–µ "–û–±–∑–æ—Ä" –≤—ã —É–≤–∏–¥–∏—Ç–µ —Å–≤–æ–¥–∫—É –ø–æ –≤–∞—à–∏–º —Ñ–∏–Ω–∞–Ω—Å–∞–º:</p>
                <ul class="list-disc list-inside ml-4 space-y-1">
                    <li><b>–û–±—â–∏–µ –¥–æ—Ö–æ–¥—ã, —Ä–∞—Å—Ö–æ–¥—ã –∏ –±–∞–ª–∞–Ω—Å:</b> –ö—Ä–∞—Ç–∫–∏–π –æ—Ç—á—ë—Ç –ø–æ –≤—Å–µ–º –≤–∞—à–∏–º —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è–º.</li>
                    <li><b>–ë–∞–ª–∞–Ω—Å –ø–æ —Å—á–µ—Ç–∞–º:</b> –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Å—Ä–µ–¥—Å—Ç–≤ –ø–æ –≤–∞—à–∏–º —Å—á–µ—Ç–∞–º (–Ω–∞–ª–∏—á–Ω—ã–µ, –∫–∞—Ä—Ç–∞ –∏ —Ç.–¥.).</li>
                    <li><b>–¶–µ–ª–∏ –Ω–∞–∫–æ–ø–ª–µ–Ω–∏—è:</b> –ü—Ä–æ–≥—Ä–µ—Å—Å –ø–æ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—é –≤–∞—à–∏—Ö —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã—Ö —Ü–µ–ª–µ–π.</li>
                    <li><b>–ê–Ω–∞–ª–∏—Ç–∏–∫–∞:</b> –†–∞–∑–ª–∏—á–Ω—ã–µ –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–µ –¥–∏–∞–≥—Ä–∞–º–º—ã –¥–ª—è –≥–ª—É–±–æ–∫–æ–≥–æ –ø–æ–Ω–∏–º–∞–Ω–∏—è –≤–∞—à–∏—Ö —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã—Ö –ø–æ—Ç–æ–∫–æ–≤. –ó–¥–µ—Å—å –≤—ã –Ω–∞–π–¥–µ—Ç–µ:
                        <ul class="list-circle list-inside ml-4 space-y-1">
                            <li>**–ü–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º (–∫—Ä—É–≥–æ–≤–∞—è):** –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –¥–æ–ª—é –∫–∞–∂–¥–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –≤ –æ–±—â–∏—Ö –¥–æ—Ö–æ–¥–∞—Ö –∏–ª–∏ —Ä–∞—Å—Ö–æ–¥–∞—Ö.</li>
                            <li>**–ü–æ –º–µ—Å—è—Ü–∞–º (—Å—Ç–æ–ª–±—á–∞—Ç–∞—è):** –°—Ä–∞–≤–Ω–∏–≤–∞–µ—Ç –æ–±—â–∏–µ –¥–æ—Ö–æ–¥—ã –∏ —Ä–∞—Å—Ö–æ–¥—ã –∑–∞ –∫–∞–∂–¥—ã–π –º–µ—Å—è—Ü.</li>
                            <li>**–ë–∞–ª–∞–Ω—Å (–¥–∏–Ω–∞–º–∏–∫–∞) (–ª–∏–Ω–µ–π–Ω–∞—è):** –û—Ç–æ–±—Ä–∞–∂–∞–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–µ –≤–∞—à–µ–≥–æ –æ–±—â–µ–≥–æ –±–∞–ª–∞–Ω—Å–∞ —Å —Ç–µ—á–µ–Ω–∏–µ–º –≤—Ä–µ–º–µ–Ω–∏.</li>
                            <li>**–ö—É–º—É–ª—è—Ç–∏–≤–Ω–æ (—Å –æ–±–ª–∞—Å—Ç—è–º–∏):** –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç, –∫–∞–∫ –Ω–∞—Ä–∞—Å—Ç–∞—é—Ç –≤–∞—à–∏ –æ–±—â–∏–µ –¥–æ—Ö–æ–¥—ã –∏ —Ä–∞—Å—Ö–æ–¥—ã –∑–∞ –≤–µ—Å—å –ø–µ—Ä–∏–æ–¥.</li>
                        </ul>
                    </li>
                    <li><b>–ë—é–¥–∂–µ—Ç –Ω–∞ —Ç–µ–∫—É—â–∏–π –º–µ—Å—è—Ü:</b> –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ —Ç—Ä–∞—Ç –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã—Ö –±—é–¥–∂–µ—Ç–æ–≤.</li>
                </ul>

                <h3 class="font-semibold text-lg text-violet-600">2. –î–æ–±–∞–≤–ª—è–π—Ç–µ –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏</h3>
                <p>–ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ –≤–∫–ª–∞–¥–∫—É "–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏".</p>
                <ul class="list-disc list-inside ml-4 space-y-1">
                    <li>–ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É <b>"+ –î–æ–±–∞–≤–∏—Ç—å"</b>.</li>
                    <li><b>–í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø:</b> "–î–æ—Ö–æ–¥" –∏–ª–∏ "–†–∞—Å—Ö–æ–¥".</li>
                    <li><b>–°—É–º–º–∞:</b> –£–∫–∞–∂–∏—Ç–µ —Å—É–º–º—É —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏.</li>
                    <li><b>–ö–∞—Ç–µ–≥–æ—Ä–∏—è:</b> –í—ã–±–µ—Ä–∏—Ç–µ –∏–∑ —Å–ø–∏—Å–∫–∞ –∏–ª–∏ —Å–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—É—é –≤ "–ù–∞—Å—Ç—Ä–æ–π–∫–∞—Ö".</li>
                    <li><b>–°—á–µ—Ç:</b> –í—ã–±–µ—Ä–∏—Ç–µ, —Å –∫–∞–∫–æ–≥–æ —Å—á–µ—Ç–∞ –∏–ª–∏ –Ω–∞ –∫–∞–∫–æ–π —Å—á–µ—Ç –ø–æ—Å—Ç—É–ø–∏–ª–∏/–±—ã–ª–∏ –ø–æ—Ç—Ä–∞—á–µ–Ω—ã –¥–µ–Ω—å–≥–∏. –°—á–µ—Ç–∞ –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–ª—è—Ç—å –≤ "–ù–∞—Å—Ç—Ä–æ–π–∫–∞—Ö".</li>
                    <li><b>–î–∞—Ç–∞ –∏ –í—Ä–µ–º—è:</b> –£–∫–∞–∂–∏—Ç–µ, –∫–æ–≥–¥–∞ –ø—Ä–æ–∏–∑–æ—à–ª–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è.</li>
                    <li><b>–û–ø–∏—Å–∞–Ω–∏–µ:</b> –î–æ–±–∞–≤—å—Ç–µ –∫—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –¥–ª—è –ø–æ–Ω–∏–º–∞–Ω–∏—è —Å—É—Ç–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, "–ó–∞—Ä–ø–ª–∞—Ç–∞ –∑–∞ –º–∞–π", "–ü–æ–∫—É–ø–∫–∞ –ø—Ä–æ–¥—É–∫—Ç–æ–≤ –≤ —Å—É–ø–µ—Ä–º–∞—Ä–∫–µ—Ç–µ").</li>
                    <li><b>–ü–æ–≤—Ç–æ—Ä—è—é—â–∞—è—Å—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è:</b> –ï—Å–ª–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç —Ä–µ–≥—É–ª—è—Ä–Ω–æ (–∑–∞—Ä–ø–ª–∞—Ç–∞, –∞—Ä–µ–Ω–¥–∞), –æ—Ç–º–µ—Ç—å—Ç–µ —ç—Ç—É –æ–ø—Ü–∏—é –∏ –Ω–∞—Å—Ç—Ä–æ–π—Ç–µ —á–∞—Å—Ç–æ—Ç—É.</li>
                    <li><b>–ü—Ä–∏–≤—è–∑–∞—Ç—å –∫ —Ü–µ–ª–∏ (—Ç–æ–ª—å–∫–æ –¥–ª—è –¥–æ—Ö–æ–¥–æ–≤):</b> –ï—Å–ª–∏ –¥–æ—Ö–æ–¥ –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π —Ü–µ–ª–∏ –Ω–∞–∫–æ–ø–ª–µ–Ω–∏—è, –≤—ã–±–µ—Ä–∏—Ç–µ –µ—ë –∑–¥–µ—Å—å.</li>
                    <li>–ù–∞–∂–º–∏—Ç–µ <b>"–°–æ—Ö—Ä–∞–Ω–∏—Ç—å"</b>.</li>
                </ul>

                <h3 class="font-semibold text-lg text-violet-600">3. –£–ø—Ä–∞–≤–ª—è–π—Ç–µ –ù–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏</h3>
                <p>–ù–∞ –≤–∫–ª–∞–¥–∫–µ "–ù–∞—Å—Ç—Ä–æ–π–∫–∏" –≤—ã –º–æ–∂–µ—Ç–µ:</p>
                <ul class="list-disc list-inside ml-4 space-y-1">
                    <li><b>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º–∏:</b> –î–æ–±–∞–≤–ª—è–π—Ç–µ, —É–¥–∞–ª—è–π—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –¥–æ—Ö–æ–¥–æ–≤ –∏ —Ä–∞—Å—Ö–æ–¥–æ–≤. –î–ª—è –∫–∞—Ç–µ–≥–æ—Ä–∏–π —Ä–∞—Å—Ö–æ–¥–æ–≤ –º–æ–∂–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –º–µ—Å—è—á–Ω—ã–π –±—é–¥–∂–µ—Ç.</li>
                    <li><b>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å—á–µ—Ç–∞–º–∏:</b> –°–æ–∑–¥–∞–≤–∞–π—Ç–µ –∏ —É–¥–∞–ª—è–π—Ç–µ —Å–≤–æ–∏ —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã–µ —Å—á–µ—Ç–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, "–ù–∞–ª–∏—á–Ω—ã–µ", "–ë–∞–Ω–∫–æ–≤—Å–∫–∞—è –∫–∞—Ä—Ç–∞", "–°–±–µ—Ä–µ–≥–∞—Ç–µ–ª—å–Ω—ã–π —Å—á–µ—Ç").</li>
                    <li><b>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ü–µ–ª—è–º–∏ –Ω–∞–∫–æ–ø–ª–µ–Ω–∏—è:</b> –î–æ–±–∞–≤–ª—è–π—Ç–µ –Ω–æ–≤—ã–µ —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã–µ —Ü–µ–ª–∏, —É–∫–∞–∑—ã–≤–∞—è —Ü–µ–ª–µ–≤—É—é —Å—É–º–º—É. –û—Ç—Å–ª–µ–∂–∏–≤–∞–π—Ç–µ –ø—Ä–æ–≥—Ä–µ—Å—Å –Ω–∞ –¥–∞—à–±–æ—Ä–¥–µ.</li>
                    <li><b>–ü–æ–≤—Ç–æ—Ä—è—é—â–∏–µ—Å—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏:</b> –ü—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞–π—Ç–µ –∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ —à–∞–±–ª–æ–Ω—ã –ø–æ–≤—Ç–æ—Ä—è—é—â–∏—Ö—Å—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π.</li>
                    <li><b>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã–º–∏:</b> –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–π—Ç–µ –≤—Å–µ —Å–≤–æ–∏ –¥–∞–Ω–Ω—ã–µ –≤ —Ñ–æ—Ä–º–∞—Ç–µ JSON –¥–ª—è —Ä–µ–∑–µ—Ä–≤–Ω–æ–≥–æ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è –∏–ª–∏ –ø–µ—Ä–µ–Ω–æ—Å–∞.</li>
                </ul>

                <h3 class="font-semibold text-lg text-violet-600">4. –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –∏ –ü–æ–∏—Å–∫ –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–π</h3>
                <p>–ù–∞ –≤–∫–ª–∞–¥–∫–µ "–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏" –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã –∏ –ø–æ–∏—Å–∫, —á—Ç–æ–±—ã –±—ã—Å—Ç—Ä–æ –Ω–∞–π—Ç–∏ –Ω—É–∂–Ω—ã–µ –∑–∞–ø–∏—Å–∏:</p>
                <ul class="list-disc list-inside ml-4 space-y-1">
                    <li>–§–∏–ª—å—Ç—Ä—É–π—Ç–µ –ø–æ —Ç–∏–ø—É (–¥–æ—Ö–æ–¥—ã/—Ä–∞—Å—Ö–æ–¥—ã), –∫–∞—Ç–µ–≥–æ—Ä–∏–∏, —Å—á–µ—Ç—É.</li>
                    <li>–ò—â–∏—Ç–µ –ø–æ –æ–ø–∏—Å–∞–Ω–∏—é, –¥–∞—Ç–µ –∏–ª–∏ –¥–∏–∞–ø–∞–∑–æ–Ω—É —Å—É–º–º.</li>
                    <li>–°–æ—Ä—Ç–∏—Ä—É–π—Ç–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –¥–ª—è —É–¥–æ–±–Ω–æ–≥–æ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞.</li>
                </ul>

                <p>–£–¥–∞—á–∏ –≤ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–∏ –≤–∞—à–∏–º –ª–∏—á–Ω—ã–º –±—é–¥–∂–µ—Ç–æ–º!</p>
            </div>
        </div>
    </div>

    <!-- –ö–Ω–æ–ø–∫–∞ –û—Ç–º–µ–Ω–∏—Ç—å —É–¥–∞–ª–µ–Ω–∏–µ -->
    <div id="undo-container" class="fixed bottom-4 left-1/2 -translate-x-1/2 z-50 transition-all duration-300 transform opacity-0 scale-0 pointer-events-none">
        <button id="undo-btn" class="bg-blue-600 text-white px-5 py-3 rounded-full shadow-lg hover:bg-blue-700 transition-colors flex items-center gap-2">
            <span class="text-xl">‚Ü©Ô∏è</span>
            <span>–û—Ç–º–µ–Ω–∏—Ç—å</span>
        </button>
    </div>

    <!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è —Ç–æ—Å—Ç–æ–≤/—É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π -->
    <div id="toast-container" class="fixed top-4 right-4 z-[9999] space-y-3">
        <!-- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –±—É–¥—É—Ç –∑–¥–µ—Å—å -->
    </div>

    <script>
    document.addEventListener('DOMContentLoaded', () => {
        // --- –ì–ª–æ–±–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ ---
        let transactions = []; // –û—Å–Ω–æ–≤–Ω–æ–π —Å–ø–∏—Å–æ–∫ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
        let categories = { // –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ —Ç–µ–ø–µ—Ä—å –æ–±—ä–µ–∫—Ç—ã —Å –±—é–¥–∂–µ—Ç–æ–º –∏ –∏–∫–æ–Ω–∫–æ–π
            income: [
                { id: 'inc1', name: '–ó–∞—Ä–ø–ª–∞—Ç–∞', icon: 'fa-solid fa-money-bill-wave' },
                { id: 'inc2', name: '–ü–æ–¥–∞—Ä–æ–∫', icon: 'fa-solid fa-gift' },
                { id: 'inc3', name: '–§—Ä–∏–ª–∞–Ω—Å', icon: 'fa-solid fa-laptop-code' }
            ],
            expense: [
                { id: 'exp1', name: '–ü—Ä–æ–¥—É–∫—Ç—ã', icon: 'fa-solid fa-cart-shopping', budget: 5000 },
                { id: 'exp2', name: '–¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç', icon: 'fa-solid fa-bus', budget: 1500 },
                { id: 'exp3', name: '–†–∞–∑–≤–ª–µ—á–µ–Ω–∏—è', icon: 'fa-solid fa-film', budget: 2000 },
                { id: 'exp4', name: '–ñ–ö–•', icon: 'fa-solid fa-house-chimney', budget: 3000 },
                { id: 'exp5', name: '–û–¥–µ–∂–¥–∞', icon: 'fa-solid fa-shirt', budget: 1000 }
            ]
        };
        let accounts = [ // –°–ø–∏—Å–æ–∫ —Å—á–µ—Ç–æ–≤
            { id: 'acc1', name: '–ù–∞–ª–∏—á–Ω—ã–µ', balance: 0 },
            { id: 'acc2', name: '–ë–∞–Ω–∫–æ–≤—Å–∫–∞—è –∫–∞—Ä—Ç–∞', balance: 0 }
        ];
        let recurringTransactions = []; // –®–∞–±–ª–æ–Ω—ã –ø–æ–≤—Ç–æ—Ä—è—é—â–∏—Ö—Å—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
        let savingGoals = []; // –ù–û–í–û–ï: –¶–µ–ª–∏ –Ω–∞–∫–æ–ø–ª–µ–Ω–∏—è

        // --- –°–æ—Å—Ç–æ—è–Ω–∏–µ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –¥–∏–∞–≥—Ä–∞–º–º–∞–º–∏ ---
        let chartInstances = { // –û–±—ä–µ–∫—Ç –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è —ç–∫–∑–µ–º–ø–ª—è—Ä–æ–≤ Chart.js
            categoryPie: null,
            monthlyBar: null,
            balanceLine: null,
            cumulativeArea: null
        };
        let currentChartType = 'pie'; // –ê–∫—Ç–∏–≤–Ω—ã–π —Ç–∏–ø –¥–∏–∞–≥—Ä–∞–º–º—ã: 'pie', 'monthlyBar', 'balanceLine', 'cumulativeArea'
        let currentCategoryChartDataType = 'expense'; // –¢–∏–ø –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –∫–∞—Ç–µ–≥–æ—Ä–∏–π–Ω—ã—Ö –¥–∏–∞–≥—Ä–∞–º–º: 'expense', 'income'

        // --- –°–æ—Å—Ç–æ—è–Ω–∏–µ —Ñ–∏–ª—å—Ç—Ä–æ–≤ ---
        let currentFilters = {
            type: 'all',
            category: 'all',
            account: 'all',
            description: '',
            amountMin: null,
            amountMax: null,
            dateStart: null,
            dateEnd: null,
            sortOrder: 'date-desc'
        };

        // --- –°–æ—Å—Ç–æ—è–Ω–∏–µ –ø–∞–≥–∏–Ω–∞—Ü–∏–∏ ---
        let currentPage = 0;
        const transactionsPerPage = 4; // –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–∞—Ä—Ç–æ—á–µ–∫ –Ω–∞ –æ–¥–Ω–æ–π "—Å—Ç—Ä–∞–Ω–∏—Ü–µ"

        // --- –î–ª—è —Ñ—É–Ω–∫—Ü–∏–∏ –û—Ç–º–µ–Ω—ã ---
        let lastDeletedItem = null; // Stores { type: 'transaction'|'category'|'account'|'recurringTransaction'|'savingGoal', data: {...} }
        let undoTimeoutId = null; // Stores the ID for the setTimeout to hide the undo button
        const UNDO_TIMEOUT_MS = 10000; // 10 —Å–µ–∫—É–Ω–¥, —á–µ—Ä–µ–∑ –∫–æ—Ç–æ—Ä—ã–µ –∫–Ω–æ–ø–∫–∞ –û—Ç–º–µ–Ω–∏—Ç—å –∏—Å—á–µ–∑–Ω–µ—Ç

        // --- DOM –≠–ª–µ–º–µ–Ω—Ç—ã ---
        const appContainer = document.getElementById('app-container');
        const transactionModal = document.getElementById('transaction-modal');
        const viewModal = document.getElementById('view-modal');
        const confirmModal = document.getElementById('confirm-modal');
        const helpModal = document.getElementById('help-modal'); // NEW
        const openHelpModalBtn = document.getElementById('open-help-modal-btn'); // NEW
        const closeHelpModalBtn = document.getElementById('close-help-modal-btn'); // NEW
        const confirmModalTitle = document.getElementById('confirm-modal-title');
        const confirmModalMessage = document.getElementById('confirm-modal-message');
        const confirmOkBtn = document.getElementById('confirm-ok-btn');
        const confirmCancelBtn = document.getElementById('confirm-cancel-btn');
        const transactionForm = document.getElementById('transaction-form');
        const toastContainer = document.getElementById('toast-container');
        
        const undoContainer = document.getElementById('undo-container');
        const undoBtn = document.getElementById('undo-btn');

        const mobileMenu = document.getElementById('mobile-menu');
        const mobileMenuOverlay = document.getElementById('mobile-menu-overlay');
        const mobileHeader = document.getElementById('mobile-header');
        let lastScrollTop = 0;

        // --- –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ ---
        const generateUniqueId = (prefix = 'id') => `${prefix}${Date.now()}-${Math.random().toString(36).substr(2, 9)}`;
        const formatDate = (dateString) => new Date(dateString).toLocaleDateString('ru-RU');
        // –ò–∑–º–µ–Ω–µ–Ω–æ –¥–ª—è —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Å 2 –∑–Ω–∞–∫–∞–º–∏ –ø–æ—Å–ª–µ –∑–∞–ø—è—Ç–æ–π –¥–ª—è –≤–∞–ª—é—Ç—ã
        const formatCurrency = (amount) => parseFloat(amount).toLocaleString('ru-RU', { style: 'currency', currency: 'RUB', minimumFractionDigits: 0, maximumFractionDigits: 2 });
        const getCategoryById = (id, type) => categories[type]?.find(cat => cat.id === id); // –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å ?. –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞
        const getAccountById = (id) => accounts.find(acc => acc.id === id);
        const getSavingGoalById = (id) => savingGoals.find(goal => goal.id === id);

        // --- –¶–≤–µ—Ç–∞ –¥–ª—è –≥—Ä–∞—Ñ–∏–∫–æ–≤ ---
        const CHART_COLORS = {
            income: ['#22c55e', '#14b8a6', '#0ea5e9', '#6366f1', '#a855f7', '#d946ef', '#f472b6', '#fb7185', '#f87171', '#fb923c'],
            expense: ['#ef4444', '#f97316', '#eab308', '#84cc16', '#22c55e', '#14b8a6', '#0ea5e9', '#6366f1', '#a855f7', '#d946ef'],
            balance: '#6366f1', // violet-500
            lightBlue: '#38bdf8', // sky-400
            red: '#ef4444', // red-500
            green: '#22c55e', // green-500
            gray: '#6b7280' // gray-500
        };

        const generateDynamicColors = (numColors) => {
            const colors = [];
            for (let i = 0; i < numColors; i++) {
                const hue = (i * 137.508) % 360; // Use golden angle approximation for even distribution
                colors.push(`hsl(${hue}, 70%, 50%)`);
            }
            return colors;
        };


        // --- –£–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–∫—Ä—É—Ç–∫–æ–π —Ç–µ–ª–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –∏ —Ä–∞–∑–º—ã—Ç–∏–µ–º ---
        const updateBodyScrollAndBlur = () => {
            const isAnyModalOpen = !transactionModal.classList.contains('hidden') ||
                                   !viewModal.classList.contains('hidden') ||
                                   !confirmModal.classList.contains('hidden') ||
                                   !helpModal.classList.contains('hidden'); // NEW: include help modal
            const isMobileMenuOpen = mobileMenu.classList.contains('translate-x-0');

            if (isMobileMenuOpen || isAnyModalOpen) {
                document.body.classList.add('overflow-hidden');
                appContainer.classList.add('blur-sm', 'pointer-events-none');
            } else {
                // –£–±–µ–¥–∏–º—Å—è, —á—Ç–æ –≤—Å–µ –º–æ–¥–∞–ª—ã –∏ –º–µ–Ω—é –∑–∞–∫—Ä—ã—Ç—ã, –ø—Ä–µ–∂–¥–µ —á–µ–º —É–±–∏—Ä–∞—Ç—å —Å—Ç–∏–ª–∏
                // –ó–∞–¥–µ—Ä–∂–∫–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç transition-duration –≤ CSS (300ms)
                setTimeout(() => { 
                    if (!mobileMenu.classList.contains('translate-x-0') &&
                        transactionModal.classList.contains('hidden') &&
                        viewModal.classList.contains('hidden') &&
                        confirmModal.classList.contains('hidden') &&
                        helpModal.classList.contains('hidden')) { // NEW: check help modal
                        
                        document.body.classList.remove('overflow-hidden');
                        appContainer.classList.remove('blur-sm', 'pointer-events-none');
                    }
                }, 350); 
            }
        };

        // --- –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–∫–∞–∑–∞ —Ç–æ—Å—Ç-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π ---
        const showToast = (message, type = 'info', duration = 3000) => {
            const toast = document.createElement('div');
            let icon = '';
            let classes = 'p-4 rounded-lg shadow-lg flex items-center gap-3 transition-all duration-300 transform translate-x-full opacity-0 ';

            switch (type) {
                case 'success':
                    icon = '‚úÖ';
                    classes += 'bg-green-100 text-green-800 border-l-4 border-green-500';
                    break;
                case 'error':
                    icon = '‚ùå';
                    classes += 'bg-red-100 text-red-800 border-l-4 border-red-500';
                    break;
                case 'warning':
                    icon = '‚ö†Ô∏è';
                    classes += 'bg-yellow-100 text-yellow-800 border-l-4 border-yellow-500';
                    break;
                case 'info':
                default:
                    icon = '‚ÑπÔ∏è';
                    classes += 'bg-blue-100 text-blue-800 border-l-4 border-blue-500';
                    break;
            }

            toast.className = classes;
            toast.innerHTML = `
                <span class="text-2xl">${icon}</span>
                <p class="flex-1">${message}</p>
                <button class="ml-auto text-gray-500 hover:text-gray-700 text-xl font-bold leading-none" onclick="this.closest('div').remove()">&times;</button>
            `;

            toastContainer.appendChild(toast);

            // –ê–Ω–∏–º–∞—Ü–∏—è –ø–æ—è–≤–ª–µ–Ω–∏—è
            setTimeout(() => {
                toast.classList.remove('translate-x-full', 'opacity-0');
                toast.classList.add('translate-x-0', 'opacity-100');
            }, 50); // –ù–µ–±–æ–ª—å—à–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞, —á—Ç–æ–±—ã –±—Ä–∞—É–∑–µ—Ä —É—Å–ø–µ–ª –ø—Ä–∏–º–µ–Ω–∏—Ç—å –Ω–∞—á–∞–ª—å–Ω—ã–µ —Å—Ç–∏–ª–∏

            // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–∫—Ä—ã—Ç–∏–µ
            setTimeout(() => {
                toast.classList.remove('translate-x-0', 'opacity-100');
                toast.classList.add('translate-x-full', 'opacity-0');
                toast.addEventListener('transitionend', () => toast.remove());
            }, duration);
        };

        // --- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ–º ---
        const saveData = () => {
            localStorage.setItem('budgetAppData', JSON.stringify({ transactions, categories, accounts, recurringTransactions, savingGoals }));
        };

        const loadData = () => {
            const data = localStorage.getItem('budgetAppData');
            if (data) {
                const parsedData = JSON.parse(data);
                // –ë–æ–ª–µ–µ –≥–∏–±–∫–æ–µ –ø—Ä–∏—Å–≤–æ–µ–Ω–∏–µ, —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å –æ—à–∏–±–æ–∫ –ø—Ä–∏ –∏–º–ø–æ—Ä—Ç–µ —Å—Ç–∞—Ä—ã—Ö –¥–∞–Ω–Ω—ã—Ö
                transactions = parsedData.transactions || [];
                accounts = parsedData.accounts || accounts; // –ï—Å–ª–∏ accounts –Ω–µ—Ç, –±–µ—Ä–µ–º –¥–µ—Ñ–æ–ª—Ç–Ω—ã–µ
                recurringTransactions = parsedData.recurringTransactions || [];
                savingGoals = parsedData.savingGoals || []; 

                // –ú–∏–≥—Ä–∞—Ü–∏—è –∫–∞—Ç–µ–≥–æ—Ä–∏–π, –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
                // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∏–∫–æ–Ω–æ–∫ –∏ –±—é–¥–∂–µ—Ç–∞, –µ—Å–ª–∏ –∏—Ö –Ω–µ—Ç
                ['income', 'expense'].forEach(type => {
                    if (parsedData.categories && parsedData.categories[type]) {
                        categories[type] = parsedData.categories[type].map(cat => {
                            // –ï—Å–ª–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏—è - —ç—Ç–æ –ø—Ä–æ—Å—Ç–æ —Å—Ç—Ä–æ–∫–∞, –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º –≤ –æ–±—ä–µ–∫—Ç
                            if (typeof cat === 'string') {
                                return { 
                                    id: generateUniqueId(type.slice(0, 3)), 
                                    name: cat, 
                                    icon: 'fa-solid fa-tag', 
                                    budget: type === 'expense' ? 0 : undefined 
                                };
                            }
                            // –ï—Å–ª–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏—è —É–∂–µ –æ–±—ä–µ–∫—Ç, –Ω–æ –±–µ–∑ –∏–∫–æ–Ω–∫–∏/–±—é–¥–∂–µ—Ç–∞, –¥–æ–±–∞–≤–ª—è–µ–º –∏—Ö
                            return { 
                                ...cat, 
                                icon: cat.icon || 'fa-solid fa-tag',
                                budget: (type === 'expense' && cat.budget === undefined) ? 0 : cat.budget
                            };
                        });
                    } else if (parsedData.categories) { // –µ—Å–ª–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ —Ç–∏–ø–∞ –Ω–µ –±—ã–ª–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã
                         categories[type] = [];
                    }
                });

                // –¢–æ–ª—å–∫–æ –µ—Å–ª–∏ –±—ã–ª–∞ –º–∏–≥—Ä–∞—Ü–∏—è —Å—Ç—Ä–æ–∫–æ–≤—ã—Ö –∫–∞—Ç–µ–≥–æ—Ä–∏–π –≤ –æ–±—ä–µ–∫—Ç—ã
                if (parsedData.categories && parsedData.categories.income.length > 0 && typeof parsedData.categories.income[0] === 'string') {
                     showToast('–°—Ç–∞—Ä—ã–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –æ–±–Ω–æ–≤–ª–µ–Ω—ã –¥–æ –Ω–æ–≤–æ–≥–æ —Ñ–æ—Ä–º–∞—Ç–∞.', 'info');
                }
            }
        };

        // --- –õ–æ–≥–∏–∫–∞ Recurring Transactions ---
        const generateRecurringTransactions = () => {
            const today = new Date();
            today.setHours(0, 0, 0, 0); 
            let generatedCount = 0;

            recurringTransactions.forEach(rt => {
                const startDate = new Date(rt.startDate);
                startDate.setHours(0, 0, 0, 0);
                const endDate = rt.endDate ? new Date(rt.endDate) : null;
                if (endDate) endDate.setHours(0, 0, 0, 0);

                let lastGenerated = rt.lastGeneratedDate ? new Date(rt.lastGeneratedDate) : new Date(startDate);
                lastGenerated.setHours(0, 0, 0, 0);

                let nextGenerationDate = new Date(lastGenerated);

                if (lastGenerated < startDate) {
                    nextGenerationDate = new Date(startDate);
                } else {
                    switch (rt.frequency) {
                        case 'daily': nextGenerationDate.setDate(nextGenerationDate.getDate() + 1); break;
                        case 'weekly': nextGenerationDate.setDate(nextGenerationDate.getDate() + 7); break;
                        case 'monthly': nextGenerationDate.setMonth(nextGenerationDate.getMonth() + 1); break;
                        case 'yearly': nextGenerationDate.setFullYear(nextGenerationDate.getFullYear() + 1); break;
                    }
                }
                
                while (nextGenerationDate <= today) {
                    if (nextGenerationDate >= startDate && (!endDate || nextGenerationDate <= endDate)) {
                        const newTransaction = {
                            id: generateUniqueId('T'),
                            type: rt.type,
                            amount: rt.amount,
                            category: rt.category,
                            account: rt.account,
                            date: nextGenerationDate.toISOString().split('T')[0],
                            time: rt.time || '12:00',
                            description: rt.description + ' (–ø–æ–≤—Ç–æ—Ä—è—é—â–∞—è—Å—è)',
                            savingGoalId: rt.savingGoalId || undefined // –ù–û–í–û–ï: –ü–µ—Ä–µ–¥–∞–µ–º ID —Ü–µ–ª–∏, –µ—Å–ª–∏ –µ—Å—Ç—å
                        };
                        transactions.push(newTransaction);
                        generatedCount++;
                    }

                    switch (rt.frequency) {
                        case 'daily': nextGenerationDate.setDate(nextGenerationDate.getDate() + 1); break;
                        case 'weekly': nextGenerationDate.setDate(nextGenerationDate.getDate() + 7); break;
                        case 'monthly': nextGenerationDate.setMonth(nextGenerationDate.getMonth() + 1); break;
                        case 'yearly': nextGenerationDate.setFullYear(nextGenerationDate.getFullYear() + 1); break;
                    }

                    if (endDate && nextGenerationDate > endDate) break; 
                }

                if (generatedCount > 0) {
                    let newLastGeneratedDate = new Date(today);
                    newLastGeneratedDate.setHours(0,0,0,0);
                    // –£–±–µ–∂–¥–∞–µ–º—Å—è, —á—Ç–æ lastGeneratedDate –Ω–µ –º–µ–Ω—å—à–µ startDate
                    if (newLastGeneratedDate < startDate) {
                         newLastGeneratedDate = new Date(startDate);
                    }
                    rt.lastGeneratedDate = newLastGeneratedDate.toISOString().split('T')[0];
                }
            });

            if (generatedCount > 0) {
                saveData();
                showToast(`–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–æ ${generatedCount} –ø–æ–≤—Ç–æ—Ä—è—é—â–∏—Ö—Å—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π.`, 'info');
            }
        };

        // --- –§—É–Ω–∫—Ü–∏–∏ —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞ (–æ–±–Ω–æ–≤–ª–µ–Ω–∏—è UI) ---
        const renderAll = () => {
            renderSummary();
            renderAccountsSummary();
            renderBudgetSummary();
            renderSavingGoalsSummary(); // –ù–û–í–û–ï: –†–µ–Ω–¥–µ—Ä–∏–Ω–≥ —Å–≤–æ–¥–∫–∏ –ø–æ —Ü–µ–ª—è–º
            renderTransactionFilters(); 
            currentPage = 0; 
            renderTransactions(); 
            renderCategories();
            renderAccounts();
            renderRecurringTransactions();
            renderSavingGoalsSettings(); // –ù–û–í–û–ï: –†–µ–Ω–¥–µ—Ä–∏–Ω–≥ —Ü–µ–ª–µ–π –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö
            renderCharts(); // –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥ –≤—Å–µ—Ö –¥–∏–∞–≥—Ä–∞–º–º
            updateNavLinks(window.location.hash || '#dashboard');
            updateSavingGoalOptions(); // –ù–û–í–û–ï: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ —Ü–µ–ª–µ–π –≤ —Ñ–æ—Ä–º–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
        };

        const renderSummary = () => {
            let totalIncome = 0;
            let totalExpenses = 0;

            transactions.forEach(t => {
                const amount = parseFloat(t.amount);
                if (t.type === 'income') {
                    totalIncome += amount;
                } else {
                    totalExpenses += amount;
                }
            });
            const balance = totalIncome - totalExpenses;

            document.getElementById('total-income').textContent = formatCurrency(totalIncome);
            document.getElementById('total-expenses').textContent = formatCurrency(totalExpenses);
            document.getElementById('total-balance').textContent = formatCurrency(balance);
            
            const balanceCard = document.getElementById('total-balance-card');
            balanceCard.classList.remove('bg-green-100', 'border-green-500', 'text-green-800', 'bg-red-100', 'border-red-500', 'text-red-800', 'bg-violet-100', 'border-violet-500', 'text-violet-800');
            if (balance > 0) {
                balanceCard.classList.add('bg-green-100', 'border-green-500', 'text-green-800');
            } else if (balance < 0) {
                balanceCard.classList.add('bg-red-100', 'border-red-500', 'text-red-800');
            } else {
                balanceCard.classList.add('bg-violet-100', 'border-violet-500', 'text-violet-800');
            }
        };

        // –†–µ–Ω–¥–µ—Ä–∏–Ω–≥ —Å–≤–æ–¥–∫–∏ –ø–æ —Å—á–µ—Ç–∞–º
        const renderAccountsSummary = () => {
            const accountsSummaryDiv = document.getElementById('accounts-summary');
            accountsSummaryDiv.innerHTML = ''; 

            if (accounts.length === 0) {
                accountsSummaryDiv.innerHTML = '<p class="text-gray-500">–î–æ–±–∞–≤—å—Ç–µ —Å—á–µ—Ç–∞ –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö.</p>';
                return;
            }

            accounts.forEach(account => {
                let currentBalance = 0;
                transactions.forEach(t => {
                    if (t.account === account.id) {
                        const amount = parseFloat(t.amount);
                        if (t.type === 'income') {
                            currentBalance += amount;
                        } else {
                            currentBalance -= amount;
                        }
                    }
                });
                
                const card = document.createElement('div');
                card.className = `p-3 rounded-lg shadow-sm border-l-4 ${currentBalance >= 0 ? 'bg-blue-100 border-blue-500 text-blue-800' : 'bg-red-100 border-red-500 text-red-800'}`;
                card.innerHTML = `
                    <h4 class="font-semibold text-sm">${account.name}</h4>
                    <p class="text-xl font-bold">${formatCurrency(currentBalance)}</p>
                `;
                accountsSummaryDiv.appendChild(card);
            });
        };

        // –†–µ–Ω–¥–µ—Ä–∏–Ω–≥ —Å–≤–æ–¥–∫–∏ –ø–æ –±—é–¥–∂–µ—Ç–∞–º
        const renderBudgetSummary = () => {
            const budgetSummaryList = document.getElementById('budget-summary-list');
            budgetSummaryList.innerHTML = '';

            const expenseCategoriesWithBudget = categories.expense.filter(cat => cat.budget && cat.budget > 0);

            if (expenseCategoriesWithBudget.length === 0) {
                budgetSummaryList.innerHTML = '<p class="text-gray-500">–î–æ–±–∞–≤—å—Ç–µ –±—é–¥–∂–µ—Ç—ã –∫ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º —Ä–∞—Å—Ö–æ–¥–æ–≤ –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö.</p>';
                return;
            }

            const now = new Date();
            const currentMonth = now.getMonth();
            const currentYear = now.getFullYear();

            const monthlyExpensesByCategory = transactions
                .filter(t => {
                    if (t.type !== 'expense') return false;
                    const transactionDate = new Date(t.date);
                    return transactionDate.getMonth() === currentMonth && transactionDate.getFullYear() === currentYear;
                })
                .reduce((acc, t) => {
                    const categoryObj = categories.expense.find(cat => cat.id === t.category);
                    if (categoryObj) {
                        acc[categoryObj.id] = (acc[categoryObj.id] || 0) + parseFloat(t.amount);
                    }
                    return acc;
                }, {});

            expenseCategoriesWithBudget.forEach(cat => {
                const spent = monthlyExpensesByCategory[cat.id] || 0;
                const budget = parseFloat(cat.budget);
                const remaining = budget - spent;
                const percentage = (spent / budget) * 100;

                let progressBarColor = 'bg-green-500';
                if (percentage >= 100) {
                    progressBarColor = 'bg-red-500';
                } else if (percentage >= 75) {
                    progressBarColor = 'bg-yellow-500';
                }

                const item = document.createElement('div');
                item.className = 'p-3 border-b border-slate-200 last:border-b-0';
                item.innerHTML = `
                    <div class="flex justify-between items-center mb-1">
                        <span class="font-semibold text-slate-700"><i class="${cat.icon} mr-2"></i>${cat.name}</span>
                        <span class="text-sm text-slate-600">${formatCurrency(spent)} / ${formatCurrency(budget)}</span>
                    </div>
                    <div class="budget-progress-bar">
                        <div class="budget-progress-fill ${progressBarColor}" style="width: ${Math.min(100, percentage)}%;"></div>
                    </div>
                    <p class="text-xs text-right mt-1 ${remaining < 0 ? 'text-red-500' : 'text-slate-500'}">
                        ${remaining >= 0 ? `–û—Å—Ç–∞–ª–æ—Å—å: ${formatCurrency(remaining)}` : `–ü—Ä–µ–≤—ã—à–µ–Ω–æ: ${formatCurrency(Math.abs(remaining))}`}
                    </p>
                `;
                budgetSummaryList.appendChild(item);
            });
        };

        // –ù–û–í–û–ï: –†–µ–Ω–¥–µ—Ä–∏–Ω–≥ —Å–≤–æ–¥–∫–∏ –ø–æ —Ü–µ–ª—è–º –Ω–∞–∫–æ–ø–ª–µ–Ω–∏—è
        const renderSavingGoalsSummary = () => {
            const savingGoalsSummaryList = document.getElementById('saving-goals-summary-list');
            savingGoalsSummaryList.innerHTML = '';

            if (savingGoals.length === 0) {
                savingGoalsSummaryList.innerHTML = '<p class="text-gray-500">–î–æ–±–∞–≤—å—Ç–µ —Ü–µ–ª–∏ –Ω–∞–∫–æ–ø–ª–µ–Ω–∏—è –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö.</p>';
                return;
            }

            savingGoals.forEach(goal => {
                const currentContribution = transactions
                    .filter(t => t.type === 'income' && t.savingGoalId === goal.id)
                    .reduce((sum, t) => sum + parseFloat(t.amount), 0);
                
                const targetAmount = parseFloat(goal.targetAmount);
                const percentage = (currentContribution / targetAmount) * 100;
                const remaining = targetAmount - currentContribution;

                let progressBarColor = 'bg-blue-500';
                if (percentage >= 100) {
                    progressBarColor = 'bg-emerald-500'; // –î–æ—Å—Ç–∏–≥–Ω—É—Ç–∞ —Ü–µ–ª—å
                } else if (percentage >= 75) {
                    progressBarColor = 'bg-sky-500';
                }

                const item = document.createElement('div');
                item.className = 'bg-white p-4 rounded-lg shadow-sm border-l-4 border-blue-500';
                item.innerHTML = `
                    <h4 class="font-bold text-slate-700 mb-1">üéØ ${goal.name}</h4>
                    <p class="text-sm text-slate-500">–í–Ω–µ—Å–µ–Ω–æ: ${formatCurrency(currentContribution)} –∏–∑ ${formatCurrency(targetAmount)}</p>
                    <div class="saving-goal-progress-bar mt-2">
                        <div class="saving-goal-progress-fill ${progressBarColor}" style="width: ${Math.min(100, percentage)}%;"></div>
                    </div>
                    <p class="text-xs text-right mt-1 ${percentage >= 100 ? 'text-emerald-600' : 'text-slate-500'}">
                        ${percentage >= 100 ? `–¶–µ–ª—å –¥–æ—Å—Ç–∏–≥–Ω—É—Ç–∞!` : `–û—Å—Ç–∞–ª–æ—Å—å: ${formatCurrency(remaining)}`}
                    </p>
                `;
                savingGoalsSummaryList.appendChild(item);
            });
        };

        const renderTransactions = () => {
            const listContainer = document.getElementById('transaction-list');
            listContainer.innerHTML = '';
            
            let filteredTransactions = [...transactions];

            // –ü—Ä–∏–º–µ–Ω—è–µ–º —Ñ–∏–ª—å—Ç—Ä—ã
            if (currentFilters.type !== 'all') {
                filteredTransactions = filteredTransactions.filter(t => t.type === currentFilters.type);
            }
            if (currentFilters.category !== 'all') {
                // –ß—Ç–æ–±—ã —Ñ–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º –¥–æ—Ö–æ–¥–æ–≤/—Ä–∞—Å—Ö–æ–¥–æ–≤, –Ω—É–∂–Ω–æ —É—á–∏—Ç—ã–≤–∞—Ç—å type
                // –í —Ñ–æ—Ä–º–µ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ —É–Ω–∏–∫–∞–ª—å–Ω—ã –∏ –≤–∫–ª—é—á–∞—é—Ç —Ç–∏–ø –≤ –Ω–∞–∑–≤–∞–Ω–∏–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, "–ó–∞—Ä–ø–ª–∞—Ç–∞ (–î–æ—Ö–æ–¥)")
                // –ù–æ –ø—Ä–∏ —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–∏ —Å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–µ–π, –Ω—É–∂–Ω–æ —Å—Ä–∞–≤–Ω–∏–≤–∞—Ç—å cat.id —Å t.category
                // –ú—ã —Å–æ—Ö—Ä–∞–Ω—è–µ–º –≤ —Ñ–∏–ª—å—Ç—Ä–µ —Ç–æ–ª—å–∫–æ id –∫–∞—Ç–µ–≥–æ—Ä–∏–∏, –ø–æ—ç—Ç–æ–º—É –Ω—É–∂–Ω–æ –∏—Å–∫–∞—Ç—å –ø–æ id
                const filterCategoryObj = [...categories.income, ...categories.expense].find(cat => cat.id === currentFilters.category);
                if (filterCategoryObj) {
                    // –§–∏–ª—å—Ç—Ä—É–µ–º —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –ø–æ ID –∫–∞—Ç–µ–≥–æ—Ä–∏–∏, –∞ –Ω–µ –ø–æ —Ç–∏–ø—É –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –∏–∑ filter-category
                    // –ø–æ—Å–∫–æ–ª—å–∫—É –≤ filter-category –º—ã –æ–±—ä–µ–¥–∏–Ω—è–µ–º –≤—Å–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
                    filteredTransactions = filteredTransactions.filter(t => t.category === currentFilters.category);
                } else if (currentFilters.category !== 'all') { // –ï—Å–ª–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω–∞, –Ω–æ —Ñ–∏–ª—å—Ç—Ä –∞–∫—Ç–∏–≤–µ–Ω
                    filteredTransactions = []; // –ù–∏—á–µ–≥–æ –Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å
                }
            }
            if (currentFilters.account !== 'all') {
                filteredTransactions = filteredTransactions.filter(t => t.account === currentFilters.account);
            }
            if (currentFilters.description) {
                const searchTerm = currentFilters.description.toLowerCase();
                filteredTransactions = filteredTransactions.filter(t => t.description && t.description.toLowerCase().includes(searchTerm));
            }
            if (currentFilters.amountMin !== null && !isNaN(currentFilters.amountMin)) {
                filteredTransactions = filteredTransactions.filter(t => parseFloat(t.amount) >= currentFilters.amountMin);
            }
            if (currentFilters.amountMax !== null && !isNaN(currentFilters.amountMax)) {
                filteredTransactions = filteredTransactions.filter(t => parseFloat(t.amount) <= currentFilters.amountMax);
            }
            if (currentFilters.dateStart) {
                filteredTransactions = filteredTransactions.filter(t => t.date >= currentFilters.dateStart);
            }
            if (currentFilters.dateEnd) {
                filteredTransactions = filteredTransactions.filter(t => t.date <= currentFilters.dateEnd);
            }

            // –ü—Ä–∏–º–µ–Ω—è–µ–º —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫—É
            filteredTransactions.sort((a, b) => {
                switch (currentFilters.sortOrder) {
                    case 'date-desc': return new Date(b.date + 'T' + (b.time || '00:00')) - new Date(a.date + 'T' + (a.time || '00:00'));
                    case 'date-asc': return new Date(a.date + 'T' + (a.time || '00:00')) - new Date(b.date + 'T' + (b.time || '00:00'));
                    case 'amount-desc': return parseFloat(b.amount) - parseFloat(a.amount);
                    case 'amount-asc': return parseFloat(a.amount) - parseFloat(b.amount);
                    default: return 0;
                }
            });

            // --- –õ–æ–≥–∏–∫–∞ –ø–∞–≥–∏–Ω–∞—Ü–∏–∏ ---
            const totalTransactions = filteredTransactions.length;
            const totalPages = Math.ceil(totalTransactions / transactionsPerPage);

            if (currentPage >= totalPages && totalPages > 0) { currentPage = totalPages - 1; }
            else if (totalPages === 0) { currentPage = 0; }

            const startIndex = currentPage * transactionsPerPage;
            const endIndex = Math.min(startIndex + transactionsPerPage, totalTransactions);

            const transactionsToDisplay = filteredTransactions.slice(startIndex, endIndex);

            const prevBtn = document.getElementById('prev-page-btn');
            const nextBtn = document.getElementById('next-page-btn');
            const pageInfoSpan = document.getElementById('page-info');
            const paginationControls = document.getElementById('pagination-controls');

            prevBtn.disabled = currentPage === 0 || totalPages <= 1;
            nextBtn.disabled = currentPage >= totalPages - 1 || totalPages <= 1;
            pageInfoSpan.textContent = totalPages > 0 ? `${currentPage + 1}/${totalPages}` : '';
            
            if (totalPages <= 1) { paginationControls.classList.add('hidden'); }
            else { paginationControls.classList.remove('hidden'); }
            // --- –ö–æ–Ω–µ—Ü –ª–æ–≥–∏–∫–∏ –ø–∞–≥–∏–Ω–∞—Ü–∏–∏ ---

            if (transactionsToDisplay.length === 0) {
                listContainer.innerHTML = `<p class="p-8 text-center bg-white rounded-lg text-gray-500">–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –ø–æ –≤–∞—à–∏–º –∫—Ä–∏—Ç–µ—Ä–∏—è–º –Ω–µ –Ω–∞–π–¥–µ–Ω–æ.</p>`;
                return;
            }

            transactionsToDisplay.forEach(t => {
                const isIncome = t.type === 'income';
                const categoryObj = getCategoryById(t.category, t.type);
                const accountObj = getAccountById(t.account);
                const item = document.createElement('div');
                item.className = `bg-white rounded-lg shadow p-4 flex items-center justify-between gap-4 border-l-4 ${isIncome ? 'border-l-green-500' : 'border-l-red-500'} transition-transform hover:scale-[1.02] duration-300`;
                item.innerHTML = `
                    <div class="flex-1 cursor-pointer" onclick="viewTransaction('${t.id}')">
                        <div class="flex items-center gap-3">
                            <div class="text-2xl"><i class="${categoryObj ? categoryObj.icon : 'fa-solid fa-tag'}"></i></div>
                            <div>
                                <p class="font-bold">${categoryObj ? categoryObj.name : '–ë–µ–∑ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏'}</p>
                                <p class="text-sm text-slate-500">${formatDate(t.date)} ${t.time || ''} (${accountObj ? accountObj.name : '–ë–µ–∑ —Å—á–µ—Ç–∞'})</p>
                            </div>
                        </div>
                    </div>
                    <div class="flex items-center gap-4 text-right">
                        <p class="font-bold text-lg ${isIncome ? 'text-green-600' : 'text-red-600'}">${isIncome ? '+' : '-'} ${formatCurrency(t.amount)}</p>
                        <div class="flex gap-2">
                             <button onclick="editTransaction('${t.id}')" class="text-blue-500 hover:text-blue-700 p-1 rounded-full text-lg">‚úèÔ∏è</button>
                             <button onclick="deleteTransaction('${t.id}')" class="text-red-500 hover:text-red-700 p-1 rounded-full text-lg">üóëÔ∏è</button>
                        </div>
                    </div>
                `;
                listContainer.appendChild(item);
            });
        };

        const renderCategories = () => {
            const createCategoryEditor = (category, type) => {
                const chip = document.createElement('div');
                chip.className = 'flex justify-between items-center text-sm bg-slate-200 px-2 py-1 rounded-full transition-colors duration-300 group';
                chip.innerHTML = `
                    <div class="flex items-center gap-2">
                        <i class="${category.icon || 'fa-solid fa-tag'}"></i>
                        <span>${category.name}</span>
                    </div>
                    <div class="flex items-center gap-2">
                        ${type === 'expense' ? `<input type="number" data-category-id="${category.id}" value="${category.budget || 0}" min="0" placeholder="–ë—é–¥–∂–µ—Ç" class="budget-input w-20 text-center p-0.5 border border-slate-300 rounded-md bg-white text-slate-800 text-xs hidden group-hover:block" onchange="updateCategoryBudget('${category.id}', this.value)">` : ''}
                        <button onclick="deleteCategory('${type}', '${category.id}')" class="ml-2 text-red-500 hover:text-red-700 transition-colors">&times;</button>
                    </div>
                `;
                return chip;
            };
            const incomeList = document.getElementById('income-categories-list');
            const expenseList = document.getElementById('expense-categories-list');
            incomeList.innerHTML = ''; expenseList.innerHTML = '';
            categories.income.forEach(cat => incomeList.appendChild(createCategoryEditor(cat, 'income')));
            categories.expense.forEach(cat => expenseList.appendChild(createCategoryEditor(cat, 'expense')));
        };

        // –†–µ–Ω–¥–µ—Ä–∏–Ω–≥ —Å–ø–∏—Å–∫–∞ —Å—á–µ—Ç–æ–≤ –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö
        const renderAccounts = () => {
            const accountsList = document.getElementById('accounts-list');
            accountsList.innerHTML = '';
            if (accounts.length === 0) {
                accountsList.innerHTML = '<p class="text-gray-500 text-sm">–ù–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω–Ω—ã—Ö —Å—á–µ—Ç–æ–≤.</p>';
                return;
            }
            accounts.forEach(account => {
                const accountItem = document.createElement('div');
                accountItem.className = 'flex justify-between items-center text-sm bg-slate-200 px-2 py-1 rounded-full';
                accountItem.innerHTML = `
                    <span>${account.name}</span>
                    <button onclick="deleteAccount('${account.id}')" class="ml-2 text-red-500 hover:text-red-700 transition-colors">&times;</button>
                `;
                accountsList.appendChild(accountItem);
            });
        };

        // –†–µ–Ω–¥–µ—Ä–∏–Ω–≥ –ø–æ–≤—Ç–æ—Ä—è—é—â–∏—Ö—Å—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö
        const renderRecurringTransactions = () => {
            const recurringList = document.getElementById('recurring-transactions-list');
            recurringList.innerHTML = '';

            if (recurringTransactions.length === 0) {
                recurringList.innerHTML = '<p class="text-gray-500">–ü–æ–≤—Ç–æ—Ä—è—é—â–∏–µ—Å—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –±—É–¥—É—Ç –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è –∑–¥–µ—Å—å –ø–æ—Å–ª–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è.</p>';
                return;
            }

            recurringTransactions.forEach(rt => {
                const categoryObj = getCategoryById(rt.category, rt.type);
                const accountObj = getAccountById(rt.account);
                const savingGoalObj = rt.savingGoalId ? getSavingGoalById(rt.savingGoalId) : null;
                const item = document.createElement('div');
                item.className = `bg-white rounded-lg shadow p-4 flex items-center justify-between gap-4 border-l-4 ${rt.type === 'income' ? 'border-l-green-500' : 'border-l-red-500'}`;
                item.innerHTML = `
                    <div class="flex-1">
                        <p class="font-bold">${rt.description || '–ë–µ–∑ –æ–ø–∏—Å–∞–Ω–∏—è'}</p>
                        <p class="text-sm text-slate-500">
                            ${rt.type === 'income' ? '–î–æ—Ö–æ–¥' : '–†–∞—Å—Ö–æ–¥'} –≤ ${formatCurrency(rt.amount)} –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ "${categoryObj ? categoryObj.name : 'N/A'}" –Ω–∞ —Å—á–µ—Ç "${accountObj ? accountObj.name : 'N/A'}"
                            ${savingGoalObj ? ` (–∫ —Ü–µ–ª–∏: ${savingGoalObj.name})` : ''}
                        </p>
                        <p class="text-xs text-slate-500 mt-1">
                            –ß–∞—Å—Ç–æ—Ç–∞: ${rt.frequency === 'daily' ? '–ï–∂–µ–¥–Ω–µ–≤–Ω–æ' : rt.frequency === 'weekly' ? '–ï–∂–µ–Ω–µ–¥–µ–ª—å–Ω–æ' : rt.frequency === 'monthly' ? '–ï–∂–µ–º–µ—Å—è—á–Ω–æ' : '–ï–∂–µ–≥–æ–¥–Ω–æ'}
                            —Å ${formatDate(rt.startDate)} ${rt.endDate ? `–ø–æ ${formatDate(rt.endDate)}` : ''}
                        </p>
                    </div>
                    <div class="flex gap-2">
                        <button onclick="editRecurringTransaction('${rt.id}')" class="text-blue-500 hover:text-blue-700 p-1 rounded-full text-lg">‚úèÔ∏è</button>
                        <button onclick="deleteRecurringTransaction('${rt.id}')" class="text-red-500 hover:text-red-700 p-1 rounded-full text-lg">üóëÔ∏è</button>
                    </div>
                `;
                recurringList.appendChild(item);
            });
        };

        // –ù–û–í–û–ï: –†–µ–Ω–¥–µ—Ä–∏–Ω–≥ —Ü–µ–ª–µ–π –Ω–∞–∫–æ–ø–ª–µ–Ω–∏—è –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö
        const renderSavingGoalsSettings = () => {
            const savingGoalsListDiv = document.getElementById('saving-goals-list');
            savingGoalsListDiv.innerHTML = '';

            if (savingGoals.length === 0) {
                savingGoalsListDiv.innerHTML = '<p class="text-gray-500">–¶–µ–ª–∏ –Ω–∞–∫–æ–ø–ª–µ–Ω–∏—è –±—É–¥—É—Ç –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è –∑–¥–µ—Å—å.</p>';
                return;
            }

            savingGoals.forEach(goal => {
                const item = document.createElement('div');
                item.className = 'flex justify-between items-center text-sm bg-slate-200 px-2 py-1 rounded-full';
                item.innerHTML = `
                    <span>üéØ ${goal.name} (${formatCurrency(goal.targetAmount)})</span>
                    <div class="flex gap-2">
                        <button onclick="editSavingGoal('${goal.id}')" class="text-blue-500 hover:text-blue-700 transition-colors">‚úèÔ∏è</button>
                        <button onclick="deleteSavingGoal('${goal.id}')" class="ml-2 text-red-500 hover:text-red-700 transition-colors">&times;</button>
                    </div>
                `;
                savingGoalsListDiv.appendChild(item);
            });
        };

        // --- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–∏–∞–≥—Ä–∞–º–º–∞–º–∏ ---
        const destroyChart = (chartId) => {
            if (chartInstances[chartId]) {
                chartInstances[chartId].destroy();
                chartInstances[chartId] = null;
            }
        };

        const renderCharts = () => {
            // –£–¥–∞–ª—è–µ–º –≤—Å–µ –ø—Ä–µ–¥—ã–¥—É—â–∏–µ —ç–∫–∑–µ–º–ø–ª—è—Ä—ã –¥–∏–∞–≥—Ä–∞–º–º
            Object.keys(chartInstances).forEach(destroyChart);

            // –°–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ canvas
            document.querySelectorAll('.chart-canvas').forEach(canvas => canvas.classList.add('hidden'));

            const categorySubToggle = document.getElementById('category-sub-toggle');
            const chartSectionTitle = document.getElementById('chart-section-title');

            // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º –Ω—É–∂–Ω—ã–π canvas –∏ —Ä–µ–Ω–¥–µ—Ä–∏–º —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â—É—é –¥–∏–∞–≥—Ä–∞–º–º—É
            switch (currentChartType) {
                case 'pie':
                    document.getElementById('categoryPieChartCanvas').classList.remove('hidden');
                    renderCategoryPieChart(currentCategoryChartDataType);
                    categorySubToggle.classList.remove('hidden');
                    chartSectionTitle.textContent = `–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ ${currentCategoryChartDataType === 'expense' ? '—Ä–∞—Å—Ö–æ–¥–æ–≤' : '–¥–æ—Ö–æ–¥–æ–≤'} –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º`;
                    break;
                case 'monthlyBar':
                    document.getElementById('monthlyBarChartCanvas').classList.remove('hidden');
                    renderMonthlyBarChart();
                    categorySubToggle.classList.add('hidden');
                    chartSectionTitle.textContent = '–ï–∂–µ–º–µ—Å—è—á–Ω—ã–µ –¥–æ—Ö–æ–¥—ã –∏ —Ä–∞—Å—Ö–æ–¥—ã';
                    break;
                case 'balanceLine':
                    document.getElementById('balanceLineChartCanvas').classList.remove('hidden');
                    renderBalanceLineChart();
                    categorySubToggle.classList.add('hidden');
                    chartSectionTitle.textContent = '–î–∏–Ω–∞–º–∏–∫–∞ –æ–±—â–µ–≥–æ –±–∞–ª–∞–Ω—Å–∞';
                    break;
                case 'cumulativeArea':
                    document.getElementById('cumulativeAreaChartCanvas').classList.remove('hidden');
                    renderCumulativeAreaChart();
                    categorySubToggle.classList.add('hidden');
                    chartSectionTitle.textContent = '–ö—É–º—É–ª—è—Ç–∏–≤–Ω—ã–µ —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã–µ –ø–æ—Ç–æ–∫–∏';
                    break;
            }
            updateChartTypeButtons(); // –û–±–Ω–æ–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—ã–µ –∫–Ω–æ–ø–∫–∏
        };

        const updateChartTypeButtons = () => {
            document.querySelectorAll('.chart-toggle-type-btn').forEach(btn => btn.classList.remove('active'));
            const activeChartBtn = document.getElementById(`show-${currentChartType}-chart-btn`);
            if (activeChartBtn) activeChartBtn.classList.add('active');

            // –û–±–Ω–æ–≤–ª—è–µ–º –∫–Ω–æ–ø–∫–∏ "–†–∞—Å—Ö–æ–¥—ã/–î–æ—Ö–æ–¥—ã"
            document.querySelectorAll('#category-sub-toggle .chart-toggle-btn').forEach(btn => btn.classList.remove('active'));
            const activeCategoryBtn = document.getElementById(`show-category-${currentCategoryChartDataType}-btn`);
            if (activeCategoryBtn) activeCategoryBtn.classList.add('active');
        };

        // --- –ö—Ä—É–≥–æ–≤–∞—è –¥–∏–∞–≥—Ä–∞–º–º–∞ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º (–º–æ–¥–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–∞ –∏–∑ —Ç–≤–æ–µ–π `renderChart`) ---
        const renderCategoryPieChart = (type) => {
            destroyChart('categoryPie'); // –£–Ω–∏—á—Ç–æ–∂–∞–µ–º –ø—Ä–µ–¥—ã–¥—É—â–∏–π —ç–∫–∑–µ–º–ø–ª—è—Ä

            const dataMap = transactions.filter(t => t.type === type).reduce((acc, t) => {
                acc[t.category] = (acc[t.category] || 0) + parseFloat(t.amount);
                return acc;
            }, {});

            const ctx = document.getElementById('categoryPieChartCanvas').getContext('2d');
            
            const categoryNames = Object.keys(dataMap).map(catId => {
                const categoryObj = getCategoryById(catId, type);
                return categoryObj ? categoryObj.name : '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è';
            });
            const values = Object.values(dataMap);
            // –ò—Å–ø–æ–ª—å–∑—É–µ–º –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ —Ü–≤–µ—Ç–∞
            const backgroundColors = generateDynamicColors(values.length); 

            chartInstances.categoryPie = new Chart(ctx, {
                type: 'pie',
                data: {
                    labels: categoryNames,
                    datasets: [{
                        data: values,
                        backgroundColor: backgroundColors, 
                        borderColor: '#ffffff',
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { position: 'top', labels: { color: CHART_COLORS.gray } },
                        tooltip: { 
                            callbacks: { 
                                label: c => `${c.label || ''}: ${formatCurrency(c.parsed)} (${(c.parsed / values.reduce((a,b)=>a+b,0) * 100).toFixed(1)}%)`
                            },
                            titleColor: CHART_COLORS.gray,
                            bodyColor: CHART_COLORS.gray,
                            backgroundColor: 'rgba(255, 255, 255, 0.9)',
                            borderColor: '#d1d5db',
                            borderWidth: 1
                        }
                    }
                }
            });
        };

        // --- –°—Ç–æ–ª–±—á–∞—Ç–∞—è –¥–∏–∞–≥—Ä–∞–º–º–∞: –ï–∂–µ–º–µ—Å—è—á–Ω—ã–µ –¥–æ—Ö–æ–¥—ã –∏ —Ä–∞—Å—Ö–æ–¥—ã ---
        const renderMonthlyBarChart = () => {
            destroyChart('monthlyBar');

            const monthlyData = transactions.reduce((acc, t) => {
                const date = new Date(t.date);
                const yearMonth = `${date.getFullYear()}-${(date.getMonth() + 1).toString().padStart(2, '0')}`;
                
                if (!acc[yearMonth]) {
                    acc[yearMonth] = { income: 0, expense: 0 };
                }
                const amount = parseFloat(t.amount);
                if (t.type === 'income') {
                    acc[yearMonth].income += amount;
                } else {
                    acc[yearMonth].expense += amount;
                }
                return acc;
            }, {});

            const sortedMonths = Object.keys(monthlyData).sort();
            const labels = sortedMonths.map(ym => {
                const [year, month] = ym.split('-');
                return new Date(year, parseInt(month) - 1).toLocaleString('ru-RU', { month: 'short', year: '2-digit' });
            });
            const incomeData = sortedMonths.map(ym => monthlyData[ym].income);
            const expenseData = sortedMonths.map(ym => monthlyData[ym].expense);

            const ctx = document.getElementById('monthlyBarChartCanvas').getContext('2d');
            chartInstances.monthlyBar = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [
                        {
                            label: '–î–æ—Ö–æ–¥—ã',
                            data: incomeData,
                            backgroundColor: CHART_COLORS.green,
                            borderColor: CHART_COLORS.green,
                            borderWidth: 1
                        },
                        {
                            label: '–†–∞—Å—Ö–æ–¥—ã',
                            data: expenseData,
                            backgroundColor: CHART_COLORS.red,
                            borderColor: CHART_COLORS.red,
                            borderWidth: 1
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { position: 'top', labels: { color: CHART_COLORS.gray } },
                        tooltip: { 
                            callbacks: { label: c => `${c.dataset.label}: ${formatCurrency(c.parsed.y)}` },
                            titleColor: CHART_COLORS.gray,
                            bodyColor: CHART_COLORS.gray,
                            backgroundColor: 'rgba(255, 255, 255, 0.9)',
                            borderColor: '#d1d5db',
                            borderWidth: 1
                        }
                    },
                    scales: {
                        x: { stacked: false, ticks: { color: CHART_COLORS.gray } },
                        y: { stacked: false, beginAtZero: true, ticks: { color: CHART_COLORS.gray, callback: (value) => formatCurrency(value) } }
                    }
                }
            });
        };

        // --- –õ–∏–Ω–µ–π–Ω–∞—è –¥–∏–∞–≥—Ä–∞–º–º–∞: –î–∏–Ω–∞–º–∏–∫–∞ –±–∞–ª–∞–Ω—Å–∞ ---
        const renderBalanceLineChart = () => {
            destroyChart('balanceLine');

            // –°–æ—Ä—Ç–∏—Ä—É–µ–º —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –ø–æ –¥–∞—Ç–µ –∏ –≤—Ä–µ–º–µ–Ω–∏
            const sortedTransactions = [...transactions].sort((a, b) => {
                const dateA = new Date(a.date + 'T' + (a.time || '00:00'));
                const dateB = new Date(b.date + 'T' + (b.time || '00:00'));
                return dateA - dateB;
            });

            if (sortedTransactions.length === 0) {
                // –ï—Å–ª–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –Ω–µ—Ç, –º–æ–∂–Ω–æ –æ—Ç–æ–±—Ä–∞–∑–∏—Ç—å –ø—É—Å—Ç—É—é –¥–∏–∞–≥—Ä–∞–º–º—É –∏–ª–∏ —Å–æ–æ–±—â–µ–Ω–∏–µ
                const ctx = document.getElementById('balanceLineChartCanvas').getContext('2d');
                ctx.clearRect(0, 0, ctx.canvas.width, ctx.canvas.height); // –û—á–∏—Å—Ç–∏—Ç—å canvas
                return;
            }

            const labels = [];
            const balanceData = [];
            let currentBalance = 0;
            let lastDate = null;

            sortedTransactions.forEach(t => {
                const transactionDate = new Date(t.date + 'T' + (t.time || '00:00'));
                // –ï—Å–ª–∏ –Ω–æ–≤–∞—è –¥–∞—Ç–∞ –æ—Ç–ª–∏—á–∞–µ—Ç—Å—è –æ—Ç –ø—Ä–µ–¥—ã–¥—É—â–µ–π, –¥–æ–±–∞–≤–ª—è–µ–º –ø—Ä–µ–¥—ã–¥—É—â–∏–π –±–∞–ª–∞–Ω—Å
                // –≠—Ç–æ –Ω—É–∂–Ω–æ, —á—Ç–æ–±—ã –ª–∏–Ω–∏—è –Ω–µ "—Å–∫–∞–∫–∞–ª–∞" –º–µ–∂–¥—É —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è–º–∏ —Ä–∞–∑–Ω—ã—Ö –¥–Ω–µ–π
                if (lastDate && transactionDate.toDateString() !== lastDate.toDateString()) {
                    labels.push(formatDate(lastDate));
                    balanceData.push(currentBalance);
                }
                
                if (t.type === 'income') {
                    currentBalance += parseFloat(t.amount);
                } else {
                    currentBalance -= parseFloat(t.amount);
                }
                lastDate = transactionDate;
            });
            // –î–æ–±–∞–≤–ª—è–µ–º –ø–æ—Å–ª–µ–¥–Ω–∏–π –±–∞–ª–∞–Ω—Å –Ω–∞ –ø–æ—Å–ª–µ–¥–Ω—é—é –¥–∞—Ç—É
            if (lastDate) {
                labels.push(formatDate(lastDate));
                balanceData.push(currentBalance);
            }

            const ctx = document.getElementById('balanceLineChartCanvas').getContext('2d');
            chartInstances.balanceLine = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: '–û–±—â–∏–π –±–∞–ª–∞–Ω—Å',
                        data: balanceData,
                        fill: false,
                        borderColor: CHART_COLORS.balance,
                        tension: 0.1,
                        pointBackgroundColor: CHART_COLORS.balance,
                        pointBorderColor: '#ffffff',
                        pointRadius: 3,
                        pointHoverRadius: 5
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { position: 'top', labels: { color: CHART_COLORS.gray } },
                        tooltip: { 
                            callbacks: { label: c => `${c.dataset.label}: ${formatCurrency(c.parsed.y)}` },
                            titleColor: CHART_COLORS.gray,
                            bodyColor: CHART_COLORS.gray,
                            backgroundColor: 'rgba(255, 255, 255, 0.9)',
                            borderColor: '#d1d5db',
                            borderWidth: 1
                        }
                    },
                    scales: {
                        x: { ticks: { color: CHART_COLORS.gray } },
                        y: { beginAtZero: false, ticks: { color: CHART_COLORS.gray, callback: (value) => formatCurrency(value) } }
                    }
                }
            });
        };

        // --- –î–∏–∞–≥—Ä–∞–º–º–∞ —Å –æ–±–ª–∞—Å—Ç—è–º–∏: –ö—É–º—É–ª—è—Ç–∏–≤–Ω—ã–µ –¥–æ—Ö–æ–¥—ã –∏ —Ä–∞—Å—Ö–æ–¥—ã ---
        const renderCumulativeAreaChart = () => {
            destroyChart('cumulativeArea');

            const sortedTransactions = [...transactions].sort((a, b) => {
                const dateA = new Date(a.date + 'T' + (a.time || '00:00'));
                const dateB = new Date(b.date + 'T' + (b.time || '00:00'));
                return dateA - dateB;
            });

            if (sortedTransactions.length === 0) {
                 // –ï—Å–ª–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –Ω–µ—Ç, –º–æ–∂–Ω–æ –æ—Ç–æ–±—Ä–∞–∑–∏—Ç—å –ø—É—Å—Ç—É—é –¥–∏–∞–≥—Ä–∞–º–º—É –∏–ª–∏ —Å–æ–æ–±—â–µ–Ω–∏–µ
                const ctx = document.getElementById('cumulativeAreaChartCanvas').getContext('2d');
                ctx.clearRect(0, 0, ctx.canvas.width, ctx.canvas.height); // –û—á–∏—Å—Ç–∏—Ç—å canvas
                return;
            }

            const labels = [];
            const cumulativeIncome = [];
            const cumulativeExpense = [];
            let currentIncome = 0;
            let currentExpense = 0;
            let lastDate = null;

            sortedTransactions.forEach(t => {
                const transactionDate = new Date(t.date + 'T' + (t.time || '00:00'));

                if (lastDate && transactionDate.toDateString() !== lastDate.toDateString()) {
                    labels.push(formatDate(lastDate));
                    cumulativeIncome.push(currentIncome);
                    cumulativeExpense.push(currentExpense);
                }

                if (t.type === 'income') {
                    currentIncome += parseFloat(t.amount);
                } else {
                    currentExpense += parseFloat(t.amount);
                }
                lastDate = transactionDate;
            });
            if (lastDate) {
                labels.push(formatDate(lastDate));
                cumulativeIncome.push(currentIncome);
                cumulativeExpense.push(currentExpense);
            }

            const ctx = document.getElementById('cumulativeAreaChartCanvas').getContext('2d');
            chartInstances.cumulativeArea = new Chart(ctx, {
                type: 'line', // Area chart is a line chart with fill: true
                data: {
                    labels: labels,
                    datasets: [
                        {
                            label: '–ö—É–º—É–ª—è—Ç–∏–≤–Ω—ã–µ –¥–æ—Ö–æ–¥—ã',
                            data: cumulativeIncome,
                            backgroundColor: 'rgba(34, 197, 94, 0.5)', // green-500 with alpha
                            borderColor: CHART_COLORS.green,
                            fill: true,
                            tension: 0.2,
                            stack: 'CombinedStack' // Stack them to see total flow
                        },
                        {
                            label: '–ö—É–º—É–ª—è—Ç–∏–≤–Ω—ã–µ —Ä–∞—Å—Ö–æ–¥—ã',
                            data: cumulativeExpense,
                            backgroundColor: 'rgba(239, 68, 68, 0.5)', // red-500 with alpha
                            borderColor: CHART_COLORS.red,
                            fill: true,
                            tension: 0.2,
                            stack: 'CombinedStack' // Stack them to see total flow
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { position: 'top', labels: { color: CHART_COLORS.gray } },
                        tooltip: { 
                            callbacks: { label: c => `${c.dataset.label}: ${formatCurrency(c.parsed.y)}` },
                            titleColor: CHART_COLORS.gray,
                            bodyColor: CHART_COLORS.gray,
                            backgroundColor: 'rgba(255, 255, 255, 0.9)',
                            borderColor: '#d1d5db',
                            borderWidth: 1
                        }
                    },
                    scales: {
                        x: { ticks: { color: CHART_COLORS.gray } },
                        y: { beginAtZero: true, stacked: true, ticks: { color: CHART_COLORS.gray, callback: (value) => formatCurrency(value) } }
                    }
                }
            });
        };


        // --- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –º–æ–¥–∞–ª—å–Ω—ã–º–∏ –æ–∫–Ω–∞–º–∏ –∏ –º–æ–±–∏–ª—å–Ω—ã–º –º–µ–Ω—é ---
        const toggleMobileMenu = (open) => {
            if (open) {
                mobileMenu.classList.remove('-translate-x-full');
                mobileMenu.classList.add('translate-x-0');
                mobileMenuOverlay.classList.remove('hidden');
                setTimeout(() => mobileMenuOverlay.classList.add('opacity-100'), 10);
            } else {
                mobileMenu.classList.remove('translate-x-0');
                mobileMenu.classList.add('-translate-x-full');
                mobileMenuOverlay.classList.remove('opacity-100');
                // –ó–∞–¥–µ—Ä–∂–∫–∞ —Å–∫—Ä—ã—Ç–∏—è –æ–≤–µ—Ä–ª–µ—è –¥–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∞–Ω–∏–º–∞—Ü–∏–∏ –º–µ–Ω—é
                setTimeout(() => mobileMenuOverlay.classList.add('hidden'), 300); 
            }
            updateBodyScrollAndBlur();
        };

        // –ù–û–í–û–ï: –û—Ç–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª–∫–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ —Å —É—á–µ—Ç–æ–º —Ü–µ–ª–µ–π
        const openFormModal = (transaction = null, isRecurring = false, recurringItem = null) => {
            transactionForm.reset();
            document.getElementById('transaction-id').value = '';
            document.getElementById('is-recurring-edit').value = isRecurring;

            const isRecurringCheckbox = document.getElementById('is-recurring');
            const recurringOptionsDiv = document.getElementById('recurring-options');
            const dateField = document.getElementById('date').closest('div');
            const timeField = document.getElementById('time').closest('div');
            const savingGoalField = document.getElementById('saving-goal-field');
            const savingGoalSelect = document.getElementById('saving-goal');

            // Reset visibility of recurring options
            if (isRecurring || recurringItem) {
                isRecurringCheckbox.checked = true;
                recurringOptionsDiv.classList.remove('hidden');
                dateField.classList.add('hidden');
                timeField.classList.add('hidden');
            } else {
                isRecurringCheckbox.checked = false;
                recurringOptionsDiv.classList.add('hidden');
                dateField.classList.remove('hidden');
                timeField.classList.remove('hidden');
            }

            const today = new Date();
            document.getElementById('date').valueAsDate = today;
            document.getElementById('time').value = today.toTimeString().slice(0, 5);
            document.getElementById('recurring-start-date').valueAsDate = today;
            
            // Default to income for new transaction if no type specified
            const currentType = transaction?.type || recurringItem?.type || document.querySelector('input[name="type"]:checked')?.value || 'income';
            document.querySelector(`input[name="type"][value="${currentType}"]`).checked = true;
            updateCategoryOptions(currentType); 
            updateAccountOptions();
            updateSavingGoalOptions(); // –ù–û–í–û–ï: –ó–∞–ø–æ–ª–Ω—è–µ–º —Ü–µ–ª–∏

            if (transaction) {
                document.getElementById('modal-title').textContent = '–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é';
                document.getElementById('transaction-id').value = transaction.id;
                document.getElementById('amount').value = transaction.amount;
                document.getElementById('date').value = transaction.date;
                document.getElementById('time').value = transaction.time || '00:00';
                document.getElementById('description').value = transaction.description;
                document.getElementById('category').value = transaction.category;
                document.getElementById('account').value = transaction.account;
                savingGoalSelect.value = transaction.savingGoalId || ''; // –ù–û–í–û–ï: –í—ã–±–∏—Ä–∞–µ–º –ø—Ä–∏–≤—è–∑–∞–Ω–Ω—É—é —Ü–µ–ª—å
            } else if (recurringItem) {
                document.getElementById('modal-title').textContent = '–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ–≤—Ç–æ—Ä—è—é—â—É—é—Å—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é';
                document.getElementById('transaction-id').value = recurringItem.id;
                document.getElementById('amount').value = recurringItem.amount;
                document.getElementById('description').value = recurringItem.description;
                document.getElementById('category').value = recurringItem.category;
                document.getElementById('account').value = recurringItem.account;
                
                document.getElementById('frequency').value = recurringItem.frequency;
                document.getElementById('recurring-start-date').value = recurringItem.startDate;
                document.getElementById('recurring-end-date').value = recurringItem.endDate || '';
                savingGoalSelect.value = recurringItem.savingGoalId || ''; // –ù–û–í–û–ï: –í—ã–±–∏—Ä–∞–µ–º –ø—Ä–∏–≤—è–∑–∞–Ω–Ω—É—é —Ü–µ–ª—å
            } else {
                document.getElementById('modal-title').textContent = '–ù–æ–≤–∞—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è';
            }

            // Show/hide saving goal field based on transaction type
            if (currentType === 'income') {
                savingGoalField.classList.remove('hidden');
            } else {
                savingGoalField.classList.add('hidden');
                savingGoalSelect.value = ''; // –°–±—Ä–æ—Å–∏—Ç—å –≤—ã–±–æ—Ä, –µ—Å–ª–∏ —Ç–∏–ø –Ω–µ –¥–æ—Ö–æ–¥
            }

            transactionModal.classList.remove('hidden');
            updateBodyScrollAndBlur();
        };

        const closeModals = () => {
            transactionModal.classList.add('hidden');
            viewModal.classList.add('hidden');
            confirmModal.classList.add('hidden');
            helpModal.classList.add('hidden'); // NEW: Hide help modal
            document.getElementById('date').closest('div').classList.remove('hidden');
            document.getElementById('time').closest('div').classList.remove('hidden');
            updateBodyScrollAndBlur(); // Call to properly remove overflow/blur
        };

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–∫–∞–∑–∞ –∫–∞—Å—Ç–æ–º–Ω–æ–≥–æ –æ–∫–Ω–∞ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è
        let confirmResolver;
        const showConfirmModal = (title, message) => {
            confirmModalTitle.textContent = title;
            confirmModalMessage.textContent = message;
            confirmModal.classList.remove('hidden');
            updateBodyScrollAndBlur();

            return new Promise(resolve => {
                confirmResolver = resolve;
            });
        };

        const handleConfirmAction = (result) => {
            closeModals();
            if (confirmResolver) {
                confirmResolver(result);
                confirmResolver = null;
            }
        };

        // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è/—Å–∫—Ä—ã—Ç–∏—è –∫–Ω–æ–ø–∫–∏ –û—Ç–º–µ–Ω–∏—Ç—å
        const showUndoButton = () => {
            clearTimeout(undoTimeoutId);
            undoContainer.classList.remove('opacity-0', 'scale-0', 'pointer-events-none');
            undoContainer.classList.add('opacity-100', 'scale-100', 'pointer-events-auto');

            undoTimeoutId = setTimeout(() => {
                hideUndoButton();
                lastDeletedItem = null; // –û—á–∏—â–∞–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è –æ—Ç–º–µ–Ω—ã, –µ—Å–ª–∏ –≤—Ä–µ–º—è –≤—ã—à–ª–æ
            }, UNDO_TIMEOUT_MS);
        };

        const hideUndoButton = () => {
            undoContainer.classList.remove('opacity-100', 'scale-100', 'pointer-events-auto');
            undoContainer.classList.add('opacity-0', 'scale-0', 'pointer-events-none');
            clearTimeout(undoTimeoutId);
        };

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–º–µ–Ω—ã –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ —É–¥–∞–ª–µ–Ω–∏—è
        const undoLastDeletion = () => {
            if (!lastDeletedItem) {
                showToast('–ù–µ—Ç –¥–µ–π—Å—Ç–≤–∏—è –¥–ª—è –æ—Ç–º–µ–Ω—ã.', 'info');
                return;
            }

            const { type, data } = lastDeletedItem;

            if (type === 'transaction') {
                transactions.push(data);
                showToast('–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è —É—Å–ø–µ—à–Ω–æ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞.', 'success');
            } else if (type === 'incomeCategory' || type === 'expenseCategory') {
                categories[data.type].push(data.category);
                showToast(`–ö–∞—Ç–µ–≥–æ—Ä–∏—è "${data.category.name}" —É—Å–ø–µ—à–Ω–æ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞.`, 'success');
            } else if (type === 'account') {
                accounts.push(data);
                showToast(`–°—á–µ—Ç "${data.name}" —É—Å–ø–µ—à–Ω–æ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω.`, 'success');
            } else if (type === 'recurringTransaction') {
                recurringTransactions.push(data);
                showToast(`–ü–æ–≤—Ç–æ—Ä—è—é—â–∞—è—Å—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è —É—Å–ø–µ—à–Ω–æ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞.`, 'success');
            } else if (type === 'savingGoal') { // –ù–û–í–û–ï: –û—Ç–º–µ–Ω–∞ —É–¥–∞–ª–µ–Ω–∏—è —Ü–µ–ª–∏
                savingGoals.push(data);
                showToast(`–¶–µ–ª—å "${data.name}" —É—Å–ø–µ—à–Ω–æ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞.`, 'success');
            }

            lastDeletedItem = null;
            hideUndoButton();
            saveData();
            renderAll();
        };

        // --- –ì–ª–æ–±–∞–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ (–¥–ª—è onclick) ---
        window.viewTransaction = (id) => {
            const t = transactions.find(t => t.id === id);
            if (!t) return;
            const isIncome = t.type === 'income';
            const categoryObj = getCategoryById(t.category, t.type);
            const accountObj = getAccountById(t.account);
            const savingGoalObj = t.savingGoalId ? getSavingGoalById(t.savingGoalId) : null; // –ù–û–í–û–ï: –¶–µ–ª—å

            document.getElementById('view-type').textContent = isIncome ? '–î–æ—Ö–æ–¥' : '–†–∞—Å—Ö–æ–¥';
            document.getElementById('view-type').className = `font-bold ${isIncome ? 'text-green-600' : 'text-red-600'}`;
            document.getElementById('view-amount').textContent = `${isIncome ? '+' : '-'} ${formatCurrency(t.amount)}`;
            document.getElementById('view-amount').className = `font-bold text-lg ${isIncome ? 'text-green-600' : 'text-red-600'}`;
            document.getElementById('view-category').innerHTML = `<i class="${categoryObj ? categoryObj.icon : 'fa-solid fa-tag'} mr-1"></i>${categoryObj ? categoryObj.name : '–ë–µ–∑ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏'}`;
            document.getElementById('view-account').textContent = accountObj ? accountObj.name : '–ë–µ–∑ —Å—á–µ—Ç–∞';
            document.getElementById('view-date').textContent = formatDate(t.date);
            document.getElementById('view-time').textContent = t.time || '–ù–µ —É–∫–∞–∑–∞–Ω–æ';
            document.getElementById('view-description').textContent = t.description || '–û–ø–∏—Å–∞–Ω–∏–µ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç.';
            
            // –ù–û–í–û–ï: –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ü–µ–ª–∏
            const viewSavingGoalRow = document.getElementById('view-saving-goal-row');
            const viewSavingGoal = document.getElementById('view-saving-goal');
            if (savingGoalObj) {
                viewSavingGoal.textContent = savingGoalObj.name;
                viewSavingGoalRow.classList.remove('hidden');
            } else {
                viewSavingGoalRow.classList.add('hidden');
            }

            viewModal.classList.remove('hidden');
            updateBodyScrollAndBlur();
        };

        window.editTransaction = (id) => {
            const transaction = transactions.find(t => t.id === id);
            if (transaction) openFormModal(transaction, false, null);
        };

        window.deleteTransaction = async (id) => {
            const confirmed = await showConfirmModal('–£–¥–∞–ª–∏—Ç—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é?', '–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç—É —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é? –ï—ë –º–æ–∂–Ω–æ –±—É–¥–µ—Ç –æ—Ç–º–µ–Ω–∏—Ç—å –≤ —Ç–µ—á–µ–Ω–∏–µ 10 —Å–µ–∫—É–Ω–¥.');
            if (confirmed) {
                const index = transactions.findIndex(t => t.id === id);
                if (index > -1) {
                    lastDeletedItem = { type: 'transaction', data: transactions[index] };
                    transactions.splice(index, 1);
                    saveData();
                    renderAll();
                    showToast('–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è —É—Å–ø–µ—à–Ω–æ —É–¥–∞–ª–µ–Ω–∞.', 'success');
                    showUndoButton();
                }
            } else {
                showToast('–£–¥–∞–ª–µ–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –æ—Ç–º–µ–Ω–µ–Ω–æ.', 'info');
            }
        };

        // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è –∫–∞—Ç–µ–≥–æ—Ä–∏–π
        window.addCategory = (type) => {
            const input = document.getElementById(`new-${type}-category-name`);
            const newCategoryName = input.value.trim();
            if (newCategoryName) {
                if (!categories[type].some(cat => cat.name === newCategoryName)) {
                    const newCategory = {
                        id: generateUniqueId(type.slice(0, 3)),
                        name: newCategoryName,
                        icon: 'fa-solid fa-tag', // –î–µ—Ñ–æ–ª—Ç–Ω–∞—è –∏–∫–æ–Ω–∫–∞
                        budget: type === 'expense' ? 0 : undefined 
                    };
                    categories[type].push(newCategory);
                    saveData();
                    renderCategories();
                    updateCategoryOptions('income'); 
                    updateCategoryOptions('expense');
                    showToast(`–ö–∞—Ç–µ–≥–æ—Ä–∏—è "${newCategoryName}" (${type === 'income' ? '–î–æ—Ö–æ–¥' : '–†–∞—Å—Ö–æ–¥'}) —É—Å–ø–µ—à–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω–∞.`, 'success');
                    input.value = '';
                } else {
                    showToast('–¢–∞–∫–∞—è –∫–∞—Ç–µ–≥–æ—Ä–∏—è —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç.', 'warning');
                }
            } else {
                showToast('–ù–∞–∑–≤–∞–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—É—Å—Ç—ã–º.', 'warning');
            }
        };

        window.deleteCategory = async (type, id) => {
            const categoryObj = getCategoryById(id, type);
            if (!categoryObj) return;

            if (transactions.some(t => t.category === id && t.type === type)) {
                showToast('–ù–µ–ª—å–∑—è —É–¥–∞–ª–∏—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é, —Ç–∞–∫ –∫–∞–∫ –æ–Ω–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è—Ö.', 'error');
                return;
            }
            if (recurringTransactions.some(rt => rt.category === id && rt.type === type)) {
                 showToast('–ù–µ–ª—å–∑—è —É–¥–∞–ª–∏—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é, —Ç–∞–∫ –∫–∞–∫ –æ–Ω–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ –ø–æ–≤—Ç–æ—Ä—è—é—â–∏—Ö—Å—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è—Ö.', 'error');
                 return;
            }

            const confirmed = await showConfirmModal('–£–¥–∞–ª–∏—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é?', `–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é "${categoryObj.name}"? –ï—ë –º–æ–∂–Ω–æ –±—É–¥–µ—Ç –æ—Ç–º–µ–Ω–∏—Ç—å –≤ —Ç–µ—á–µ–Ω–∏–µ 10 —Å–µ–∫—É–Ω–¥.`);
            if (confirmed) {
                const index = categories[type].findIndex(cat => cat.id === id);
                if (index > -1) {
                    lastDeletedItem = { type: type === 'income' ? 'incomeCategory' : 'expenseCategory', data: { type, category: categories[type][index] } };
                    categories[type].splice(index, 1);
                    saveData();
                    renderCategories();
                    updateCategoryOptions('income');
                    updateCategoryOptions('expense');
                    renderCharts(); // –û–±–Ω–æ–≤–ª—è–µ–º –≥—Ä–∞—Ñ–∏–∫–∏
                    showToast(`–ö–∞—Ç–µ–≥–æ—Ä–∏—è "${categoryObj.name}" —É—Å–ø–µ—à–Ω–æ —É–¥–∞–ª–µ–Ω–∞.`, 'success');
                    showUndoButton();
                }
            } else {
                showToast('–£–¥–∞–ª–µ–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –æ—Ç–º–µ–Ω–µ–Ω–æ.', 'info');
            }
        };

        window.updateCategoryBudget = (id, newBudget) => {
            const category = categories.expense.find(cat => cat.id === id);
            if (category) {
                const budgetValue = parseFloat(newBudget);
                if (!isNaN(budgetValue) && budgetValue >= 0) {
                    category.budget = budgetValue;
                    saveData();
                    renderBudgetSummary(); 
                    showToast(`–ë—é–¥–∂–µ—Ç –¥–ª—è "${category.name}" –æ–±–Ω–æ–≤–ª–µ–Ω –¥–æ ${formatCurrency(budgetValue)}.`, 'success', 1500);
                } else {
                    showToast('–ù–µ–≤–µ—Ä–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –±—é–¥–∂–µ—Ç–∞. –í–≤–µ–¥–∏—Ç–µ —á–∏—Å–ª–æ >= 0.', 'warning', 2000);
                }
            }
        };

        // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Å—á–µ—Ç–æ–≤
        window.addAccount = () => {
            const input = document.getElementById('new-account-name');
            const newAccountName = input.value.trim();
            if (newAccountName) {
                if (!accounts.some(acc => acc.name === newAccountName)) {
                    const newAccount = { id: generateUniqueId('acc'), name: newAccountName, balance: 0 };
                    accounts.push(newAccount);
                    saveData();
                    renderAccounts();
                    updateAccountOptions(); 
                    showToast(`–°—á–µ—Ç "${newAccountName}" —É—Å–ø–µ—à–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω.`, 'success');
                    input.value = '';
                } else {
                    showToast('–°—á–µ—Ç —Å —Ç–∞–∫–∏–º –Ω–∞–∑–≤–∞–Ω–∏–µ–º —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç.', 'warning');
                }
            } else {
                showToast('–ù–∞–∑–≤–∞–Ω–∏–µ —Å—á–µ—Ç–∞ –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—É—Å—Ç—ã–º.', 'warning');
            }
        };

        window.deleteAccount = async (id) => {
            const accountObj = getAccountById(id);
            if (!accountObj) return;

            if (transactions.some(t => t.account === id)) {
                showToast('–ù–µ–ª—å–∑—è —É–¥–∞–ª–∏—Ç—å —Å—á–µ—Ç, —Ç–∞–∫ –∫–∞–∫ –æ–Ω –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è—Ö.', 'error');
                return;
            }
            if (recurringTransactions.some(rt => rt.account === id)) {
                showToast('–ù–µ–ª—å–∑—è —É–¥–∞–ª–∏—Ç—å —Å—á–µ—Ç, —Ç–∞–∫ –∫–∞–∫ –æ–Ω –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ –ø–æ–≤—Ç–æ—Ä—è—é—â–∏—Ö—Å—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è—Ö.', 'error');
                return;
            }

            const confirmed = await showConfirmModal('–£–¥–∞–ª–∏—Ç—å —Å—á–µ—Ç?', `–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —Å—á–µ—Ç "${accountObj.name}"? –ï–≥–æ –º–æ–∂–Ω–æ –±—É–¥–µ—Ç –æ—Ç–º–µ–Ω–∏—Ç—å –≤ —Ç–µ—á–µ–Ω–∏–µ 10 —Å–µ–∫—É–Ω–¥.`);
            if (confirmed) {
                const index = accounts.findIndex(acc => acc.id === id);
                if (index > -1) {
                    lastDeletedItem = { type: 'account', data: accounts[index] };
                    accounts.splice(index, 1);
                    saveData();
                    renderAccounts();
                    updateAccountOptions();
                    renderAccountsSummary(); 
                    showToast(`–°—á–µ—Ç "${accountObj.name}" —É—Å–ø–µ—à–Ω–æ —É–¥–∞–ª–µ–Ω.`, 'success');
                    showUndoButton();
                }
            } else {
                showToast('–£–¥–∞–ª–µ–Ω–∏–µ —Å—á–µ—Ç–∞ –æ—Ç–º–µ–Ω–µ–Ω–æ.', 'info');
            }
        };

        // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è –ø–æ–≤—Ç–æ—Ä—è—é—â–∏—Ö—Å—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
        window.editRecurringTransaction = (id) => {
            const recurringItem = recurringTransactions.find(rt => rt.id === id);
            if (recurringItem) openFormModal(null, true, recurringItem);
        };

        window.deleteRecurringTransaction = async (id) => {
            const recurringItem = recurringTransactions.find(rt => rt.id === id);
            if (!recurringItem) return;

            const confirmed = await showConfirmModal('–£–¥–∞–ª–∏—Ç—å –ø–æ–≤—Ç–æ—Ä—è—é—â—É—é—Å—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é?', `–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —à–∞–±–ª–æ–Ω –¥–ª—è "${recurringItem.description || '–ë–µ–∑ –æ–ø–∏—Å–∞–Ω–∏—è'}"? –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –æ—Å—Ç–∞–Ω—É—Ç—Å—è. –ï—ë –º–æ–∂–Ω–æ –±—É–¥–µ—Ç –æ—Ç–º–µ–Ω–∏—Ç—å –≤ —Ç–µ—á–µ–Ω–∏–µ 10 —Å–µ–∫—É–Ω–¥.`);
            if (confirmed) {
                const index = recurringTransactions.findIndex(rt => rt.id === id);
                if (index > -1) {
                    lastDeletedItem = { type: 'recurringTransaction', data: recurringTransactions[index] };
                    recurringTransactions.splice(index, 1);
                    saveData();
                    renderRecurringTransactions();
                    showToast('–ü–æ–≤—Ç–æ—Ä—è—é—â–∞—è—Å—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è —É—Å–ø–µ—à–Ω–æ —É–¥–∞–ª–µ–Ω–∞.', 'success');
                    showUndoButton();
                }
            } else {
                showToast('–£–¥–∞–ª–µ–Ω–∏–µ –ø–æ–≤—Ç–æ—Ä—è—é—â–µ–π—Å—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –æ—Ç–º–µ–Ω–µ–Ω–æ.', 'info');
            }
        };

        // –ù–û–í–û–ï: –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ü–µ–ª–µ–π –Ω–∞–∫–æ–ø–ª–µ–Ω–∏—è
        window.addSavingGoal = () => {
            const nameInput = document.getElementById('new-saving-goal-name');
            const amountInput = document.getElementById('new-saving-goal-amount');
            const name = nameInput.value.trim();
            const targetAmount = parseFloat(amountInput.value);

            if (!name) { showToast('–ù–∞–∑–≤–∞–Ω–∏–µ —Ü–µ–ª–∏ –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—É—Å—Ç—ã–º.', 'warning'); return; }
            if (isNaN(targetAmount) || targetAmount <= 0) { showToast('–¶–µ–ª–µ–≤–∞—è —Å—É–º–º–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–º —á–∏—Å–ª–æ–º.', 'warning'); return; }
            if (savingGoals.some(goal => goal.name === name)) { showToast('–¶–µ–ª—å —Å —Ç–∞–∫–∏–º –Ω–∞–∑–≤–∞–Ω–∏–µ–º —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç.', 'warning'); return; }

            const newGoal = {
                id: generateUniqueId('SG'),
                name: name,
                targetAmount: targetAmount,
            };
            savingGoals.push(newGoal);
            saveData();
            renderSavingGoalsSettings();
            renderSavingGoalsSummary();
            updateSavingGoalOptions();
            showToast(`–¶–µ–ª—å "${name}" —É—Å–ø–µ—à–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω–∞.`, 'success');
            nameInput.value = '';
            amountInput.value = '';
        };

        window.editSavingGoal = async (id) => {
            const goal = getSavingGoalById(id);
            if (!goal) return;

            // Simple prompt for editing, could be a modal too
            const newName = prompt('–ù–æ–≤–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —Ü–µ–ª–∏:', goal.name);
            if (newName === null) return; // User cancelled
            const newAmountStr = prompt('–ù–æ–≤–∞—è —Ü–µ–ª–µ–≤–∞—è —Å—É–º–º–∞:', goal.targetAmount);
            if (newAmountStr === null) return; // User cancelled

            const newTargetAmount = parseFloat(newAmountStr);

            if (!newName.trim()) { showToast('–ù–∞–∑–≤–∞–Ω–∏–µ —Ü–µ–ª–∏ –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—É—Å—Ç—ã–º.', 'warning'); return; }
            if (isNaN(newTargetAmount) || newTargetAmount <= 0) { showToast('–¶–µ–ª–µ–≤–∞—è —Å—É–º–º–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–º —á–∏—Å–ª–æ–º.', 'warning'); return; }
            if (newName.trim() !== goal.name && savingGoals.some(g => g.name === newName.trim() && g.id !== goal.id)) {
                showToast('–¶–µ–ª—å —Å —Ç–∞–∫–∏–º –Ω–∞–∑–≤–∞–Ω–∏–µ–º —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç.', 'warning');
                return;
            }

            goal.name = newName.trim();
            goal.targetAmount = newTargetAmount;
            saveData();
            renderSavingGoalsSettings();
            renderSavingGoalsSummary();
            updateSavingGoalOptions();
            showToast(`–¶–µ–ª—å "${goal.name}" —É—Å–ø–µ—à–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∞.`, 'success');
        };

        window.deleteSavingGoal = async (id) => {
            const goal = getSavingGoalById(id);
            if (!goal) return;

            if (transactions.some(t => t.savingGoalId === id)) {
                showToast('–ù–µ–ª—å–∑—è —É–¥–∞–ª–∏—Ç—å —Ü–µ–ª—å, —Ç–∞–∫ –∫–∞–∫ –æ–Ω–∞ –ø—Ä–∏–≤—è–∑–∞–Ω–∞ –∫ –æ–¥–Ω–æ–π –∏–ª–∏ –Ω–µ—Å–∫–æ–ª—å–∫–∏–º —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è–º.', 'error');
                return;
            }
            if (recurringTransactions.some(rt => rt.savingGoalId === id)) {
                showToast('–ù–µ–ª—å–∑—è —É–¥–∞–ª–∏—Ç—å —Ü–µ–ª—å, —Ç–∞–∫ –∫–∞–∫ –æ–Ω–∞ –ø—Ä–∏–≤—è–∑–∞–Ω–∞ –∫ –ø–æ–≤—Ç–æ—Ä—è—é—â–∏–º—Å—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è–º.', 'error');
                return;
            }

            const confirmed = await showConfirmModal('–£–¥–∞–ª–∏—Ç—å —Ü–µ–ª—å?', `–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —Ü–µ–ª—å –Ω–∞–∫–æ–ø–ª–µ–Ω–∏—è "${goal.name}"? –ï—ë –º–æ–∂–Ω–æ –±—É–¥–µ—Ç –æ—Ç–º–µ–Ω–∏—Ç—å –≤ —Ç–µ—á–µ–Ω–∏–µ 10 —Å–µ–∫—É–Ω–¥.`);
            if (confirmed) {
                const index = savingGoals.findIndex(g => g.id === id);
                if (index > -1) {
                    lastDeletedItem = { type: 'savingGoal', data: savingGoals[index] };
                    savingGoals.splice(index, 1);
                    saveData();
                    renderSavingGoalsSettings();
                    renderSavingGoalsSummary();
                    updateSavingGoalOptions();
                    showToast(`–¶–µ–ª—å "${goal.name}" —É—Å–ø–µ—à–Ω–æ —É–¥–∞–ª–µ–Ω–∞.`, 'success');
                    showUndoButton();
                }
            } else {
                showToast('–£–¥–∞–ª–µ–Ω–∏–µ —Ü–µ–ª–∏ –æ—Ç–º–µ–Ω–µ–Ω–æ.', 'info');
            }
        };

        window.exportData = () => {
            const dataStr = JSON.stringify({ transactions, categories, accounts, recurringTransactions, savingGoals }, null, 2);
            const blob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `budget_backup_${new Date().toISOString().slice(0, 10)}.json`;
            showToast('–î–∞–Ω–Ω—ã–µ —É—Å–ø–µ—à–Ω–æ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã.', 'success'); // –ü–µ—Ä–µ–º–µ—â–µ–Ω–æ —Å—é–¥–∞
            a.click();
            URL.revokeObjectURL(url);
        };

        // --- –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Å–µ–ª–µ–∫—Ç–æ–≤ ---
        const updateCategoryOptions = (typeForFormModal) => { 
            const selectFormCategory = document.getElementById('category'); 
            const selectFilterCategory = document.getElementById('filter-category'); 

            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ select –¥–ª—è —Ñ–æ—Ä–º—ã –¥–æ–±–∞–≤–ª–µ–Ω–∏—è/—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
            selectFormCategory.innerHTML = '';
            const categoriesForForm = categories[typeForFormModal];

            if (categoriesForForm.length === 0) {
                selectFormCategory.add(new Option('–ù–µ—Ç –∫–∞—Ç–µ–≥–æ—Ä–∏–π', '', true, true));
                selectFormCategory.lastChild.disabled = true;
            } else {
                categoriesForForm.forEach(cat => {
                    selectFormCategory.add(new Option(cat.name, cat.id));
                });
            }

            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ select –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
            if (selectFilterCategory) {
                const currentFilterCategory = selectFilterCategory.value; 
                selectFilterCategory.innerHTML = '<option value="all">–í—Å–µ</option>'; 

                categories.income.forEach(cat => {
                    selectFilterCategory.add(new Option(`${cat.name} (–î–æ—Ö–æ–¥)`, cat.id));
                });

                categories.expense.forEach(cat => {
                    selectFilterCategory.add(new Option(`${cat.name} (–†–∞—Å—Ö–æ–¥)`, cat.id));
                });

                // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≤—ã–±—Ä–∞–Ω–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ, –µ—Å–ª–∏ –æ–Ω–æ –≤—Å–µ –µ—â–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
                if (selectFilterCategory.querySelector(`option[value="${currentFilterCategory}"]`)) {
                    selectFilterCategory.value = currentFilterCategory; 
                } else {
                    selectFilterCategory.value = 'all'; // –°–±—Ä–∞—Å—ã–≤–∞–µ–º, –µ—Å–ª–∏ –≤—ã–±—Ä–∞–Ω–Ω–∞—è –∫–∞—Ç–µ–≥–æ—Ä–∏—è –±—ã–ª–∞ —É–¥–∞–ª–µ–Ω–∞
                }
            }
        };

        const updateAccountOptions = () => {
            const select = document.getElementById('account');
            const filterSelect = document.getElementById('filter-account');

            const currentFormAccount = select ? select.value : '';
            const currentFilterAccount = filterSelect ? filterSelect.value : 'all';

            select.innerHTML = '';
            if (filterSelect) {
                filterSelect.innerHTML = '<option value="all">–í—Å–µ</option>';
            }

            if (accounts.length === 0) {
                select.add(new Option('–ù–µ—Ç —Å—á–µ—Ç–æ–≤', '', true, true));
                select.lastChild.disabled = true;
            } else {
                accounts.forEach(acc => {
                    select.add(new Option(acc.name, acc.id));
                });
            }

            if (filterSelect) {
                accounts.forEach(acc => {
                    filterSelect.add(new Option(acc.name, acc.id));
                });
                // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≤—ã–±—Ä–∞–Ω–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ
                if (filterSelect.querySelector(`option[value="${currentFilterAccount}"]`)) {
                    filterSelect.value = currentFilterAccount;
                } else {
                    filterSelect.value = 'all';
                }
            }
            // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≤—ã–±—Ä–∞–Ω–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –¥–ª—è —Ñ–æ—Ä–º—ã
            if (select.querySelector(`option[value="${currentFormAccount}"]`)) {
                select.value = currentFormAccount;
            } else {
                select.selectedIndex = 0; // –í—ã–±–∏—Ä–∞–µ–º –ø–µ—Ä–≤—ã–π –¥–æ—Å—Ç—É–ø–Ω—ã–π –∏–ª–∏ "–ù–µ—Ç —Å—á–µ—Ç–æ–≤"
            }
        };

        // –ù–û–í–û–ï: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ–ø—Ü–∏–π –≤—ã–±–æ—Ä–∞ —Ü–µ–ª–∏ –Ω–∞–∫–æ–ø–ª–µ–Ω–∏—è –≤ —Ñ–æ—Ä–º–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
        const updateSavingGoalOptions = () => {
            const select = document.getElementById('saving-goal');
            select.innerHTML = '<option value="">–ù–µ –ø—Ä–∏–≤—è–∑—ã–≤–∞—Ç—å</option>'; // Default option

            if (savingGoals.length === 0) {
                // –ï—Å–ª–∏ –Ω–µ—Ç —Ü–µ–ª–µ–π, –Ω–µ –¥–æ–±–∞–≤–ª—è–µ–º –∑–∞–≥–ª—É—à–∫—É, –ø—Ä–æ—Å—Ç–æ "–ù–µ –ø—Ä–∏–≤—è–∑—ã–≤–∞—Ç—å"
            } else {
                savingGoals.forEach(goal => {
                    select.add(new Option(goal.name, goal.id));
                });
            }
        };

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω—ã—Ö —Å—Å—ã–ª–æ–∫ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
        const updateNavLinks = (hash) => {
            // –°–±—Ä–æ—Å–∏—Ç—å –≤—Å–µ –∞–∫—Ç–∏–≤–Ω—ã–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è
            document.querySelectorAll('.nav-link, .nav-link-mobile').forEach(link => {
                link.classList.remove('active', 'active-parent', 'dropdown-expanded');
                const chevron = link.querySelector('.fas.fa-chevron-down');
                if (chevron) chevron.classList.remove('rotate-180');
            });
            document.querySelectorAll('.nav-dropdown-content').forEach(dropdown => {
                dropdown.classList.remove('open');
            });

            const currentActiveLink = document.querySelector(`[href="${hash}"]`);
            
            if (currentActiveLink) {
                currentActiveLink.classList.add('active'); // –ê–∫—Ç–∏–≤–∏—Ä—É–µ–º –≤—ã–±—Ä–∞–Ω–Ω—É—é —Å—Å—ã–ª–∫—É

                const parentDropdownToggle = currentActiveLink.closest('.nav-dropdown-toggle') || currentActiveLink.closest('.nav-dropdown-toggle-mobile');
                if (parentDropdownToggle) {
                    const parentLink = parentDropdownToggle.querySelector('a'); // –°—Å—ã–ª–∫–∞ "–û–±–∑–æ—Ä"
                    if (parentLink) {
                        parentLink.classList.add('active-parent', 'dropdown-expanded'); // –ü–æ–¥—Å–≤–µ—á–∏–≤–∞–µ–º —Ä–æ–¥–∏—Ç–µ–ª—è –∏ –ø–æ–º–µ—á–∞–µ–º –∫–∞–∫ –æ—Ç–∫—Ä—ã—Ç—ã–π
                        const chevron = parentLink.querySelector('.fas.fa-chevron-down');
                        if (chevron) chevron.classList.add('rotate-180');
                    }
                    const dropdownContent = parentDropdownToggle.querySelector('.nav-dropdown-content');
                    if (dropdownContent) dropdownContent.classList.add('open'); // –û—Ç–∫—Ä—ã–≤–∞–µ–º –≤—ã–ø–∞–¥–∞—é—â–µ–µ –º–µ–Ω—é
                }
            } else {
                // –ï—Å–ª–∏ –Ω–µ—Ç —Ç–æ—á–Ω–æ–≥–æ —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã —Å #dashboard, –Ω–æ –±–µ–∑ –ø–æ–¥–ø—É–Ω–∫—Ç–∞),
                // —É–±–µ–¥–∏–º—Å—è, —á—Ç–æ #dashboard –∞–∫—Ç–∏–≤–µ–Ω –∏ –µ–≥–æ –¥—Ä–æ–ø–¥–∞—É–Ω –æ—Ç–∫—Ä—ã—Ç –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é.
                const dashboardLinkDesktop = document.getElementById('dashboard-toggle-desktop');
                const dashboardLinkMobile = document.getElementById('dashboard-toggle-mobile');

                // hash === '' —á–∞—Å—Ç–æ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –±–µ–∑ —Ö–µ—à–∞, —Å—á–∏—Ç–∞–µ–º —ç—Ç–æ #dashboard
                if (hash === '#dashboard' || hash === '') { 
                    [dashboardLinkDesktop, dashboardLinkMobile].forEach(link => {
                        if (link) {
                            link.classList.add('active', 'active-parent', 'dropdown-expanded'); 
                            const chevron = link.querySelector('.fas.fa-chevron-down');
                            if (chevron) chevron.classList.add('rotate-180');
                            const dropdownContent = link.nextElementSibling;
                            if (dropdownContent) dropdownContent.classList.add('open'); 
                        }
                    });
                }
            }
        };

        // --- –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è –ø–∞–≥–∏–Ω–∞—Ü–∏–∏ ---
        const goToPage = (pageIndex) => {
            currentPage = pageIndex;
            renderTransactions();
        };

        const nextPage = () => {
            let filteredTransactionsCount = transactions.filter(t => {
                // –ò–∑–º–µ–Ω–µ–Ω–æ: —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –¥–æ–ª–∂–Ω–∞ —É—á–∏—Ç—ã–≤–∞—Ç—å —Ç–∏–ø –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
                const categoryTypeMap = [...categories.income, ...categories.expense].reduce((acc, cat) => {
                    acc[cat.id] = cat.budget !== undefined ? 'expense' : 'income'; // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ç–∏–ø –ø–æ –Ω–∞–ª–∏—á–∏—é budget
                    return acc;
                }, {});

                const typeMatch = currentFilters.type === 'all' || t.type === currentFilters.type;
                const categoryMatch = currentFilters.category === 'all' || (t.category === currentFilters.category && t.type === categoryTypeMap[currentFilters.category]);
                const accountMatch = currentFilters.account === 'all' || t.account === currentFilters.account;
                const descriptionMatch = !currentFilters.description || (t.description && t.description.toLowerCase().includes(currentFilters.description.toLowerCase()));
                const amountMinMatch = currentFilters.amountMin === null || parseFloat(t.amount) >= currentFilters.amountMin;
                const amountMaxMatch = currentFilters.amountMax === null || parseFloat(t.amount) <= currentFilters.amountMax;
                const dateStartMatch = !currentFilters.dateStart || t.date >= currentFilters.dateStart;
                const dateEndMatch = !currentFilters.dateEnd || t.date <= currentFilters.dateEnd;

                return typeMatch && categoryMatch && accountMatch && descriptionMatch && amountMinMatch && amountMaxMatch && dateStartMatch && dateEndMatch;
            }).length;

            const totalPages = Math.ceil(filteredTransactionsCount / transactionsPerPage);

            if (currentPage < totalPages - 1) {
                goToPage(currentPage + 1);
            }
        };

        const prevPage = () => {
            if (currentPage > 0) {
                goToPage(currentPage - 1);
            }
        };

        // –†–µ–Ω–¥–µ—Ä–∏–Ω–≥ –∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ñ–∏–ª—å—Ç—Ä–æ–≤ –¥–ª—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
        const renderTransactionFilters = () => {
            updateCategoryOptions('income'); // –ü–µ—Ä–µ–¥–∞–µ–º 'income' –∏–ª–∏ 'expense', –Ω–æ –¥–ª—è filter-category –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã –æ–±–µ
            updateAccountOptions();

            document.getElementById('filter-type').value = currentFilters.type;
            document.getElementById('filter-description').value = currentFilters.description;
            document.getElementById('filter-amount-min').value = currentFilters.amountMin || '';
            document.getElementById('filter-amount-max').value = currentFilters.amountMax || '';
            document.getElementById('filter-date-start').value = currentFilters.dateStart || '';
            document.getElementById('filter-date-end').value = currentFilters.dateEnd || '';
            document.getElementById('sort-order').value = currentFilters.sortOrder;
        };

        const applyFilters = () => {
            currentFilters.type = document.getElementById('filter-type').value;
            currentFilters.category = document.getElementById('filter-category').value;
            currentFilters.account = document.getElementById('filter-account').value;
            currentFilters.description = document.getElementById('filter-description').value.trim();
            currentFilters.amountMin = parseFloat(document.getElementById('filter-amount-min').value) || null;
            currentFilters.amountMax = parseFloat(document.getElementById('filter-amount-max').value) || null;
            currentFilters.dateStart = document.getElementById('filter-date-start').value;
            currentFilters.dateEnd = document.getElementById('filter-date-end').value;
            currentFilters.sortOrder = document.getElementById('sort-order').value;
            currentPage = 0; 
            renderTransactions();
        };

        const resetAllFilters = () => {
            currentFilters = {
                type: 'all',
                category: 'all',
                account: 'all',
                description: '',
                amountMin: null,
                amountMax: null,
                dateStart: null,
                dateEnd: null,
                sortOrder: 'date-desc'
            };
            renderTransactionFilters(); 
            applyFilters(); 
            showToast('–í—Å–µ —Ñ–∏–ª—å—Ç—Ä—ã —Å–±—Ä–æ—à–µ–Ω—ã.', 'info');
        };

        // --- –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ —Å–æ–±—ã—Ç–∏–π ---
        const setupEventListeners = () => {
            // –ú–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞
            document.getElementById('add-transaction-btn').addEventListener('click', () => openFormModal());
            document.getElementById('close-modal-btn').addEventListener('click', closeModals);
            document.getElementById('close-view-modal-btn').addEventListener('click', closeModals);
            transactionModal.addEventListener('click', e => e.target === transactionModal && closeModals());
            viewModal.addEventListener('click', e => e.target === viewModal && closeModals());
            confirmOkBtn.addEventListener('click', () => handleConfirmAction(true));
            confirmCancelBtn.addEventListener('click', () => handleConfirmAction(false));
            confirmModal.addEventListener('click', e => e.target === confirmModal && handleConfirmAction(false));

            // NEW: Help Modal handlers
            openHelpModalBtn.addEventListener('click', () => {
                helpModal.classList.remove('hidden');
                updateBodyScrollAndBlur();
            });
            closeHelpModalBtn.addEventListener('click', closeModals);
            helpModal.addEventListener('click', e => e.target === helpModal && closeModals());

            // –ö–Ω–æ–ø–∫–∞ –û—Ç–º–µ–Ω–∏—Ç—å
            undoBtn.addEventListener('click', undoLastDeletion);

            // –ú–æ–±–∏–ª—å–Ω–æ–µ –º–µ–Ω—é
            document.getElementById('open-mobile-menu-btn').addEventListener('click', () => toggleMobileMenu(true));
            document.getElementById('close-mobile-menu-btn').addEventListener('click', () => toggleMobileMenu(false));
            mobileMenuOverlay.addEventListener('click', () => toggleMobileMenu(false));
            
            // –ù–û–í–û–ï: –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –º–æ–±–∏–ª—å–Ω–æ–≥–æ –≤—ã–ø–∞–¥–∞—é—â–µ–≥–æ –º–µ–Ω—é (–û–±–∑–æ—Ä)
            document.querySelector('#mobile-menu .nav-dropdown-toggle-mobile > a').addEventListener('click', (e) => {
                const link = e.currentTarget;
                const dropdownContent = link.nextElementSibling;
                const chevronIcon = link.querySelector('.fas.fa-chevron-down');
                
                const isExpanded = link.classList.contains('dropdown-expanded');
                
                // –°–Ω–∞—á–∞–ª–∞ —Å–±—Ä–∞—Å—ã–≤–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –≤—Å–µ—Ö –∞–∫—Ç–∏–≤–Ω—ã—Ö —Å—Å—ã–ª–æ–∫ –∏ –æ—Ç–∫—Ä—ã—Ç—ã—Ö –¥—Ä–æ–ø–¥–∞—É–Ω–æ–≤ –≤ –º–æ–±–∏–ª—å–Ω–æ–º –º–µ–Ω—é
                document.querySelectorAll('#mobile-menu nav a').forEach(navLink => {
                    // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º —Å—Å—ã–ª–∫—É, –Ω–∞ –∫–æ—Ç–æ—Ä—É—é —Ç–æ–ª—å–∫–æ —á—Ç–æ –∫–ª–∏–∫–Ω—É–ª–∏, –µ—Å–ª–∏ –æ–Ω–∞ —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–∞—è
                    if (navLink === link) return; 
                    navLink.classList.remove('active', 'active-parent', 'dropdown-expanded');
                    const navChevron = navLink.querySelector('.fas.fa-chevron-down');
                    if(navChevron) navChevron.classList.remove('rotate-180');
                });
                document.querySelectorAll('#mobile-menu .nav-dropdown-content').forEach(content => {
                    // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –∫–æ–Ω—Ç–µ–Ω—Ç, –∫–æ—Ç–æ—Ä—ã–π –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–∏—Ç –∫–ª–∏–∫–Ω—É–≤—à–µ–π —Å—Å—ã–ª–∫–µ
                    if (content === dropdownContent) return;
                    content.classList.remove('open');
                });

                if (!isExpanded) { // –ï—Å–ª–∏ –º–µ–Ω—é –±—ã–ª–æ –∑–∞–∫—Ä—ã—Ç–æ, —Ç–µ–ø–µ—Ä—å –æ—Ç–∫—Ä—ã–≤–∞–µ–º –µ–≥–æ
                    link.classList.add('dropdown-expanded', 'active-parent'); // –î–æ–±–∞–≤–ª—è–µ–º –∫–ª–∞—Å—Å—ã
                    if (dropdownContent) dropdownContent.classList.add('open');
                    if (chevronIcon) chevronIcon.classList.add('rotate-180');
                    e.preventDefault(); // –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ–º –Ω–∞–≤–∏–≥–∞—Ü–∏—é –ø–æ —è–∫–æ—Ä—é #dashboard, —á—Ç–æ–±—ã –º–µ–Ω—é –æ—Å—Ç–∞–ª–æ—Å—å –æ—Ç–∫—Ä—ã—Ç—ã–º
                    updateNavLinks(link.getAttribute('href')); // –û–±–Ω–æ–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—ã–µ —Å—Å—ã–ª–∫–∏
                } else { // –ï—Å–ª–∏ –º–µ–Ω—é –±—ã–ª–æ –æ—Ç–∫—Ä—ã—Ç–æ, —Ç–µ–ø–µ—Ä—å –∑–∞–∫—Ä—ã–≤–∞–µ–º –µ–≥–æ
                    // –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∏–º–∞–µ—Ç –Ω–∞ —É–∂–µ –æ—Ç–∫—Ä—ã—Ç—ã–π "–û–±–∑–æ—Ä", —á—Ç–æ–±—ã –µ–≥–æ –∑–∞–∫—Ä—ã—Ç—å
                    // updateNavLinks(''), —á—Ç–æ–±—ã —Å–Ω—è—Ç—å –≤—Å–µ –∞–∫—Ç–∏–≤–Ω—ã–µ –∫–ª–∞—Å—Å—ã –∏ –∑–∞–∫—Ä—ã—Ç—å –¥—Ä–æ–ø–¥–∞—É–Ω
                    updateNavLinks(''); 
                }
            });

            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –≤—Å–µ—Ö –æ–±—ã—á–Ω—ã—Ö —Å—Å—ã–ª–æ–∫ –∏ –ø–æ–¥—Å—Å—ã–ª–æ–∫ –≤ –º–æ–±–∏–ª—å–Ω–æ–º –º–µ–Ω—é
            document.querySelectorAll('#mobile-menu nav a:not(.nav-dropdown-toggle-mobile > a)').forEach(link => {
                link.addEventListener('click', (e) => {
                    updateNavLinks(e.currentTarget.getAttribute('href')); // –û–±–Ω–æ–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—ã–µ —Å—Å—ã–ª–∫–∏
                    toggleMobileMenu(false); // –ó–∞–∫—Ä—ã–≤–∞–µ–º –º–æ–±–∏–ª—å–Ω–æ–µ –º–µ–Ω—é –ø–æ—Å–ª–µ –≤—ã–±–æ—Ä–∞ —Å—Å—ã–ª–∫–∏
                });
            });

            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –¥–µ—Å–∫—Ç–æ–ø–Ω–æ–≥–æ –≤—ã–ø–∞–¥–∞—é—â–µ–≥–æ –º–µ–Ω—é (–û–±–∑–æ—Ä) - —Ç–æ–ª—å–∫–æ –¥–ª—è –ø–æ–¥–ø—É–Ω–∫—Ç–æ–≤
            document.querySelectorAll('aside .nav-dropdown-toggle .nav-dropdown-content a').forEach(link => {
                link.addEventListener('click', (e) => {
                    updateNavLinks(e.currentTarget.getAttribute('href'));
                });
            });

            // –§–æ—Ä–º–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
            transactionForm.addEventListener('submit', e => {
                e.preventDefault();
                const id = document.getElementById('transaction-id').value;
                const type = document.querySelector('input[name="type"]:checked').value;
                const amount = document.getElementById('amount').value;
                const category = document.getElementById('category').value;
                const account = document.getElementById('account').value;
                const date = document.getElementById('date').value;
                const time = document.getElementById('time').value;
                const description = document.getElementById('description').value;
                const isRecurringCheckbox = document.getElementById('is-recurring').checked;
                const isRecurringEdit = document.getElementById('is-recurring-edit').value === 'true';
                const savingGoalId = document.getElementById('saving-goal').value || undefined; // –ù–û–í–û–ï: –ü–æ–ª—É—á–∞–µ–º ID —Ü–µ–ª–∏

                if (!category) { showToast('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ –∏–ª–∏ —Å–æ–∑–¥–∞–π—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é.', 'warning'); return; }
                if (accounts.length > 0 && !account) { showToast('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ —Å—á–µ—Ç.', 'warning'); return; }

                if (isRecurringCheckbox || isRecurringEdit) {
                    const frequency = document.getElementById('frequency').value;
                    const recurringStartDate = document.getElementById('recurring-start-date').value;
                    const recurringEndDate = document.getElementById('recurring-end-date').value || null;

                    if (!recurringStartDate) { showToast('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —É–∫–∞–∂–∏—Ç–µ –¥–∞—Ç—É –Ω–∞—á–∞–ª–∞ –¥–ª—è –ø–æ–≤—Ç–æ—Ä—è—é—â–µ–π—Å—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏.', 'warning'); return; }

                    const newRecurring = {
                        id: id || generateUniqueId('RT'),
                        type, amount, category, account, description, frequency,
                        startDate: recurringStartDate,
                        endDate: recurringEndDate,
                        lastGeneratedDate: id ? recurringTransactions.find(rt => rt.id === id)?.lastGeneratedDate : null,
                        time: time,
                        savingGoalId: savingGoalId // –ù–û–í–û–ï: –°–æ—Ö—Ä–∞–Ω—è–µ–º ID —Ü–µ–ª–∏ –¥–ª—è –ø–æ–≤—Ç–æ—Ä—è—é—â–µ–π—Å—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
                    };

                    if (id && isRecurringEdit) {
                        recurringTransactions = recurringTransactions.map(rt => rt.id === id ? newRecurring : rt);
                        showToast('–ü–æ–≤—Ç–æ—Ä—è—é—â–∞—è—Å—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è —É—Å–ø–µ—à–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∞.', 'success');
                    } else {
                        recurringTransactions.push(newRecurring);
                        showToast('–ü–æ–≤—Ç–æ—Ä—è—é—â–∞—è—Å—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è —É—Å–ø–µ—à–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω–∞.', 'success');
                    }
                } else { 
                    const newTransaction = {
                        id: id || generateUniqueId('T'),
                        type, amount, category, account, date, time, description,
                        savingGoalId: savingGoalId // –ù–û–í–û–ï: –°–æ—Ö—Ä–∞–Ω—è–µ–º ID —Ü–µ–ª–∏ –¥–ª—è –æ–±—ã—á–Ω–æ–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
                    };

                    if (id) {
                        transactions = transactions.map(t => t.id === id ? newTransaction : t);
                        showToast('–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è —É—Å–ø–µ—à–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∞.', 'success');
                    } else {
                        transactions.push(newTransaction);
                        showToast('–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è —É—Å–ø–µ—à–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω–∞.', 'success');
                    }
                }
                saveData();
                renderAll();
                closeModals();
            });

            document.querySelectorAll('input[name="type"]').forEach(radio => {
                radio.addEventListener('change', e => {
                    updateCategoryOptions(e.target.value);
                    // –ù–û–í–û–ï: –ü–æ–∫–∞–∑—ã–≤–∞–µ–º/—Å–∫—Ä—ã–≤–∞–µ–º –ø–æ–ª–µ —Ü–µ–ª–∏ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–∏–ø–∞
                    const savingGoalField = document.getElementById('saving-goal-field');
                    if (e.target.value === 'income') {
                        savingGoalField.classList.remove('hidden');
                        updateSavingGoalOptions(); // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫ —Ü–µ–ª–µ–π
                    } else {
                        savingGoalField.classList.add('hidden');
                        document.getElementById('saving-goal').value = ''; // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –≤—ã–±–æ—Ä
                    }
                });
            });

            document.getElementById('is-recurring').addEventListener('change', (e) => {
                const recurringOptionsDiv = document.getElementById('recurring-options');
                const dateField = document.getElementById('date').closest('div');
                const timeField = document.getElementById('time').closest('div');

                if (e.target.checked) {
                    recurringOptionsDiv.classList.remove('hidden');
                    dateField.classList.add('hidden');
                    timeField.classList.add('hidden');
                } else {
                    recurringOptionsDiv.classList.add('hidden');
                    dateField.classList.remove('hidden');
                    timeField.classList.remove('hidden');
                }
            });

            // –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã –∏ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞
            document.getElementById('filter-type').addEventListener('change', applyFilters);
            document.getElementById('filter-category').addEventListener('change', applyFilters);
            document.getElementById('filter-account').addEventListener('change', applyFilters);
            document.getElementById('filter-description').addEventListener('input', applyFilters);
            document.getElementById('filter-amount-min').addEventListener('input', applyFilters);
            document.getElementById('filter-amount-max').addEventListener('input', applyFilters);
            document.getElementById('filter-date-start').addEventListener('change', applyFilters);
            document.getElementById('filter-date-end').addEventListener('change', applyFilters);
            document.getElementById('sort-order').addEventListener('change', applyFilters);
            document.getElementById('reset-filters-btn').addEventListener('click', resetAllFilters);

            // –ö–Ω–æ–ø–∫–∏ –ø–∞–≥–∏–Ω–∞—Ü–∏–∏
            document.getElementById('prev-page-btn').addEventListener('click', prevPage);
            document.getElementById('next-page-btn').addEventListener('click', nextPage);

            // Swipe Logic for Pagination
            const transactionListElement = document.getElementById('transaction-list');
            let touchStartX = 0; let touchStartY = 0; const swipeThreshold = 75; const verticalTolerance = 50;
            transactionListElement.addEventListener('touchstart', (e) => { if (e.touches.length === 1) { touchStartX = e.touches[0].clientX; touchStartY = e.touches[0].clientY; } }, { passive: true });
            transactionListElement.addEventListener('touchend', (e) => {
                if (e.changedTouches.length === 1) {
                    const touchEndX = e.changedTouches[0].clientX; const touchEndY = e.changedTouches[0].clientY;
                    const diffX = touchEndX - touchStartX; const diffY = touchEndY - touchStartY;
                    if (Math.abs(diffX) > swipeThreshold && Math.abs(diffY) < verticalTolerance) { diffX > 0 ? prevPage() : nextPage(); }
                }
            });

            // --- –ù–æ–≤—ã–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è —Ç–∏–ø–æ–≤ –¥–∏–∞–≥—Ä–∞–º–º ---
            document.getElementById('show-pie-chart-btn').addEventListener('click', () => { 
                currentChartType = 'pie'; 
                renderCharts(); 
                showToast('–ü–æ–∫–∞–∑–∞–Ω–∞ –∫—Ä—É–≥–æ–≤–∞—è –¥–∏–∞–≥—Ä–∞–º–º–∞ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º.', 'info');
            });
            document.getElementById('show-monthly-bar-chart-btn').addEventListener('click', () => { 
                currentChartType = 'monthlyBar'; 
                renderCharts(); 
                showToast('–ü–æ–∫–∞–∑–∞–Ω–∞ —Å—Ç–æ–ª–±—á–∞—Ç–∞—è –¥–∏–∞–≥—Ä–∞–º–º–∞ –¥–æ—Ö–æ–¥–æ–≤ –∏ —Ä–∞—Å—Ö–æ–¥–æ–≤ –ø–æ –º–µ—Å—è—Ü–∞–º.', 'info');
            });
            document.getElementById('show-balance-line-chart-btn').addEventListener('click', () => { 
                currentChartType = 'balanceLine'; 
                renderCharts(); 
                showToast('–ü–æ–∫–∞–∑–∞–Ω–∞ –ª–∏–Ω–µ–π–Ω–∞—è –¥–∏–∞–≥—Ä–∞–º–º–∞ –¥–∏–Ω–∞–º–∏–∫–∏ –±–∞–ª–∞–Ω—Å–∞.', 'info');
            });
            document.getElementById('show-cumulative-area-chart-btn').addEventListener('click', () => { 
                currentChartType = 'cumulativeArea'; 
                renderCharts(); 
                showToast('–ü–æ–∫–∞–∑–∞–Ω–∞ –¥–∏–∞–≥—Ä–∞–º–º–∞ –∫—É–º—É–ª—è—Ç–∏–≤–Ω—ã—Ö —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã—Ö –ø–æ—Ç–æ–∫–æ–≤.', 'info');
            });

            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –ø–æ–¥-–ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—è –∫–∞—Ç–µ–≥–æ—Ä–∏–π–Ω–æ–π –¥–∏–∞–≥—Ä–∞–º–º—ã (—Ä–∞—Å—Ö–æ–¥—ã/–¥–æ—Ö–æ–¥—ã)
            document.getElementById('show-category-expense-btn').addEventListener('click', () => {
                if (currentCategoryChartDataType !== 'expense') {
                    currentCategoryChartDataType = 'expense';
                    renderCategoryPieChart('expense');
                    updateChartTypeButtons();
                    showToast('–ü–æ–∫–∞–∑–∞–Ω—ã —Ä–∞—Å—Ö–æ–¥—ã –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º.', 'info');
                    document.getElementById('chart-section-title').textContent = '–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ä–∞—Å—Ö–æ–¥–æ–≤ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º';
                }
            });
            document.getElementById('show-category-income-btn').addEventListener('click', () => {
                if (currentCategoryChartDataType !== 'income') {
                    currentCategoryChartDataType = 'income';
                    renderCategoryPieChart('income');
                    updateChartTypeButtons();
                    showToast('–ü–æ–∫–∞–∑–∞–Ω—ã –¥–æ—Ö–æ–¥—ã –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º.', 'info');
                    document.getElementById('chart-section-title').textContent = '–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –¥–æ—Ö–æ–¥–æ–≤ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º';
                }
            });

            // –ù–∞–≤–∏–≥–∞—Ü–∏—è (–¥–µ—Å–∫—Ç–æ–ø) –∏ hashchange
            document.querySelectorAll('.nav-link').forEach(link => {
                link.addEventListener('click', (e) => {
                    updateNavLinks(e.currentTarget.getAttribute('href'));
                });
            });
            window.addEventListener('hashchange', () => {
                updateNavLinks(window.location.hash || '#dashboard');
            });

            // –õ–æ–≥–∏–∫–∞ —Å–∫—Ä—ã—Ç–∏—è/–ø–æ—è–≤–ª–µ–Ω–∏—è —à–∞–ø–∫–∏ –ø—Ä–∏ –ø—Ä–æ–∫—Ä—É—Ç–∫–µ
            window.addEventListener('scroll', () => {
                const currentScroll = window.pageYOffset || document.documentElement.scrollTop;
                if (mobileHeader && currentScroll > 50) {
                    if (currentScroll > lastScrollTop) { mobileHeader.classList.add('-translate-y-full'); }
                    else { mobileHeader.classList.remove('-translate-y-full'); }
                } else if (mobileHeader) { mobileHeader.classList.remove('-translate-y-full'); }
                lastScrollTop = currentScroll <= 0 ? 0 : currentScroll;
            });
        };

        // --- –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è ---
        loadData();
        generateRecurringTransactions();
        setupEventListeners();
        renderAll();
        updateBodyScrollAndBlur(); // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ

        // –î–µ–ª–∞–µ–º showToast –¥–æ—Å—Ç—É–ø–Ω—ã–º –≥–ª–æ–±–∞–ª—å–Ω–æ, –µ—Å–ª–∏ –Ω—É–∂–Ω–æ –∏–∑ HTML
        window.showToast = showToast;
    });
    </script>
</body>
</html>
