<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–õ–∏—á–Ω—ã–π –ë—é–¥–∂–µ—Ç</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Chart.js –¥–ª—è –¥–∏–∞–≥—Ä–∞–º–º -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Font Awesome –¥–ª—è –∏–∫–æ–Ω–æ–∫ –∫–∞—Ç–µ–≥–æ—Ä–∏–π -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">

    <style>
        /* ========================================================== */
        /* --- –°—Ç–∏–ª–∏ –¥–ª—è –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ (–û–±–Ω–æ–≤–ª–µ–Ω–æ) --- */
        /* ========================================================== */
        
        body {
            overflow-x: hidden;
            -webkit-user-select: auto;
            -moz-user-select: auto;
            -ms-user-select: auto;
            user-select: auto;
        }
        
        ::selection { color: white; background-color: #7c3aed; }  

        html { scroll-behavior: smooth; }
        
        /* –û–±—â–∏–µ —Å—Ç–∏–ª–∏ –¥–ª—è —Å—Å—ã–ª–æ–∫ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ */
        .nav-link, .nav-link-mobile {
            word-wrap: break-word;
            overflow-wrap: break-word;
            padding: 0.75rem; /* p-3 */
            border-radius: 0.5rem; /* rounded-lg */
            transition: all 0.2s ease-in-out;
            color: #d1d5db; /* text-slate-300 */
        }
        
        /* –°—Ç–∏–ª–∏ –ø—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏–∏ */
        .nav-link:hover, .nav-link-mobile:hover {
            background-color: #334155; /* slate-700 */
            color: white;
        }

        /* –ö–ª–∞—Å—Å active –¥–ª—è –≤—ã–±—Ä–∞–Ω–Ω–æ–π —Å—Å—ã–ª–∫–∏ (–±–æ–ª–µ–µ —è—Ä–∫–∏–π, —Å —Ç–µ–Ω—å—é) */
        .nav-link.active, .nav-link-mobile.active { 
            background-color: #7c3aed; /* violet-600 */ 
            color: white; 
            font-weight: 600; 
            box-shadow: 0 4px 6px -1px rgba(124, 58, 237, 0.3), 0 2px 4px -2px rgba(124, 58, 237, 0.15);
        }
        
        /* –ö–ª–∞—Å—Å active-parent –¥–ª—è —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–π —Å—Å—ã–ª–∫–∏ –≤—ã–ø–∞–¥–∞—é—â–µ–≥–æ –º–µ–Ω—é */
        .nav-link.active-parent, .nav-link-mobile.active-parent { 
            background-color: #475569; /* slate-600 */ 
            color: white; 
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è —Å—Å—ã–ª–æ–∫ –≤–Ω—É—Ç—Ä–∏ –≤—ã–ø–∞–¥–∞—é—â–µ–≥–æ –º–µ–Ω—é (–¥–µ–ª–∞–µ–º –∏—Ö —á—É—Ç—å –º–µ–Ω—å—à–µ –∏ –º–µ–Ω–µ–µ —è—Ä–∫–∏–º–∏) */
        .nav-dropdown-content a {
            padding: 0.5rem 0.75rem; /* py-2 px-3 */
            border-radius: 0.375rem; /* rounded-md */
            color: #94a3b8; /* text-slate-400 */
        }
        .nav-dropdown-content a:hover {
            background-color: #475569; /* slate-600 */ 
            color: white;
        }


        /* –î–ª—è –∫–Ω–æ–ø–æ–∫ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –≥—Ä–∞—Ñ–∏–∫–æ–≤ */
        .chart-toggle-btn.active, .chart-toggle-type-btn.active { background-color: #7c3aed; color: white; }

        /* –°—Ç–∏–ª—å –¥–ª—è –∞–∫—Ç–∏–≤–Ω–æ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è –∫–Ω–æ–ø–∫–∏ "–°–±—Ä–æ—Å–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä" –ø—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏–∏ */
        .clear-filter-btn:hover {
            color: #ef4444;
        }
        /* –°—Ç–∏–ª–∏ –¥–ª—è –ø—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä–∞ */
        .budget-progress-bar, .saving-goal-progress-bar, .debt-progress-bar {
            background-color: #e5e7eb;
            border-radius: 9999px;
            height: 8px;
            overflow: hidden;
        }
        .budget-progress-fill, .saving-goal-progress-fill, .debt-progress-fill {
            height: 100%;
            border-radius: 9999px;
            transition: width 0.3s ease-in-out, background-color 0.3s ease-in-out;
        }

        /* –ö–∞—Å—Ç–æ–º–Ω—ã–π —Å–∫—Ä–æ–ª–ª–±–∞—Ä –¥–ª—è –≤—Å–µ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã –∏ –º–æ–¥–∞–ª—å–Ω—ã—Ö –æ–∫–æ–Ω */
        ::-webkit-scrollbar {
            width: 10px;
            height: 10px; 
        }
        ::-webkit-scrollbar-track {
            background: #f1f5f9;
            border-radius: 10px;
        }
        /* –°–∫—Ä–æ–ª–ª–±–∞—Ä –≤ —Å–∞–π–¥–±–∞—Ä–µ - –¥–µ–ª–∞–µ–º –µ–≥–æ —Ñ–∏–æ–ª–µ—Ç–æ–≤—ã–º –¥–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ */
        .md::-webkit-scrollbar-thumb {
            background: #7c3aed;
        }
        ::-webkit-scrollbar-thumb {
            background: #7c3aed;
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #6d28d9;
        }

        /* Dropdown specific styles */
        .nav-dropdown-content {
            max-height: 0;
            opacity: 0;
            overflow: hidden;
            transition: max-height 0.3s ease-out, opacity 0.3s ease-out;
        }
        .nav-dropdown-content.open {
            max-height: 200px;
            opacity: 1;
        }
        .nav-dropdown-content a {
            display: block;
        }

        /* –ê–Ω–∏–º–∞—Ü–∏—è —à–µ–≤—Ä–æ–Ω–∞ –¥–ª—è –≤—Å–µ—Ö –¥—Ä–æ–ø–¥–∞—É–Ω–æ–≤ */
        .fas.fa-chevron-down {
            transition: transform 0.3s ease-out;
        }
        /* –ü–æ–≤–æ—Ä–æ—Ç —à–µ–≤—Ä–æ–Ω–∞, –∫–æ–≥–¥–∞ –¥—Ä–æ–ø–¥–∞—É–Ω –æ—Ç–∫—Ä—ã—Ç (–¥–ª—è –¥–µ—Å–∫—Ç–æ–ø–∞ –ø–æ —Ö–æ–≤–µ—Ä—É, –¥–ª—è –º–æ–±–∏–ª—å–Ω–æ–≥–æ –ø–æ –∫–ª–∏–∫—É) */
        .nav-dropdown-toggle:hover > a .fas.fa-chevron-down,
        .nav-dropdown-toggle-mobile > a.dropdown-expanded .fas.fa-chevron-down {
            transform: rotate(180deg);
        }

        /* –î–µ—Å–∫—Ç–æ–ø–Ω—ã–π –¥—Ä–æ–ø–¥–∞—É–Ω: –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏–∏ */
        .nav-dropdown-toggle:hover > .nav-dropdown-content {
            max-height: 200px;
            opacity: 1;
        }
        /* –ú–æ–±–∏–ª—å–Ω—ã–π –¥—Ä–æ–ø–¥–∞—É–Ω: –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è –ø–æ –∫–ª–∞—Å—Å—É dropdown-expanded –Ω–∞ —Å—Å—ã–ª–∫–µ */
        .nav-dropdown-toggle-mobile > a.dropdown-expanded + .nav-dropdown-content {
            max-height: 200px;
            opacity: 1;
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è –∫–∞—Ç–µ–≥–æ—Ä–∏–π –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö */
        .category-item, .debt-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.875rem; 
            background-color: #e2e8f0; 
            padding: 0.25rem 0.75rem; 
            border-radius: 9999px; 
            transition: background-color 0.3s ease-in-out;
        }
        .category-item:hover, .debt-item:hover {
            background-color: #cbd5e1; 
        }
        .category-item .icon-color-display {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        .category-item .icon-preview {
            width: 1rem; 
            height: 1rem;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .category-item .category-controls, .debt-item .debt-controls {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        /* –°–∫—Ä—ã–≤–∞–µ–º –∏–Ω–ø—É—Ç –±—é–¥–∂–µ—Ç–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä–∏ —Ö–æ–≤–µ—Ä–µ –Ω–∞ —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–∏–π –±–ª–æ–∫ category-item */
        .category-item .budget-input {
            opacity: 0;
            width: 0;
            padding: 0;
            margin: 0;
            transition: opacity 0.3s ease-in-out, width 0.3s ease-in-out, padding 0.3s ease-in-out, margin 0.3s ease-in-out;
            pointer-events: none; 
        }
        .category-item:hover .budget-input {
            opacity: 1;
            width: 80px; 
            padding: 0.25rem 0.5rem;
            margin-right: 0.5rem;
            pointer-events: auto; 
        }
        .category-input-group {
             display: flex;
             flex-direction: column; 
             gap: 0.5rem; 
        }
        .category-input-group > div {
             display: flex;
             align-items: center;
             gap: 0.5rem;
        }

    </style>
</head>
<body class="bg-slate-100 text-slate-800 font-sans">

    <!-- –ú–æ–±–∏–ª—å–Ω–æ–µ –±–æ–∫–æ–≤–æ–µ –º–µ–Ω—é (–û–±–Ω–æ–≤–ª–µ–Ω–æ) -->
    <div id="mobile-menu" class="fixed inset-y-0 left-0 z-50 w-64 bg-slate-800 text-white p-4 flex flex-col transform -translate-x-full transition-transform duration-300 ease-in-out shadow-2xl">
        <div class="flex justify-between items-center mb-8 border-b border-violet-700 pb-4">
            <div class="flex items-center gap-3">
                <img src="logo.jpg" alt="–õ–æ–≥–æ—Ç–∏–ø" class="h-10 w-10 rounded-full border-2 border-violet-400">
                <h1 class="text-xl font-extrabold text-violet-400 tracking-wider">Budget Pro</h1>
            </div>
            <button id="close-mobile-menu-btn" class="text-white text-4xl leading-none font-light hover:text-violet-400 transition-colors">&times;</button>
        </div>
        <nav class="flex flex-col space-y-2 flex-grow">
            <!-- Dropdown for Dashboard - Mobile -->
            <div class="nav-dropdown-toggle-mobile">
                <a href="#dashboard" id="dashboard-toggle-mobile" class="nav-link-mobile p-3 rounded-lg hover:bg-slate-700 transition-colors flex justify-between items-center">
                    <span>üìä –û–±–∑–æ—Ä</span>
                    <i class="fas fa-chevron-down text-xs"></i>
                </a>
                <div class="nav-dropdown-content space-y-1 mt-1 ml-4 border-l border-slate-700 pl-3">
                    <a href="#category-charts" class="nav-link-mobile block p-2 rounded-md hover:bg-slate-600 transition-colors text-slate-400 hover:text-white">üìà –ê–Ω–∞–ª–∏—Ç–∏–∫–∞</a>
                    <a href="#budget-summary-section" class="nav-link-mobile block p-2 rounded-md hover:bg-slate-600 transition-colors text-slate-400 hover:text-white">üí∞ –ë—é–¥–∂–µ—Ç –Ω–∞ –º–µ—Å—è—Ü</a>
                    <a href="#saving-goals-summary-section" class="nav-link-mobile block p-2 rounded-md hover:bg-slate-600 transition-colors text-slate-400 hover:text-white">üéØ –¶–µ–ª–∏ –Ω–∞–∫–æ–ø–ª–µ–Ω–∏—è</a>
                    <a href="#debts-summary-section" class="nav-link-mobile block p-2 rounded-md hover:bg-slate-600 transition-colors text-slate-400 hover:text-white">ü§ù –ú–æ–∏ –¥–æ–ª–≥–∏</a>
                </div>
            </div>
            <!-- End Dropdown -->
            <a href="#transactions" class="nav-link-mobile p-3 rounded-lg hover:bg-slate-700 transition-colors">üìã –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏</a>
            <a href="#settings" class="nav-link-mobile p-3 rounded-lg hover:bg-slate-700 transition-colors">‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏</a>
            
            <!-- –ö–ù–û–ü–ö–ê –ü–û–î–î–ï–†–ñ–ö–ò - –ú–û–ë–ò–õ–¨–ù–ê–Ø -->
            <a href="#support" id="open-support-modal-mobile" class="nav-link-mobile p-3 rounded-lg bg-yellow-500 text-slate-900 hover:bg-yellow-400 transition-colors font-bold mt-4 text-center">
                ‚≠ê –ü–æ–¥–¥–µ—Ä–∂–∞—Ç—å –ø—Ä–æ–µ–∫—Ç
            </a>

        </nav>
        <div class="mt-auto pt-4 border-t border-slate-700 text-xs text-slate-400">
            <p class="font-semibold text-violet-300">–õ–∏—á–Ω—ã–π –ë—é–¥–∂–µ—Ç</p>
            <p>–í–µ—Ä—Å–∏—è: v0.0.2</p>
            <p>&copy; 2025</p>
            <p>–†–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫: <a href="https://vk.com/rasingstar" target="_blank" class="text-violet-400 hover:underline">–î–∞–Ω–∏–ª –¢—ë—Ç—É—à–∫–∏–Ω</a></p>
        </div>
    </div>

    <!-- –û–≤–µ—Ä–ª–µ–π –¥–ª—è –º–æ–±–∏–ª—å–Ω–æ–≥–æ –º–µ–Ω—é (—Å–∫—Ä—ã—Ç–æ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é) -->
    <div id="mobile-menu-overlay" class="fixed inset-0 bg-black/50 z-40 hidden transition-opacity duration-300 opacity-0"></div>

    <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –¥–ª—è —ç—Ñ—Ñ–µ–∫—Ç–∞ —Ä–∞–∑–º—ã—Ç–∏—è -->
    <div id="app-container" class="flex min-h-screen">
        <!-- –ë–æ–∫–æ–≤–∞—è –ø–∞–Ω–µ–ª—å –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ –¥–ª—è –¥–µ—Å–∫—Ç–æ–ø–∞ (–û–±–Ω–æ–≤–ª–µ–Ω–æ) -->
        <aside class="fixed inset-y-0 left-0 w-64 bg-slate-800 text-white p-4 flex-shrink-0 hidden md:flex flex-col h-screen z-40 shadow-xl overflow-y-auto">
            <div class="flex items-center gap-3 mb-8 border-b border-violet-700 pb-4">
                <img src="logo.png" alt="–õ–æ–≥–æ—Ç–∏–ø" class="h-12 w-12 rounded-full border-2 border-violet-400">
                <h1 class="text-2xl font-extrabold text-violet-400 tracking-wider">Budget Pro</h1>
            </div>
            <nav class="flex flex-col space-y-2 flex-grow">
                <!-- Dropdown for Dashboard - Desktop -->
                <div class="nav-dropdown-toggle">
                    <a href="#dashboard" id="dashboard-toggle-desktop" class="nav-link p-3 rounded-lg hover:bg-slate-700 transition-colors flex justify-between items-center">
                        <span>üìä –û–±–∑–æ—Ä</span>
                        <i class="fas fa-chevron-down text-xs"></i>
                    </a>
                    <div class="nav-dropdown-content space-y-1 mt-1 ml-4 border-l border-slate-700 pl-3">
                        <a href="#category-charts" class="nav-link block p-2 rounded-md hover:bg-slate-600 transition-colors text-slate-400 hover:text-white">üìà –ê–Ω–∞–ª–∏—Ç–∏–∫–∞</a>
                        <a href="#budget-summary-section" class="nav-link block p-2 rounded-md hover:bg-slate-600 transition-colors text-slate-400 hover:text-white">üí∞ –ë—é–¥–∂–µ—Ç –Ω–∞ –º–µ—Å—è—Ü</a>
                        <a href="#saving-goals-summary-section" class="nav-link block p-2 rounded-md hover:bg-slate-600 transition-colors text-slate-400 hover:text-white">üéØ –¶–µ–ª–∏ –Ω–∞–∫–æ–ø–ª–µ–Ω–∏—è</a>
                        <a href="#debts-summary-section" class="nav-link block p-2 rounded-md hover:bg-slate-600 transition-colors text-slate-400 hover:text-white">ü§ù –ú–æ–∏ –¥–æ–ª–≥–∏</a>
                    </div>
                </div>
                <!-- End Dropdown -->
                <a href="#transactions" class="nav-link p-3 rounded-lg hover:bg-slate-700 transition-colors">üìã –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏</a>
                <a href="#settings" class="nav-link p-3 rounded-lg hover:bg-slate-700 transition-colors">‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏</a>
                
                <!-- –ö–ù–û–ü–ö–ê –ü–û–î–î–ï–†–ñ–ö–ò - –î–ï–°–ö–¢–û–ü -->
                <a href="#support" id="open-support-modal-desktop" class="nav-link p-3 rounded-lg bg-yellow-500 text-slate-900 hover:bg-yellow-400 transition-colors font-bold mt-4 text-center">
                    ‚≠ê –ü–æ–¥–¥–µ—Ä–∂–∞—Ç—å –ø—Ä–æ–µ–∫—Ç
                </a>
            </nav>
            <div class="mt-auto pt-4 border-t border-slate-700 text-xs text-slate-400">
                <p class="font-semibold text-violet-300">–õ–∏—á–Ω—ã–π –ë—é–¥–∂–µ—Ç</p>
                <p>–í–µ—Ä—Å–∏—è: v0.0.2</p>
                <p>&copy; 2025</p>
                <p>–†–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫: <a href="https://vk.com/rasingstar" target="_blank" class="text-violet-400 hover:underline">–î–∞–Ω–∏–ª –¢—ë—Ç—É—à–∫–∏–Ω</a></p>
            </div>
        </aside>

        <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç -->
        <!-- pt-20 –∫–æ–º–ø–µ–Ω—Å–∏—Ä—É–µ—Ç –≤—ã—Å–æ—Ç—É —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –∑–∞–≥–æ–ª–æ–≤–∫–∞ –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö, md:ml-64 —Å–¥–≤–∏–≥–∞–µ—Ç –∫–æ–Ω—Ç–µ–Ω—Ç –æ—Ç —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ —Å–∞–π–¥–±–∞—Ä–∞ -->
        <main class="flex-1 p-4 sm:p-6 lg:p-8 pt-20 md:ml-64">
            <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö —Å –∫–Ω–æ–ø–∫–æ–π –≥–∞–º–±—É—Ä–≥–µ—Ä–∞ -->
            <header id="mobile-header" class="md:hidden flex items-center justify-between p-4 bg-white shadow-md rounded-b-lg fixed top-0 left-0 w-full z-40 transition-transform duration-300 ease-out">
                <button id="open-mobile-menu-btn" class="text-slate-700 text-3xl leading-none hover:text-violet-600 transition-colors">‚ò∞</button>
                <!-- –õ–æ–≥–æ—Ç–∏–ø –∏ –∑–∞–≥–æ–ª–æ–≤–æ–∫ -->
                <div class="flex items-center gap-2">
                    <img src="logo.jpg" alt="–õ–æ–≥–æ—Ç–∏–ø" class="h-8 w-8 rounded-full">
                    <h2 class="text-xl font-bold text-violet-600">–ë—é–¥–∂–µ—Ç</h2>
                </div>
                <div class="w-8"></div> <!-- –ó–∞–≥–ª—É—à–∫–∞ –¥–ª—è —Ü–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏—è –Ω–∞–∑–≤–∞–Ω–∏—è -->
            </header>

            <!-- –°–µ–∫—Ü–∏—è: –û–±–∑–æ—Ä (Dashboard) -->
            <section id="dashboard" class="mb-12">
                <h2 class="text-3xl font-bold mb-6">–û–±–∑–æ—Ä</h2>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                    <div class="bg-green-100 border-l-4 border-green-500 text-green-800 p-4 rounded-lg shadow">
                        <h3 class="font-bold">–û–±—â–∏–µ –¥–æ—Ö–æ–¥—ã</h3>
                        <p id="total-income" class="text-2xl font-semibold">0 ‚ÇΩ</p>
                    </div>
                    <div class="bg-red-100 border-l-4 border-red-500 text-red-800 p-4 rounded-lg shadow">
                        <h3 class="font-bold">–û–±—â–∏–µ —Ä–∞—Å—Ö–æ–¥—ã</h3>
                        <p id="total-expenses" class="text-2xl font-semibold">0 ‚ÇΩ</p>
                    </div>
                    <div class="bg-violet-100 border-l-4 border-violet-500 text-violet-800 p-4 rounded-lg shadow" id="total-balance-card">
                        <h3 class="font-bold">–û–±—â–∏–π –±–∞–ª–∞–Ω—Å</h3>
                        <p id="total-balance" class="text-2xl font-semibold">0 ‚ÇΩ</p>
                    </div>
                </div>

                <!-- –ë–∞–ª–∞–Ω—Å –ø–æ —Å—á–µ—Ç–∞–º -->
                <div class="bg-white p-6 rounded-lg shadow mb-8">
                    <h3 class="text-xl font-bold mb-4">–ë–∞–ª–∞–Ω—Å –ø–æ —Å—á–µ—Ç–∞–º</h3>
                    <div id="accounts-summary" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
                        <p class="text-gray-500">–î–æ–±–∞–≤—å—Ç–µ —Å—á–µ—Ç–∞ –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö.</p>
                    </div>
                </div>

                <!-- –¶–µ–ª–∏ –Ω–∞–∫–æ–ø–ª–µ–Ω–∏—è –Ω–∞ —Ç–µ–∫—É—â–∏–π –≥–æ–¥ -->
                <div id="saving-goals-summary-section" class="bg-white p-6 rounded-lg shadow mb-8">
                    <h3 class="text-xl font-bold mb-4">–¶–µ–ª–∏ –Ω–∞–∫–æ–ø–ª–µ–Ω–∏—è –Ω–∞ —Ç–µ–∫—É—â–∏–π –≥–æ–¥</h3>
                    <div id="saving-goals-summary-list" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                        <p class="text-gray-500">–î–æ–±–∞–≤—å—Ç–µ —Ü–µ–ª–∏ –Ω–∞–∫–æ–ø–ª–µ–Ω–∏—è –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö.</p>
                    </div>
                </div>

                <!-- –ú–æ–∏ –¥–æ–ª–≥–∏ (–ù–æ–≤–∞—è —Å–µ–∫—Ü–∏—è –Ω–∞ –¥–∞—à–±–æ—Ä–¥–µ) -->
                <div id="debts-summary-section" class="bg-white p-6 rounded-lg shadow mb-8">
                    <h3 class="text-xl font-bold mb-4">–ú–æ–∏ –¥–æ–ª–≥–∏</h3>
                    <div id="dashboard-debts-list" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                        <p class="text-gray-500">–î–æ–±–∞–≤—å—Ç–µ –¥–æ–ª–≥–∏ –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö.</p>
                    </div>
                </div>

                <!-- –†–∞—Å—Ö–æ–¥—ã –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º (–¥–∏–∞–≥—Ä–∞–º–º–∞) - –û–±–Ω–æ–≤–ª–µ–Ω–Ω–∞—è —Å–µ–∫—Ü–∏—è –ê–Ω–∞–ª–∏—Ç–∏–∫–∏ -->
                <div id="category-charts" class="bg-white p-6 rounded-lg shadow mb-8">
                    <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-4 flex-wrap gap-2">
                        <h3 id="chart-section-title" class="text-xl font-bold">–§–∏–Ω–∞–Ω—Å–æ–≤–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞</h3>
                        <!-- –û—Å–Ω–æ–≤–Ω–æ–π –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å —Ç–∏–ø–æ–≤ –¥–∏–∞–≥—Ä–∞–º–º -->
                        <div class="flex flex-wrap gap-2 border border-slate-300 rounded-lg p-1">
                            <button id="show-pie-chart-btn" class="chart-toggle-type-btn active px-3 py-1 text-sm font-semibold rounded-md transition-colors">–ü–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º</button>
                            <button id="show-monthly-bar-chart-btn" class="chart-toggle-type-btn px-3 py-1 text-sm font-semibold rounded-md transition-colors">–ü–æ –º–µ—Å—è—Ü–∞–º</button>
                            <button id="show-balance-line-chart-btn" class="chart-toggle-type-btn px-3 py-1 text-sm font-semibold rounded-md transition-colors">–ë–∞–ª–∞–Ω—Å (–¥–∏–Ω–∞–º–∏–∫–∞)</button>
                            <button id="show-cumulative-area-chart-btn" class="chart-toggle-type-btn px-3 py-1 text-sm font-semibold rounded-md transition-colors">–ö—É–º—É–ª—è—Ç–∏–≤–Ω–æ</button>
                        </div>
                    </div>

                    <!-- –ü–æ–¥-–ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å –¥–ª—è –∫–∞—Ç–µ–≥–æ—Ä–∏–π–Ω—ã—Ö –¥–∏–∞–≥—Ä–∞–º–º (Pie/Bar), —Å–∫—Ä—ã—Ç –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é -->
                    <div id="category-sub-toggle" class="flex justify-center mb-4 flex-wrap gap-2">
                        <div class="flex border border-slate-300 rounded-lg p-1">
                            <button id="show-category-expense-btn" class="chart-toggle-btn active px-3 py-1 text-sm font-semibold rounded-md transition-colors">–†–∞—Å—Ö–æ–¥—ã</button>
                            <button id="show-category-income-btn" class="chart-toggle-btn px-3 py-1 text-sm font-semibold rounded-md transition-colors">–î–æ—Ö–æ–¥—ã</button>
                        </div>
                    </div>

                    <div class="relative h-96">
                         <canvas id="categoryPieChartCanvas" class="chart-canvas"></canvas>
                         <canvas id="monthlyBarChartCanvas" class="chart-canvas hidden"></canvas>
                         <canvas id="balanceLineChartCanvas" class="chart-canvas hidden"></canvas>
                         <canvas id="cumulativeAreaChartCanvas" class="chart-canvas hidden"></canvas>
                    </div>
                </div>

                <!-- –ë—é–¥–∂–µ—Ç –Ω–∞ —Ç–µ–∫—É—â–∏–π –º–µ—Å—è—Ü (–ê–î–ê–ü–¢–ò–í–ù–ê–Ø –°–ï–¢–ö–ê) -->
                <div id="budget-summary-section" class="bg-white p-6 rounded-lg shadow">
                    <h3 class="text-xl font-bold mb-4">–ë—é–¥–∂–µ—Ç –Ω–∞ —Ç–µ–∫—É—â–∏–π –º–µ—Å—è—Ü</h3>
                    <!-- –ê–î–ê–ü–¢–ò–í–ù–´–ï –ö–õ–ê–°–°–´: 1 –∫–æ–ª–æ–Ω–∫–∞ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é), 2 –Ω–∞ sm, 4 –Ω–∞ lg, 5 –Ω–∞ xl -->
                    <div id="budget-summary-list" class="grid grid-cols-1 gap-4 sm:grid-cols-2 lg:grid-cols-4 xl:grid-cols-5">
                        <p class="text-gray-500">–î–æ–±–∞–≤—å—Ç–µ –±—é–¥–∂–µ—Ç—ã –∫ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º —Ä–∞—Å—Ö–æ–¥–æ–≤ –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö.</p>
                    </div>
                </div>

            </section>

            <!-- –°–µ–∫—Ü–∏—è: –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ -->
            <section id="transactions" class="mb-12">
                <div class="flex justify-between items-center mb-6 flex-wrap gap-4">
                    <h2 class="text-3xl font-bold">–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏</h2>
                    <div class="flex items-center gap-4 flex-wrap">
                        <button id="add-transaction-btn" class="bg-violet-600 text-white px-4 py-2 rounded-lg shadow hover:bg-violet-700 transition-colors">
                            + –î–æ–±–∞–≤–∏—Ç—å
                        </button>
                    </div>
                </div>

                <!-- –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã –∏ –ø–æ–∏—Å–∫ -->
                <div class="bg-white p-6 rounded-lg shadow mb-6">
                    <h3 class="text-xl font-bold mb-4">–§–∏–ª—å—Ç—Ä—ã –∏ –ø–æ–∏—Å–∫</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                        <div>
                            <label for="filter-type" class="block text-sm font-medium text-slate-700 mb-1">–¢–∏–ø</label>
                            <select id="filter-type" class="w-full p-2 border border-slate-300 rounded-md bg-white text-slate-800">
                                <option value="all">–í—Å–µ</option>
                                <option value="income">–î–æ—Ö–æ–¥—ã</option>
                                <option value="expense">–†–∞—Å—Ö–æ–¥—ã</option>
                            </select>
                        </div>
                        <div>
                            <label for="filter-category" class="block text-sm font-medium text-slate-700 mb-1">–ö–∞—Ç–µ–≥–æ—Ä–∏—è</label>
                            <select id="filter-category" class="w-full p-2 border border-slate-300 rounded-md bg-white text-slate-800">
                                <option value="all">–í—Å–µ</option>
                                <!-- –û–ø—Ü–∏–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–π –±—É–¥—É—Ç –∑–∞–ø–æ–ª–Ω–µ–Ω—ã –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ (–î–û–•–û–î–´ + –†–ê–°–•–û–î–´) -->
                            </select>
                        </div>
                        <div>
                            <label for="filter-account" class="block text-sm font-medium text-slate-700 mb-1">–°—á–µ—Ç</label>
                            <select id="filter-account" class="w-full p-2 border border-slate-300 rounded-md bg-white text-slate-800">
                                <option value="all">–í—Å–µ</option>
                                <!-- –û–ø—Ü–∏–∏ —Å—á–µ—Ç–æ–≤ –±—É–¥—É—Ç –∑–∞–ø–æ–ª–Ω–µ–Ω—ã –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                            </select>
                        </div>
                        <div>
                            <label for="filter-description" class="block text-sm font-medium text-slate-700 mb-1">–ü–æ–∏—Å–∫ –ø–æ –æ–ø–∏—Å–∞–Ω–∏—é</label>
                            <input type="text" id="filter-description" placeholder="–ù–∞–π—Ç–∏..." class="w-full p-2 border border-slate-300 rounded-md bg-slate-50 text-slate-800">
                        </div>
                        <div class="col-span-1 md:col-span-2 lg:col-span-2 flex flex-wrap gap-4 items-end">
                            <div class="flex-1 min-w-[120px]">
                                <label for="filter-amount-min" class="block text-sm font-medium text-slate-700 mb-1">–°—É–º–º–∞ –æ—Ç</label>
                                <input type="number" id="filter-amount-min" placeholder="–ú–∏–Ω. —Å—É–º–º–∞" class="w-full p-2 border border-slate-300 rounded-md bg-slate-50 text-slate-800">
                            </div>
                            <div class="flex-1 min-w-[120px]">
                                <label for="filter-amount-max" class="block text-sm font-medium text-slate-700 mb-1">–°—É–º–º–∞ –¥–æ</label>
                                <input type="number" id="filter-amount-max" placeholder="–ú–∞–∫—Å. —Å—É–º–º–∞" class="w-full p-2 border border-slate-300 rounded-md bg-slate-50 text-slate-800">
                            </div>
                        </div>
                        <div class="col-span-1 md:col-span-2 lg:col-span-2 flex flex-wrap gap-4 items-end">
                            <div class="flex-1 min-w-[120px]">
                                <label for="filter-date-start" class="block text-sm font-medium text-slate-700 mb-1">–î–∞—Ç–∞ –æ—Ç</label>
                                <input type="date" id="filter-date-start" class="w-full p-2 border border-slate-300 rounded-md bg-slate-50 text-slate-800">
                            </div>
                            <div class="flex-1 min-w-[120px]">
                                <label for="filter-date-end" class="block text-sm font-medium text-slate-700 mb-1">–î–∞—Ç–∞ –¥–æ</label>
                                <input type="date" id="filter-date-end" class="w-full p-2 border border-slate-300 rounded-md bg-slate-50 text-slate-800">
                            </div>
                        </div>
                        <div class="col-span-full flex justify-between items-center gap-4 mt-2">
                             <select id="sort-order" class="p-2 border border-slate-300 rounded-md bg-white text-slate-800">
                                 <option value="date-desc">–°–Ω–∞—á–∞–ª–∞ –Ω–æ–≤—ã–µ</option>
                                 <option value="date-asc">–°–Ω–∞—á–∞–ª–∞ —Å—Ç–∞—Ä—ã–µ</option>
                                 <option value="amount-desc">–°—É–º–º–∞ (—É–±—ã–≤.)</option>
                                 <option value="amount-asc">–°—É–º–º–∞ (–≤–æ–∑—Ä.)</option>
                             </select>
                             <button id="reset-filters-btn" class="text-violet-600 hover:text-violet-700 font-semibold transition-colors">–°–±—Ä–æ—Å–∏—Ç—å –≤—Å–µ —Ñ–∏–ª—å—Ç—Ä—ã</button>
                        </div>
                    </div>
                </div>

                <!-- –≠–ª–µ–º–µ–Ω—Ç—ã –ø–∞–≥–∏–Ω–∞—Ü–∏–∏ -->
                <div id="pagination-controls" class="flex justify-center items-center gap-4 mt-6 mb-4">
                    <button id="prev-page-btn" class="bg-slate-200 text-slate-700 px-4 py-2 rounded-lg hover:bg-slate-300 disabled:opacity-50 disabled:cursor-not-allowed transition-colors">&larr;</button>
                    <span id="page-info" class="text-slate-600 font-medium">1/1</span>
                    <button id="next-page-btn" class="bg-slate-200 text-slate-700 px-4 py-2 rounded-lg hover:bg-slate-300 disabled:opacity-50 disabled:cursor-not-allowed transition-colors">&rarr;</button>
                </div>

                <div id="transaction-list" class="space-y-3">
                    <!-- –°–ø–∏—Å–æ–∫ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –±—É–¥–µ—Ç –∑–¥–µ—Å—å -->
                </div>
            </section>

            <!-- –°–µ–∫—Ü–∏—è: –ù–∞—Å—Ç—Ä–æ–π–∫–∏ -->
            <section id="settings">
                <h2 class="text-3xl font-bold mb-6">–ù–∞—Å—Ç—Ä–æ–π–∫–∏</h2>
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                    <div class="bg-white p-6 rounded-lg shadow">
                        <h3 class="text-xl font-bold mb-4">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º–∏</h3>
                        <div class="grid grid-cols-1 sm:grid-cols-2 gap-6">
                            <div>
                                <h4 class="font-semibold mb-2 text-green-600">–î–æ—Ö–æ–¥—ã</h4>
                                <div id="income-categories-list" class="space-y-2 mb-3"></div>
                                <div class="flex flex-col gap-2 items-stretch">
                                    <div class="flex gap-2 items-center">
                                        <input type="text" id="new-income-category-name" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏" class="w-full p-2 border border-slate-300 rounded-md bg-slate-50 text-slate-800 flex-grow">
                                    </div>
                                    <div class="flex gap-2 items-center">
                                        <input type="color" id="new-income-category-color" value="#22c55e" class="w-10 h-10 p-0.5 border border-slate-300 rounded-md cursor-pointer">
                                        <input type="text" id="new-income-category-icon" placeholder="fa-solid fa-money-bill-wave" value="fa-solid fa-money-bill-wave" class="w-full p-2 border border-slate-300 rounded-md bg-slate-50 text-slate-800 flex-grow">
                                    </div>
                                    <button onclick="addCategory('income')" class="bg-green-500 text-white px-3 py-2 rounded-md hover:bg-green-600 transition-colors self-end">–î–æ–±–∞–≤–∏—Ç—å</button>
                                </div>
                            </div>
                            <div>
                                <h4 class="font-semibold mb-2 text-red-600">–†–∞—Å—Ö–æ–¥—ã</h4>
                                <div id="expense-categories-list" class="space-y-2 mb-3"></div>
                                <div class="flex flex-col gap-2 items-stretch">
                                    <!-- –î–û–ë–ê–í–õ–ï–ù–û: –ò–Ω–ø—É—Ç –¥–ª—è –Ω–∞–∑–≤–∞–Ω–∏—è –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ —Ä–∞—Å—Ö–æ–¥–æ–≤ -->
                                    <div class="flex gap-2 items-center">
                                        <input type="text" id="new-expense-category-name" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏" class="w-full p-2 border border-slate-300 rounded-md bg-slate-50 text-slate-800 flex-grow">
                                    </div>
                                    <!-- –ö–æ–Ω–µ—Ü –¥–æ–±–∞–≤–ª–µ–Ω–Ω–æ–π —á–∞—Å—Ç–∏ -->
                                    <div class="flex gap-2 items-center">
                                        <input type="color" id="new-expense-category-color" value="#ef4444" class="w-10 h-10 p-0.5 border border-slate-300 rounded-md cursor-pointer">
                                        <input type="text" id="new-expense-category-icon" placeholder="fa-solid fa-cart-shopping" value="fa-solid fa-cart-shopping" class="w-full p-2 border border-slate-300 rounded-md bg-slate-50 text-slate-800 flex-grow">
                                    </div>
                                    <button onclick="addCategory('expense')" class="bg-red-500 text-white px-3 py-2 rounded-md hover:bg-red-600 transition-colors self-end">–î–æ–±–∞–≤–∏—Ç—å</button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å—á–µ—Ç–∞–º–∏ -->
                    <div class="bg-white p-6 rounded-lg shadow">
                        <h3 class="text-xl font-bold mb-4">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å—á–µ—Ç–∞–º–∏</h3>
                        <div id="accounts-list" class="space-y-2 mb-3">
                            <!-- –°–ø–∏—Å–æ–∫ —Å—á–µ—Ç–æ–≤ –±—É–¥–µ—Ç –∑–¥–µ—Å—å -->
                        </div>
                        <div class="flex gap-2">
                            <input type="text" id="new-account-name" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ —Å—á–µ—Ç–∞" class="w-full p-2 border border-slate-300 rounded-md bg-slate-50 text-slate-800">
                            <button onclick="addAccount()" class="bg-violet-500 text-white px-3 rounded-md hover:bg-violet-600 transition-colors">+</button>
                        </div>
                    </div>

                    <!-- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ü–µ–ª—è–º–∏ –Ω–∞–∫–æ–ø–ª–µ–Ω–∏—è -->
                    <div class="bg-white p-6 rounded-lg shadow lg:col-span-2">
                        <h3 class="text-xl font-bold mb-4">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ü–µ–ª—è–º–∏ –Ω–∞–∫–æ–ø–ª–µ–Ω–∏—è</h3>
                        <div id="saving-goals-list" class="space-y-3 mb-3">
                             <p class="text-gray-500">–¶–µ–ª–∏ –Ω–∞–∫–æ–ø–ª–µ–Ω–∏—è –±—É–¥—É—Ç –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è –∑–¥–µ—Å—å.</p>
                        </div>
                        <div class="flex flex-col sm:flex-row gap-2">
                            <input type="text" id="new-saving-goal-name" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ —Ü–µ–ª–∏" class="w-full p-2 border border-slate-300 rounded-md bg-slate-50 text-slate-800 flex-1">
                            <input type="number" id="new-saving-goal-amount" placeholder="–¶–µ–ª–µ–≤–∞—è —Å—É–º–º–∞" min="0" step="0.01" class="w-full p-2 border border-slate-300 rounded-md bg-slate-50 text-slate-800 flex-1">
                            <button onclick="addSavingGoal()" class="bg-emerald-500 text-white px-3 py-2 rounded-md hover:bg-emerald-600 transition-colors">–î–æ–±–∞–≤–∏—Ç—å —Ü–µ–ª—å</button>
                        </div>
                    </div>

                    <!-- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–æ–ª–≥–∞–º–∏ (–ù–û–í–ê–Ø –°–ï–ö–¶–ò–Ø - —Ç–µ–ø–µ—Ä—å —Å –∫–Ω–æ–ø–∫–æ–π –¥–ª—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞) -->
                    <div class="bg-white p-6 rounded-lg shadow lg:col-span-2">
                        <h3 class="text-xl font-bold mb-4">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–æ–ª–≥–∞–º–∏</h3>
                        <div id="debts-list" class="space-y-3 mb-3">
                            <p class="text-gray-500">–î–æ–ª–≥–∏ –±—É–¥—É—Ç –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è –∑–¥–µ—Å—å.</p>
                        </div>
                        <!-- –ö–Ω–æ–ø–∫–∞ –¥–ª—è –æ—Ç–∫—Ä—ã—Ç–∏—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –¥–æ–ª–≥–æ–≤ -->
                        <button id="add-debt-btn" class="bg-blue-500 text-white px-4 py-2 rounded-md hover:bg-blue-600 transition-colors">–î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π –¥–æ–ª–≥</button>
                    </div>

                    <!-- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–≤—Ç–æ—Ä—è—é—â–∏–º–∏—Å—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è–º–∏ -->
                    <div class="bg-white p-6 rounded-lg shadow lg:col-span-2">
                        <h3 class="text-xl font-bold mb-4">–ü–æ–≤—Ç–æ—Ä—è—é—â–∏–µ—Å—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏</h3>
                        <div id="recurring-transactions-list" class="space-y-3">
                            <p class="text-gray-500">–ü–æ–≤—Ç–æ—Ä—è—é—â–∏–µ—Å—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –±—É–¥—É—Ç –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è –∑–¥–µ—Å—å –ø–æ—Å–ª–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è.</p>
                        </div>
                        <p class="mt-4 text-sm text-gray-600">–ü–æ–≤—Ç–æ—Ä—è—é—â–∏–µ—Å—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞—é—Ç—Å—è –≤ –¥–∞—Ç—É –∏—Ö –Ω–∞—Å—Ç—É–ø–ª–µ–Ω–∏—è. –í—ã –º–æ–∂–µ—Ç–µ –¥–æ–±–∞–≤–∏—Ç—å –∏—Ö —á–µ—Ä–µ–∑ —Ñ–æ—Ä–º—É –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏.</p>
                    </div>

                    <!-- –û–ë–ù–û–í–õ–ï–ù–û: –°–µ–∫—Ü–∏—è –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã–º–∏ —Å –∏–º–ø–æ—Ä—Ç–æ–º -->
                    <div class="bg-white p-6 rounded-lg shadow">
                        <h3 class="text-xl font-bold mb-4">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã–º–∏</h3>
                        <div class="flex flex-col sm:flex-row gap-4">
                            <button onclick="exportData()" class="flex-1 bg-violet-500 text-white px-4 py-2 rounded-lg shadow hover:bg-violet-600 transition-colors">–≠–∫—Å–ø–æ—Ä—Ç –≤ JSON</button>
                            
                            <!-- –°–∫—Ä—ã—Ç—ã–π –∏–Ω–ø—É—Ç –¥–ª—è –≤—ã–±–æ—Ä–∞ —Ñ–∞–π–ª–∞ -->
                            <input type="file" id="import-file" accept=".json" class="hidden">
                            <!-- –ö–Ω–æ–ø–∫–∞, –∫–æ—Ç–æ—Ä–∞—è –∞–∫—Ç–∏–≤–∏—Ä—É–µ—Ç —Å–∫—Ä—ã—Ç—ã–π –∏–Ω–ø—É—Ç -->
                            <button onclick="document.getElementById('import-file').click()" class="flex-1 bg-violet-600 text-white px-4 py-2 rounded-lg shadow hover:bg-violet-700 transition-colors">–ò–º–ø–æ—Ä—Ç –∏–∑ JSON</button>
                        </div>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <!-- –ö–Ω–æ–ø–∫–∞ "–°–ø—Ä–∞–≤–∫–∞" –≤ —É–≥–ª—É -->
    <button id="open-help-modal-btn" class="fixed bottom-4 right-4 z-50 bg-violet-600 text-white p-3 rounded-full shadow-lg hover:bg-violet-700 transition-colors flex items-center justify-center text-xl">
        ?
    </button>

    <!-- –ú–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ –Ω–∞—Ö–æ–¥—è—Ç—Å—è –í–ù–ï –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ -->
    <div id="transaction-modal" class="fixed inset-0 z-50 bg-black/60 flex justify-center items-center p-4 hidden">
        <div class="bg-white rounded-lg shadow-2xl p-6 w-full max-w-md relative max-h-[90vh] overflow-y-auto modal-scrollable-content">
            <span id="close-modal-btn" class="absolute top-3 right-4 text-gray-400 hover:text-gray-700 text-3xl font-bold cursor-pointer">&times;</span>
            <h2 id="modal-title" class="text-2xl font-bold text-center mb-6">–ù–æ–≤–∞—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è</h2>
            <form id="transaction-form" class="space-y-4">
                <input type="hidden" id="transaction-id">
                <input type="hidden" id="is-recurring-edit" value="false">

                <div class="flex justify-around">
                    <label class="flex items-center gap-2 cursor-pointer"><input type="radio" name="type" value="income" class="form-radio text-green-500" checked><span class="text-green-600 font-semibold">–î–æ—Ö–æ–¥</span></label>
                    <label class="flex items-center gap-2 cursor-pointer"><input type="radio" name="type" value="expense" class="form-radio text-red-500"><span class="text-red-600 font-semibold">–†–∞—Å—Ö–æ–¥</span></label>
                </div>
                <div><label for="amount" class="block mb-1 font-semibold">–°—É–º–º–∞</label><input type="number" id="amount" class="w-full p-2 border border-slate-300 rounded-md bg-slate-50 text-slate-800" placeholder="0.00" required step="0.01"></div>
                <div><label for="category" class="block mb-1 font-semibold">–ö–∞—Ç–µ–≥–æ—Ä–∏—è</label><select id="category" class="w-full p-2 border border-slate-300 rounded-md bg-white text-slate-800"></select></div>
                <div><label for="account" class="block mb-1 font-semibold">–°—á–µ—Ç</label><select id="account" class="w-full p-2 border border-slate-300 rounded-md bg-white text-slate-800"></select></div>
                
                <div id="saving-goal-field" class="hidden">
                    <label for="saving-goal" class="block mb-1 font-semibold">–ü—Ä–∏–≤—è–∑–∞—Ç—å –∫ —Ü–µ–ª–∏</label>
                    <select id="saving-goal" class="w-full p-2 border border-slate-300 rounded-md bg-white text-slate-800">
                        <option value="">–ù–µ –ø—Ä–∏–≤—è–∑—ã–≤–∞—Ç—å</option>
                    </select>
                </div>

                <!-- –ù–û–í–û–ï –ü–û–õ–ï: –ü—Ä–∏–≤—è–∑–∞—Ç—å –∫ –¥–æ–ª–≥—É -->
                <div id="debt-linking-field" class="hidden">
                    <label for="link-debt" class="block mb-1 font-semibold">–ü—Ä–∏–≤—è–∑–∞—Ç—å –∫ –¥–æ–ª–≥—É</label>
                    <select id="link-debt" class="w-full p-2 border border-slate-300 rounded-md bg-white text-slate-800">
                        <option value="">–ù–µ –ø—Ä–∏–≤—è–∑—ã–≤–∞—Ç—å</option>
                    </select>
                </div>

                <div class="grid grid-cols-2 gap-4">
                    <div><label for="date" class="block mb-1 font-semibold">–î–∞—Ç–∞</label><input type="date" id="date" class="w-full p-2 border border-slate-300 rounded-md bg-slate-50 text-slate-800" required></div>
                    <div><label for="time" class="block mb-1 font-semibold">–í—Ä–µ–º—è</label><input type="time" id="time" class="w-full p-2 border border-slate-300 rounded-md bg-slate-50 text-slate-800"></div>
                </div>
                <div><label for="description" class="block mb-1 font-semibold">–û–ø–∏—Å–∞–Ω–∏–µ</label><textarea id="description" class="w-full p-2 border border-slate-300 rounded-md bg-slate-50 text-slate-800" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä, –∑–∞—Ä–ø–ª–∞—Ç–∞ –∑–∞ –º–µ—Å—è—Ü"></textarea></div>

                <!-- –ü–æ–ª—è –¥–ª—è –ø–æ–≤—Ç–æ—Ä—è—é—â–µ–π—Å—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ -->
                <div class="bg-slate-50 p-4 rounded-md border border-slate-200">
                    <label class="flex items-center gap-2 cursor-pointer mb-3">
                        <input type="checkbox" id="is-recurring" class="form-checkbox text-violet-600">
                        <span class="font-semibold text-slate-700">–ü–æ–≤—Ç–æ—Ä—è—é—â–∞—è—Å—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è</span>
                    </label>
                    <div id="recurring-options" class="space-y-3 hidden">
                        <div>
                            <label for="frequency" class="block mb-1 text-sm font-semibold">–ß–∞—Å—Ç–æ—Ç–∞</label>
                            <select id="frequency" class="w-full p-2 border border-slate-300 rounded-md bg-white text-slate-800">
                                <option value="daily">–ï–∂–µ–¥–Ω–µ–≤–Ω–æ</option>
                                <option value="weekly">–ï–∂–µ–Ω–µ–¥–µ–ª—å–Ω–æ</option>
                                <option value="monthly">–ï–∂–µ–º–µ—Å—è—á–Ω–æ</option>
                                <option value="yearly">–ï–∂–µ–≥–æ–¥–Ω–æ</option>
                            </select>
                        </div>
                        <div>
                            <label for="recurring-start-date" class="block mb-1 text-sm font-semibold">–î–∞—Ç–∞ –Ω–∞—á–∞–ª–∞</label>
                            <input type="date" id="recurring-start-date" class="w-full p-2 border border-slate-300 rounded-md bg-slate-50 text-slate-800">
                        </div>
                        <div>
                            <label for="recurring-end-date" class="block mb-1 text-sm font-semibold">–î–∞—Ç–∞ –æ–∫–æ–Ω—á–∞–Ω–∏—è (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)</label>
                            <input type="date" id="recurring-end-date" class="w-full p-2 border border-slate-300 rounded-md bg-slate-50 text-slate-800">
                        </div>
                    </div>
                </div>

                <div class="flex justify-end pt-4"><button type="submit" class="bg-violet-600 text-white px-6 py-2 rounded-lg shadow hover:bg-violet-700 transition-colors">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button></div>
            </form>
        </div>
    </div>

    <div id="view-modal" class="fixed inset-0 z-50 bg-black/60 flex justify-center items-center p-4 hidden">
        <div class="bg-white rounded-lg shadow-2xl p-6 w-full max-w-md relative max-h-[90vh] overflow-y-auto modal-scrollable-content">
            <span id="close-view-modal-btn" class="absolute top-3 right-4 text-gray-400 hover:text-gray-700 text-3xl font-bold cursor-pointer">&times;</span>
            <h2 id="view-modal-title" class="text-2xl font-bold text-center mb-6">–î–µ—Ç–∞–ª–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏</h2>
            <div class="space-y-4">
                <div class="flex justify-between items-center"><span class="font-semibold text-gray-500">–¢–∏–ø:</span><span id="view-type" class="font-bold"></span></div>
                <div class="flex justify-between items-center"><span class="font-semibold text-gray-500">–°—É–º–º–∞:</span><span id="view-amount" class="font-bold text-lg"></span></div>
                <div class="flex justify-between items-center"><span class="font-semibold text-gray-500">–ö–∞—Ç–µ–≥–æ—Ä–∏—è:</span><span id="view-category"></span></div>
                <div class="flex justify-between items-center"><span class="font-semibold text-gray-500">–°—á–µ—Ç:</span><span id="view-account"></span></div>
                <div id="view-saving-goal-row" class="flex justify-between items-center hidden"><span class="font-semibold text-gray-500">–ü—Ä–∏–≤—è–∑–∞–Ω–æ –∫ —Ü–µ–ª–∏:</span><span id="view-saving-goal"></span></div>
                <!-- –ù–û–í–ê–Ø –°–¢–†–û–ö–ê –í view-modal -->
                <div id="view-debt-row" class="flex justify-between items-center hidden"><span class="font-semibold text-gray-500">–ü—Ä–∏–≤—è–∑–∞–Ω–æ –∫ –¥–æ–ª–≥—É:</span><span id="view-debt"></span></div>
                <div class="flex justify-between items-center"><span class="font-semibold text-gray-500">–î–∞—Ç–∞:</span><span id="view-date"></span></div>
                <div><label for="view-time" class="font-semibold text-gray-500 block">–í—Ä–µ–º—è:</label><span id="view-time"></span></div>
                <div>
                    <p class="font-semibold text-gray-500 mb-1">–û–ø–∏—Å–∞–Ω–∏–µ:</p>
                    <p id="view-description" class="bg-slate-100 p-3 rounded-md min-h-[60px]"></p>
                </div>
            </div>
        </div>
    </div>

    <div id="confirm-modal" class="fixed inset-0 z-50 bg-black/60 flex justify-center items-center p-4 hidden">
        <div class="bg-white rounded-lg shadow-2xl p-6 w-full max-w-sm relative max-h-[90vh] overflow-y-auto modal-scrollable-content">
            <h2 id="confirm-modal-title" class="text-2xl font-bold text-center mb-4 text-slate-800">–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ</h2>
            <p id="confirm-modal-message" class="text-center mb-6 text-slate-600">–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å?</p>
            <div class="flex justify-center gap-4">
                <button id="confirm-cancel-btn" class="bg-gray-300 text-gray-800 px-6 py-2 rounded-lg shadow hover:bg-gray-400 transition-colors">–û—Ç–º–µ–Ω–∞</button>
                <button id="confirm-ok-btn" class="bg-red-600 text-white px-6 py-2 rounded-lg shadow hover:bg-red-700 transition-colors">–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å</button>
            </div>
        </div>
    </div>

    <!-- –ù–û–í–û–ï: –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –¥–æ–ª–≥–æ–≤ -->
    <div id="debt-modal" class="fixed inset-0 z-50 bg-black/60 flex justify-center items-center p-4 hidden">
        <div class="bg-white rounded-lg shadow-2xl p-6 w-full max-w-md relative max-h-[90vh] overflow-y-auto modal-scrollable-content">
            <span id="close-debt-modal-btn" class="absolute top-3 right-4 text-gray-400 hover:text-gray-700 text-3xl font-bold cursor-pointer">&times;</span>
            <h2 id="debt-modal-title" class="text-2xl font-bold text-center mb-6">–î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π –¥–æ–ª–≥</h2>
            <form id="debt-form" class="space-y-4">
                <input type="hidden" id="debt-form-id">
                <div>
                    <label for="debt-form-type" class="block mb-1 font-semibold">–¢–∏–ø –¥–æ–ª–≥–∞</label>
                    <select id="debt-form-type" class="w-full p-2 border border-slate-300 rounded-md bg-white text-slate-800">
                        <option value="iOwe">–Ø –¥–æ–ª–∂–µ–Ω</option>
                        <option value="owedToMe">–ú–Ω–µ –¥–æ–ª–∂–Ω—ã</option>
                    </select>
                </div>
                <div>
                    <label for="debt-form-person" class="block mb-1 font-semibold">–ö–æ–º—É/–ö—Ç–æ –¥–æ–ª–∂–µ–Ω</label>
                    <input type="text" id="debt-form-person" placeholder="–ò–º—è –∏–ª–∏ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è" class="w-full p-2 border border-slate-300 rounded-md bg-slate-50 text-slate-800" required>
                </div>
                <div>
                    <label for="debt-form-amount" class="block mb-1 font-semibold">–°—É–º–º–∞ –¥–æ–ª–≥–∞</label>
                    <input type="number" id="debt-form-amount" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä, 1000" min="0" step="0.01" class="w-full p-2 border border-slate-300 rounded-md bg-slate-50 text-slate-800" required>
                </div>
                <div>
                    <label for="debt-form-due-date" class="block mb-1 font-semibold">–°—Ä–æ–∫ –ø–æ–≥–∞—à–µ–Ω–∏—è</label>
                    <input type="date" id="debt-form-due-date" class="w-full p-2 border border-slate-300 rounded-md bg-slate-50 text-slate-800" required>
                </div>
                <div>
                    <label for="debt-form-description" class="block mb-1 font-semibold">–û–ø–∏—Å–∞–Ω–∏–µ (–Ω–µ–æ–±—è–∑.)</label>
                    <textarea id="debt-form-description" class="w-full p-2 border border-slate-300 rounded-md bg-slate-50 text-slate-800" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä, –¥–æ–ª–≥ –∑–∞ –º–∞—à–∏–Ω—É"></textarea>
                </div>
                <div class="flex justify-end pt-4">
                    <button type="submit" class="bg-violet-600 text-white px-6 py-2 rounded-lg shadow hover:bg-violet-700 transition-colors">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                </div>
            </form>
        </div>
    </div>


    <!-- –ù–æ–≤—ã–π –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å–ø—Ä–∞–≤–∫–∏ -->
    <div id="help-modal" class="fixed inset-0 z-50 bg-black/60 flex justify-center items-center p-4 hidden">
        <div class="bg-white rounded-lg shadow-2xl p-6 w-full max-w-2xl relative max-h-[90vh] overflow-y-auto modal-scrollable-content">
            <span id="close-help-modal-btn" class="absolute top-3 right-4 text-gray-400 hover:text-gray-700 text-3xl font-bold cursor-pointer">&times;</span>
            <h2 id="help-modal-title" class="text-2xl font-bold text-center mb-6 text-slate-800">–ö–∞–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –ø—Ä–æ–≥—Ä–∞–º–º–æ–π "–õ–∏—á–Ω—ã–π –ë—é–¥–∂–µ—Ç"</h2>
            <div class="space-y-4 text-slate-700">
                <p>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –≤–∞—à–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ª–∏—á–Ω—ã–º –±—é–¥–∂–µ—Ç–æ–º! –°–ª–µ–¥—É–π—Ç–µ —ç—Ç–∏–º —à–∞–≥–∞–º, —á—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å:</p>

                <h3 class="font-semibold text-lg text-violet-600">1. –ù–∞—á–Ω–∏—Ç–µ —Å –û–±–∑–æ—Ä–∞ (–î–∞—à–±–æ—Ä–¥)</h3>
                <p>–ù–∞ –≤–∫–ª–∞–¥–∫–µ "–û–±–∑–æ—Ä" –≤—ã —É–≤–∏–¥–∏—Ç–µ —Å–≤–æ–¥–∫—É –ø–æ –≤–∞—à–∏–º —Ñ–∏–Ω–∞–Ω—Å–∞–º:</p>
                <ul class="list-disc list-inside ml-4 space-y-1">
                    <li><b>–û–±—â–∏–µ –¥–æ—Ö–æ–¥—ã, —Ä–∞—Å—Ö–æ–¥—ã –∏ –±–∞–ª–∞–Ω—Å:</b> –ö—Ä–∞—Ç–∫–∏–π –æ—Ç—á—ë—Ç –ø–æ –≤—Å–µ–º –≤–∞—à–∏–º —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è–º.</li>
                    <li><b>–ë–∞–ª–∞–Ω—Å –ø–æ —Å—á–µ—Ç–∞–º:</b> –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Å—Ä–µ–¥—Å—Ç–≤ –ø–æ –≤–∞—à–∏–º —Å—á–µ—Ç–∞–º (–Ω–∞–ª–∏—á–Ω—ã–µ, –∫–∞—Ä—Ç–∞ –∏ —Ç.–¥.).</li>
                    <li><b>–¶–µ–ª–∏ –Ω–∞–∫–æ–ø–ª–µ–Ω–∏—è:</b> –ü—Ä–æ–≥—Ä–µ—Å—Å –ø–æ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—é –≤–∞—à–∏—Ö —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã—Ö —Ü–µ–ª–µ–π.</li>
                    <li><b>–ú–æ–∏ –¥–æ–ª–≥–∏:</b> –ö—Ä–∞—Ç–∫–∞—è —Å–≤–æ–¥–∫–∞ –ø–æ –∞–∫—Ç–∏–≤–Ω—ã–º –¥–æ–ª–≥–∞–º –∏ –æ–±—è–∑–∞—Ç–µ–ª—å—Å—Ç–≤–∞–º.</li>
                    <li><b>–ê–Ω–∞–ª–∏—Ç–∏–∫–∞:</b> –†–∞–∑–ª–∏—á–Ω—ã–µ –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–µ –¥–∏–∞–≥—Ä–∞–º–º—ã –¥–ª—è –≥–ª—É–±–æ–∫–æ–≥–æ –ø–æ–Ω–∏–º–∞–Ω–∏—è –≤–∞—à–∏—Ö —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã—Ö –ø–æ—Ç–æ–∫–æ–≤. –ó–¥–µ—Å—å –≤—ã –Ω–∞–π–¥–µ—Ç–µ:
                        <ul class="list-circle list-inside ml-4 space-y-1">
                            <li>**–ü–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º (–∫—Ä—É–≥–æ–≤–∞—è):** –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –¥–æ–ª—é –∫–∞–∂–¥–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –≤ –æ–±—â–∏—Ö –¥–æ—Ö–æ–¥–∞—Ö –∏–ª–∏ —Ä–∞—Å—Ö–æ–¥–∞—Ö.</li>
                            <li>**–ü–æ –º–µ—Å—è—Ü–∞–º (—Å—Ç–æ–ª–±—á–∞—Ç–∞—è):** –°—Ä–∞–≤–Ω–∏–≤–∞–µ—Ç –æ–±—â–∏–µ –¥–æ—Ö–æ–¥—ã –∏ —Ä–∞—Å—Ö–æ–¥—ã –∑–∞ –∫–∞–∂–¥—ã–π –º–µ—Å—è—Ü.</li>
                            <li>**–ë–∞–ª–∞–Ω—Å (–¥–∏–Ω–∞–º–∏–∫–∞) (–ª–∏–Ω–µ–π–Ω–∞—è):** –û—Ç–æ–±—Ä–∞–∂–∞–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–µ –≤–∞—à–µ–≥–æ –æ–±—â–µ–≥–æ –±–∞–ª–∞–Ω—Å–∞ —Å —Ç–µ—á–µ–Ω–∏–µ–º –≤—Ä–µ–º–µ–Ω–∏.</li>
                            <li>**–ö—É–º—É–ª—è—Ç–∏–≤–Ω–æ (—Å –æ–±–ª–∞—Å—Ç—è–º–∏):** –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç, –∫–∞–∫ –Ω–∞—Ä–∞—Å—Ç–∞—é—Ç –≤–∞—à–∏ –æ–±—â–∏–µ –¥–æ—Ö–æ–¥—ã –∏ —Ä–∞—Å—Ö–æ–¥—ã –∑–∞ –≤–µ—Å—å –ø–µ—Ä–∏–æ–¥.</li>
                        </ul>
                    </li>
                    <li><b>–ë—é–¥–∂–µ—Ç –Ω–∞ —Ç–µ–∫—É—â–∏–π –º–µ—Å—è—Ü:</b> –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ —Ç—Ä–∞—Ç –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã—Ö –±—é–¥–∂–µ—Ç–æ–≤.</li>
                </ul>

                <h3 class="font-semibold text-lg text-violet-600">2. –î–æ–±–∞–≤–ª—è–π—Ç–µ –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏</h3>
                <p>–ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ –≤–∫–ª–∞–¥–∫—É "–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏".</p>
                <ul class="list-disc list-inside ml-4 space-y-1">
                    <li>–ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É <b>"+ –î–æ–±–∞–≤–∏—Ç—å"</b>.</li>
                    <li><b>–í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø:</b> "–î–æ—Ö–æ–¥" –∏–ª–∏ "–†–∞—Å—Ö–æ–¥".</li>
                    <li><b>–°—É–º–º–∞:</b> –£–∫–∞–∂–∏—Ç–µ —Å—É–º–º—É —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏.</li>
                    <li><b>–ö–∞—Ç–µ–≥–æ—Ä–∏—è:</b> –í—ã–±–µ—Ä–∏—Ç–µ –∏–∑ —Å–ø–∏—Å–∫–∞ –∏–ª–∏ —Å–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—É—é –≤ "–ù–∞—Å—Ç—Ä–æ–π–∫–∞—Ö".</li>
                    <li><b>–°—á–µ—Ç:</b> –í—ã–±–µ—Ä–∏—Ç–µ, —Å –∫–∞–∫–æ–≥–æ —Å—á–µ—Ç–∞ –∏–ª–∏ –Ω–∞ –∫–∞–∫–æ–π —Å—á–µ—Ç –ø–æ—Å—Ç—É–ø–∏–ª–∏/–±—ã–ª–∏ –ø–æ—Ç—Ä–∞—á–µ–Ω—ã –¥–µ–Ω—å–≥–∏. –°—á–µ—Ç–∞ –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–ª—è—Ç—å –≤ "–ù–∞—Å—Ç—Ä–æ–π–∫–∞—Ö".</li>
                    <li><b>–î–∞—Ç–∞ –∏ –í—Ä–µ–º—è:</b> –£–∫–∞–∂–∏—Ç–µ, –∫–æ–≥–¥–∞ –ø—Ä–æ–∏–∑–æ—à–ª–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è.</li>
                    <li><b>–û–ø–∏—Å–∞–Ω–∏–µ:</b> –î–æ–±–∞–≤—å—Ç–µ –∫—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –¥–ª—è –ø–æ–Ω–∏–º–∞–Ω–∏—è —Å—É—Ç–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, "–ó–∞—Ä–ø–ª–∞—Ç–∞ –∑–∞ –º–∞–π", "–ü–æ–∫—É–ø–∫–∞ –ø—Ä–æ–¥—É–∫—Ç–æ–≤ –≤ —Å—É–ø–µ—Ä–º–∞—Ä–∫–µ—Ç–µ").</li>
                    <li><b>–ü–æ–≤—Ç–æ—Ä—è—é—â–∞—è—Å—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è:</b> –ï—Å–ª–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç —Ä–µ–≥—É–ª—è—Ä–Ω–æ (–∑–∞—Ä–ø–ª–∞—Ç–∞, –∞—Ä–µ–Ω–¥–∞), –æ—Ç–º–µ—Ç—å—Ç–µ —ç—Ç—É –æ–ø—Ü–∏—é –∏ –Ω–∞—Å—Ç—Ä–æ–π—Ç–µ —á–∞—Å—Ç–æ—Ç—É.</li>
                    <li><b>–ü—Ä–∏–≤—è–∑–∞—Ç—å –∫ —Ü–µ–ª–∏ (—Ç–æ–ª—å–∫–æ –¥–ª—è –¥–æ—Ö–æ–¥–æ–≤):</b> –ï—Å–ª–∏ –¥–æ—Ö–æ–¥ –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π —Ü–µ–ª–∏ –Ω–∞–∫–æ–ø–ª–µ–Ω–∏—è, –≤—ã–±–µ—Ä–∏—Ç–µ –µ—ë –∑–¥–µ—Å—å.</li>
                    <li><b>–ü—Ä–∏–≤—è–∑–∞—Ç—å –∫ –¥–æ–ª–≥—É:</b> –ï—Å–ª–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è —è–≤–ª—è–µ—Ç—Å—è –ø–æ–≥–∞—à–µ–Ω–∏–µ–º –¥–æ–ª–≥–∞ –∏–ª–∏ –ø–æ–ª—É—á–µ–Ω–∏–µ–º –≤—ã–ø–ª–∞—Ç—ã –ø–æ –¥–æ–ª–≥—É, –≤—ã–±–µ—Ä–∏—Ç–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π –¥–æ–ª–≥ –∑–¥–µ—Å—å.</li>
                    <li>–ù–∞–∂–º–∏—Ç–µ <b>"–°–æ—Ö—Ä–∞–Ω–∏—Ç—å"</b>.</li>
                </ul>

                <h3 class="font-semibold text-lg text-violet-600">3. –£–ø—Ä–∞–≤–ª—è–π—Ç–µ –ù–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏</h3>
                <p>–ù–∞ –≤–∫–ª–∞–¥–∫–µ "–ù–∞—Å—Ç—Ä–æ–π–∫–∏" –≤—ã –º–æ–∂–µ—Ç–µ:</p>
                <ul class="list-disc list-inside ml-4 space-y-1">
                    <li><b>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º–∏:</b> –î–æ–±–∞–≤–ª—è–π—Ç–µ, —É–¥–∞–ª—è–π—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –¥–æ—Ö–æ–¥–æ–≤ –∏ —Ä–∞—Å—Ö–æ–¥–æ–≤. –î–ª—è –∫–∞—Ç–µ–≥–æ—Ä–∏–π —Ä–∞—Å—Ö–æ–¥–æ–≤ –º–æ–∂–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –º–µ—Å—è—á–Ω—ã–π –±—é–¥–∂–µ—Ç, –∞ —Ç–∞–∫–∂–µ –≤—ã–±—Ä–∞—Ç—å –∏–∫–æ–Ω–∫—É –∏ —Ü–≤–µ—Ç.</li>
                    <li><b>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å—á–µ—Ç–∞–º–∏:</b> –°–æ–∑–¥–∞–≤–∞–π—Ç–µ –∏ —É–¥–∞–ª—è–π—Ç–µ —Å–≤–æ–∏ —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã–µ —Å—á–µ—Ç–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, "–ù–∞–ª–∏—á–Ω—ã–µ", "–ë–∞–Ω–∫–æ–≤—Å–∫–∞—è –∫–∞—Ä—Ç–∞", "–°–±–µ—Ä–µ–≥–∞—Ç–µ–ª—å–Ω—ã–π —Å—á–µ—Ç").</li>
                    <li><b>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ü–µ–ª—è–º–∏ –Ω–∞–∫–æ–ø–ª–µ–Ω–∏—è:</b> –î–æ–±–∞–≤–ª—è–π—Ç–µ –Ω–æ–≤—ã–µ —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã–µ —Ü–µ–ª–∏, —É–∫–∞–∑—ã–≤–∞—è —Ü–µ–ª–µ–≤—É—é —Å—É–º–º—É. –û—Ç—Å–ª–µ–∂–∏–≤–∞–π—Ç–µ –ø—Ä–æ–≥—Ä–µ—Å—Å –Ω–∞ –¥–∞—à–±–æ—Ä–¥–µ.</li>
                    <li><b>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–æ–ª–≥–∞–º–∏:</b> –î–æ–±–∞–≤–ª—è–π—Ç–µ –Ω–æ–≤—ã–µ –∑–∞–ø–∏—Å–∏ –æ –¥–æ–ª–≥–∞—Ö (–∫–∞–∫ —Ç–µ—Ö, —á—Ç–æ –≤–∞–º –¥–æ–ª–∂–Ω—ã, —Ç–∞–∫ –∏ —Ç–µ—Ö, —á—Ç–æ –¥–æ–ª–∂–Ω—ã –≤—ã), —É–∫–∞–∑—ã–≤–∞—è —Å—É–º–º—ã –∏ —Å—Ä–æ–∫–∏. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–Ω–æ–ø–∫—É "–î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π –¥–æ–ª–≥", —á—Ç–æ–±—ã –æ—Ç–∫—Ä—ã—Ç—å —Ñ–æ—Ä–º—É.</li>
                    <li><b>–ü–æ–≤—Ç–æ—Ä—è—é—â–∏–µ—Å—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏:</b> –ü—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞–π—Ç–µ –∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ —à–∞–±–ª–æ–Ω—ã –ø–æ–≤—Ç–æ—Ä—è—é—â–∏—Ö—Å—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π.</li>
                    <li><b>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã–º–∏:</b> –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–π—Ç–µ –≤—Å–µ —Å–≤–æ–∏ –¥–∞–Ω–Ω—ã–µ –≤ —Ñ–æ—Ä–º–∞—Ç–µ JSON –¥–ª—è —Ä–µ–∑–µ—Ä–≤–Ω–æ–≥–æ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è –∏–ª–∏ –ø–µ—Ä–µ–Ω–æ—Å–∞.</li>
                </ul>

                <h3 class="font-semibold text-lg text-violet-600">4. –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –∏ –ü–æ–∏—Å–∫ –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–π</h3>
                <p>–ù–∞ –≤–∫–ª–∞–¥–∫–µ "–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏" –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã –∏ –ø–æ–∏—Å–∫, —á—Ç–æ–±—ã –±—ã—Å—Ç—Ä–æ –Ω–∞–π—Ç–∏ –Ω—É–∂–Ω—ã–µ –∑–∞–ø–∏—Å–∏:</p>
                <ul class="list-disc list-inside ml-4 space-y-1">
                    <li>–§–∏–ª—å—Ç—Ä—É–π—Ç–µ –ø–æ —Ç–∏–ø—É (–¥–æ—Ö–æ–¥—ã/—Ä–∞—Å—Ö–æ–¥—ã), –∫–∞—Ç–µ–≥–æ—Ä–∏–∏, —Å—á–µ—Ç—É.</li>
                    <li>–ò—â–∏—Ç–µ –ø–æ –æ–ø–∏—Å–∞–Ω–∏—é, –¥–∞—Ç–µ –∏–ª–∏ –¥–∏–∞–ø–∞–∑–æ–Ω—É —Å—É–º–º.</li>
                    <li>–°–æ—Ä—Ç–∏—Ä—É–π—Ç–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –¥–ª—è —É–¥–æ–±–Ω–æ–≥–æ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞.</li>
                </ul>

                <h3 class="font-semibold text-lg text-violet-600 mb-2">–ü—Ä–∏–º–µ—Ä—ã –∏–∫–æ–Ω–æ–∫ –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è</h3>
                <p class="mb-4">–î–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —ç—Ç–∏—Ö –∏–∫–æ–Ω–æ–∫ –≤ –ø–æ–ª–µ "Font Awesome Class" –Ω—É–∂–Ω–æ –ø—Ä–æ—Å—Ç–æ –≤—Å—Ç–∞–≤–ª—è—Ç—å –∫–ª–∞—Å—Å, –Ω–∞–ø—Ä–∏–º–µ—Ä: <code>fa-solid fa-pizza-slice</code>.</p>

                <h4 class="font-semibold text-md text-slate-700">–û–±—â–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏:</h4>
                <ul class="list-none ml-4 space-y-1">
                    <li><i class="fa-solid fa-tag text-violet-500 w-6"></i> <code>fa-solid fa-tag</code> (–¢—ç–≥, –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)</li>
                    <li><i class="fa-solid fa-star text-yellow-500 w-6"></i> <code>fa-solid fa-star</code> (–ó–≤–µ–∑–¥–∞, —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π)</li>
                    <li><i class="fa-solid fa-lightbulb text-orange-500 w-6"></i> <code>fa-solid fa-lightbulb</code> (–õ–∞–º–ø–æ—á–∫–∞, –∏–¥–µ–∏/–ø—Ä–æ–µ–∫—Ç—ã)</li>
                    <li><i class="fa-solid fa-handshake text-blue-500 w-6"></i> <code>fa-solid fa-handshake</code> (–†—É–∫–æ–ø–æ–∂–∞—Ç–∏–µ, —Å–¥–µ–ª–∫–∏/–¥–æ–≥–æ–≤–æ—Ä—ã)</li>
                    <li><i class="fa-solid fa-heart text-red-500 w-6"></i> <code>fa-solid fa-heart</code> (–°–µ—Ä–¥—Ü–µ, –ª—é–±–æ–≤—å/–ø–æ–¥–∞—Ä–∫–∏)</li>
                    <li><i class="fa-solid fa-building text-gray-700 w-6"></i> <code>fa-solid fa-building</code> (–ó–¥–∞–Ω–∏–µ, –∞—Ä–µ–Ω–¥–∞/–Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç—å)</li>
                    <li><i class="fa-solid fa-umbrella text-blue-400 w-6"></i> <code>fa-solid fa-umbrella</code> (–ó–æ–Ω—Ç, —Å—Ç—Ä–∞—Ö–æ–≤–∫–∞/–∑–∞—â–∏—Ç–∞)</li>
                    <li><i class="fa-solid fa-plane text-sky-500 w-6"></i> <code>fa-solid fa-plane</code> (–°–∞–º–æ–ª–µ—Ç, –ø—É—Ç–µ—à–µ—Å—Ç–≤–∏—è)</li>
                    <li><i class="fa-solid fa-wrench text-amber-600 w-6"></i> <code>fa-solid fa-wrench</code> (–ì–∞–µ—á–Ω—ã–π –∫–ª—é—á, —Ä–µ–º–æ–Ω—Ç/–æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ)</li>
                </ul>

                <h4 class="font-semibold text-md text-slate-700 mt-4">–î–æ—Ö–æ–¥—ã:</h4>
                <ul class="list-none ml-4 space-y-1">
                    <li><i class="fa-solid fa-sack-dollar text-green-600 w-6"></i> <code>fa-solid fa-sack-dollar</code> (–ú–µ—à–æ–∫ —Å –¥–µ–Ω—å–≥–∞–º–∏, –æ–±—â–∏–µ –¥–æ—Ö–æ–¥—ã)</li>
                    <li><i class="fa-solid fa-piggy-bank text-pink-500 w-6"></i> <code>fa-solid fa-piggy-bank</code> (–ö–æ–ø–∏–ª–∫–∞, —Å–±–µ—Ä–µ–∂–µ–Ω–∏—è)</li>
                    <li><i class="fa-solid fa-gifts text-purple-500 w-6"></i> <code>fa-solid fa-gifts</code> (–ü–æ–¥–∞—Ä–∫–∏)</li>
                    <li><i class="fa-solid fa-money-bill-transfer text-emerald-500 w-6"></i> <code>fa-solid fa-money-bill-transfer</code> (–ü–µ—Ä–µ–≤–æ–¥ –¥–µ–Ω–µ–≥)</li>
                    <li><i class="fa-solid fa-wallet text-indigo-500 w-6"></i> <code>fa-solid fa-wallet</code> (–ö–æ—à–µ–ª–µ–∫)</li>
                    <li><i class="fa-solid fa-briefcase text-gray-600 w-6"></i> <code>fa-solid fa-briefcase</code> (–ü–æ—Ä—Ç—Ñ–µ–ª—å, —Ä–∞–±–æ—Ç–∞/–±–∏–∑–Ω–µ—Å)</li>
                    <li><i class="fa-solid fa-medal text-yellow-600 w-6"></i> <code>fa-solid fa-medal</code> (–ú–µ–¥–∞–ª—å, –ø—Ä–µ–º–∏–∏/–¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è)</li>
                    <li><i class="fa-solid fa-chart-line text-lime-600 w-6"></i> <code>fa-solid fa-chart-line</code> (–ì—Ä–∞—Ñ–∏–∫ —Ä–æ—Å—Ç–∞, –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏)</li>
                </ul>

                <h4 class="font-semibold text-md text-slate-700 mt-4">–†–∞—Å—Ö–æ–¥—ã:</h4>
                <ul class="list-none ml-4 space-y-1">
                    <li><i class="fa-solid fa-cart-shopping text-red-500 w-6"></i> <code>fa-solid fa-cart-shopping</code> (–ö–æ—Ä–∑–∏–Ω–∞ –¥–ª—è –ø–æ–∫—É–ø–æ–∫, –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)</li>
                    <li><i class="fa-solid fa-burger text-amber-500 w-6"></i> <code>fa-solid fa-burger</code> (–ë—É—Ä–≥–µ—Ä, –µ–¥–∞/—Ñ–∞—Å—Ç—Ñ—É–¥)</li>
                    <li><i class="fa-solid fa-gas-pump text-gray-500 w-6"></i> <code>fa-solid fa-gas-pump</code> (–ë–µ–Ω–∑–æ–∫–æ–ª–æ–Ω–∫–∞, —Ç–æ–ø–ª–∏–≤–æ)</li>
                    <li><i class="fa-solid fa-film text-indigo-600 w-6"></i> <code>fa-solid fa-film</code> (–ö–∏–Ω–æ–ª–µ–Ω—Ç–∞, —Ä–∞–∑–≤–ª–µ—á–µ–Ω–∏—è)</li>
                    <li><i class="fa-solid fa-house-chimney text-green-700 w-6"></i> <code>fa-solid fa-house-chimney</code> (–î–æ–º —Å —Ç—Ä—É–±–æ–π, –ñ–ö–•/–∞—Ä–µ–Ω–¥–∞)</li>
                    <li><i class="fa-solid fa-graduation-cap text-sky-700 w-6"></i> <code>fa-solid fa-graduation-cap</code> (–®–∞–ø–æ—á–∫–∞ –≤—ã–ø—É—Å–∫–Ω–∏–∫–∞, –æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ)</li>
                    <li><i class="fa-solid fa-dumbbell text-slate-600 w-6"></i> <code>fa-solid fa-dumbbell</code> (–ì–∞–Ω—Ç–µ–ª—å, —Å–ø–æ—Ä—Ç/—Ñ–∏—Ç–Ω–µ—Å)</li>
                    <li><i class="fa-solid fa-medkit text-red-600 w-6"></i> <code>fa-solid fa-medkit</code> (–ê–ø—Ç–µ—á–∫–∞, –º–µ–¥–∏—Ü–∏–Ω–∞/–∑–¥–æ—Ä–æ–≤—å–µ)</li>
                    <li><i class="fa-solid fa-shirt text-blue-500 w-6"></i> <code>fa-solid fa-shirt</code> (–†—É–±–∞—à–∫–∞, –æ–¥–µ–∂–¥–∞)</li>
                    <li><i class="fa-solid fa-bus text-orange-600 w-6"></i> <code>fa-solid fa-bus</code> (–ê–≤—Ç–æ–±—É—Å, –æ–±—â–µ—Å—Ç–≤–µ–Ω–Ω—ã–π —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç)</li>
                    <li><i class="fa-solid fa-utensils text-yellow-700 w-6"></i> <code>fa-solid fa-utensils</code> (–ü—Ä–∏–±–æ—Ä—ã, —Ä–µ—Å—Ç–æ—Ä–∞–Ω—ã/–∫–∞—Ñ–µ)</li>
                    <li><i class="fa-solid fa-mobile-screen-button text-purple-600 w-6"></i> <code>fa-solid fa-mobile-screen-button</code> (–¢–µ–ª–µ—Ñ–æ–Ω, —Å–≤—è–∑—å/–∏–Ω—Ç–µ—Ä–Ω–µ—Ç)</li>
                    <li><i class="fa-solid fa-gamepad text-violet-700 w-6"></i> <code>fa-solid fa-gamepad</code> (–ì–µ–π–º–ø–∞–¥, –∏–≥—Ä—ã)</li>
                    <li><i class="fa-solid fa-cat text-fuchsia-500 w-6"></i> <code>fa-solid fa-cat</code> (–ö–æ—à–∫–∞, –¥–æ–º–∞—à–Ω–∏–µ –∂–∏–≤–æ—Ç–Ω—ã–µ)</li>
                    <li><i class="fa-solid fa-gift text-pink-600 w-6"></i> <code>fa-solid fa-gift</code> (–ü–æ–¥–∞—Ä–æ–∫, –µ—Å–ª–∏ —ç—Ç–æ –≤–∞—à–∏ —Ä–∞—Å—Ö–æ–¥—ã –Ω–∞ –ø–æ–¥–∞—Ä–∫–∏)</li>
                    <li><i class="fa-solid fa-wine-glass text-rose-500 w-6"></i> <code>fa-solid fa-wine-glass</code> (–ë–æ–∫–∞–ª –≤–∏–Ω–∞, –¥–æ—Å—É–≥/–±–∞—Ä—ã)</li>
                </ul>

                <h4 class="font-semibold text-md text-slate-700 mt-4">–ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤ –ø–æ–ª—è—Ö "Font Awesome Class":</h4>
                <ul class="list-disc list-inside ml-4 space-y-1">
                    <li>–î–ª—è –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ ‚Äú–ï–¥–∞‚Äù: <code class="bg-slate-100 p-1 rounded">fa-solid fa-burger</code> (–∏ —Ü–≤–µ—Ç, –Ω–∞–ø—Ä–∏–º–µ—Ä, <code class="bg-slate-100 p-1 rounded">#FFD700</code>)</li>
                    <li>–î–ª—è –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ ‚Äú–¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç‚Äù: <code class="bg-slate-100 p-1 rounded">fa-solid fa-bus</code> (–∏ —Ü–≤–µ—Ç, –Ω–∞–ø—Ä–∏–º–µ—Ä, <code class="bg-slate-100 p-1 rounded">#800080</code>)</li>
                    <li>–î–ª—è –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ ‚Äú–ó–∞—Ä–ø–ª–∞—Ç–∞‚Äù: <code class="bg-slate-100 p-1 rounded">fa-solid fa-sack-dollar</code> (–∏ —Ü–≤–µ—Ç, –Ω–∞–ø—Ä–∏–º–µ—Ä, <code class="bg-slate-100 p-1 rounded">#3CB371</code>)</li>
                    <li>–î–ª—è –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ ‚Äú–†–∞–∑–≤–ª–µ—á–µ–Ω–∏—è‚Äù: <code class="bg-slate-100 p-1 rounded">fa-solid fa-gamepad</code> (–∏ —Ü–≤–µ—Ç, –Ω–∞–ø—Ä–∏–º–µ—Ä, <code class="bg-slate-100 p-1 rounded">#FF6347</code>)</li>
                </ul>

                <p class="mt-6">–£–¥–∞—á–∏ –≤ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–∏ –≤–∞—à–∏–º –ª–∏—á–Ω—ã–º –±—é–¥–∂–µ—Ç–æ–º!</p>
            </div>
        </div>
    </div>
    
    <!-- –ù–û–í–û–ï: –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –ø—Ä–æ–µ–∫—Ç–∞ -->
    <div id="support-modal" class="fixed inset-0 z-50 bg-black/60 flex justify-center items-center p-4 hidden">
        <div class="bg-white rounded-lg shadow-2xl p-6 w-full max-w-md relative max-h-[90vh] overflow-y-auto modal-scrollable-content">
            <span id="close-support-modal-btn" class="absolute top-3 right-4 text-gray-400 hover:text-gray-700 text-3xl font-bold cursor-pointer">&times;</span>
            <h2 class="text-2xl font-bold text-center mb-6 text-violet-600">–ü–æ–¥–¥–µ—Ä–∂–∞—Ç—å –ø—Ä–æ–µ–∫—Ç Budget Pro ‚≠ê</h2>

            <div class="space-y-6">
                <p class="text-slate-700 text-center">–í–∞—à–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –ø–æ–º–æ–≥–∞–µ—Ç —Ä–∞–∑–≤–∏—Ç–∏—é –ø—Ä–æ–µ–∫—Ç–∞ –∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏—é –Ω–æ–≤—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π! –°–ø–∞—Å–∏–±–æ!</p>

                <!-- –û–ø—Ü–∏—è 1: –¢–µ–ª–µ—Ñ–æ–Ω -->
                <div class="bg-violet-50 p-4 rounded-lg border border-violet-200">
                    <h3 class="font-semibold text-lg mb-2 text-violet-800 flex items-center gap-2">
                        <i class="fa-solid fa-phone"></i> –ü–µ—Ä–µ–≤–æ–¥ –ø–æ –Ω–æ–º–µ—Ä—É —Ç–µ–ª–µ—Ñ–æ–Ω–∞:
                    </h3>
                    <div class="flex items-center justify-between bg-white p-3 rounded-md shadow-inner border border-violet-300">
                        <!-- ID –¥–ª—è –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è -->
                        <code id="support-phone-number" class="font-mono text-slate-700 text-lg select-all">
                            +7 995 554 79 11
                        </code>
                        <button class="copy-btn text-violet-600 hover:text-violet-800 transition-colors p-1" data-copy-target="support-phone-number" title="–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å">
                            <i class="fa-regular fa-clipboard text-xl"></i>
                        </button>
                    </div>
                </div>

                <!-- –û–ø—Ü–∏—è 2: –ö–∞—Ä—Ç–∞ -->
                <div class="bg-violet-50 p-4 rounded-lg border border-violet-200">
                    <h3 class="font-semibold text-lg mb-2 text-violet-800 flex items-center gap-2">
                        <i class="fa-solid fa-credit-card"></i> –ü–µ—Ä–µ–≤–æ–¥ —Ç–µ–ª–µ—Ñ–æ–Ω—É
                    </h3>
                    <div class="flex items-center justify-between bg-white p-3 rounded-md shadow-inner border border-violet-300">
                        <!-- ID –¥–ª—è –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è -->
                        <code id="support-card-code" class="font-mono text-slate-700 text-lg select-all">
                            –¢–±–∞–Ω–∫
                        </code>
                        <button class="copy-btn text-violet-600 hover:text-violet-800 transition-colors p-1" data-copy-target="support-card-code" title="–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å">
                            <i class="fa-regular fa-clipboard text-xl"></i>
                        </button>
                    </div>
                </div>
            </div>
            <p class="text-center text-xs text-slate-400 mt-6">
                *–í–≤–µ–¥–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ —è–≤–ª—è—é—Ç—Å—è –ø—Ä–∏–º–µ—Ä–æ–º. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ä–µ–∞–ª—å–Ω—ã–µ —Ä–µ–∫–≤–∏–∑–∏—Ç—ã –¥–ª—è –≤–∞—à–µ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞.
            </p>
        </div>
    </div>
    <!-- –ö–û–ù–ï–¶ –ù–û–í–û–ì–û –ú–û–î–ê–õ–¨–ù–û–ì–û –û–ö–ù–ê -->


    <!-- –ö–Ω–æ–ø–∫–∞ –û—Ç–º–µ–Ω–∏—Ç—å —É–¥–∞–ª–µ–Ω–∏–µ -->
    <div id="undo-container" class="fixed bottom-4 left-1/2 -translate-x-1/2 z-50 transition-all duration-300 transform opacity-0 scale-0 pointer-events-none">
        <button id="undo-btn" class="bg-blue-600 text-white px-5 py-3 rounded-full shadow-lg hover:bg-blue-700 transition-colors flex items-center gap-2">
            <span class="text-xl">‚Ü©Ô∏è</span>
            <span>–û—Ç–º–µ–Ω–∏—Ç—å</span>
        </button>
    </div>

    <!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è —Ç–æ—Å—Ç–æ–≤/—É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π -->
    <div id="toast-container" class="fixed top-4 right-4 z-[9999] space-y-3">
        <!-- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –±—É–¥—É—Ç –∑–¥–µ—Å—å -->
    </div>

    <script>
    document.addEventListener('DOMContentLoaded', () => {
        // --- –ì–ª–æ–±–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ ---
        let transactions = []; // –û—Å–Ω–æ–≤–Ω–æ–π —Å–ø–∏—Å–æ–∫ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
        let categories = { // –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ —Ç–µ–ø–µ—Ä—å –æ–±—ä–µ–∫—Ç—ã —Å –±—é–¥–∂–µ—Ç–æ–º, –∏–∫–æ–Ω–∫–æ–π –ò –¶–í–ï–¢–û–ú
            income: [
                { id: 'inc1', name: '–ó–∞—Ä–ø–ª–∞—Ç–∞', icon: 'fa-solid fa-money-bill-wave', color: '#22c55e' },
                { id: 'inc2', name: '–ü–æ–¥–∞—Ä–æ–∫', icon: 'fa-solid fa-gift', color: '#14b8a6' },
                { id: 'inc3', name: '–§—Ä–∏–ª–∞–Ω—Å', icon: 'fa-solid fa-laptop-code', color: '#0ea5e9' }
            ],
            expense: [
                { id: 'exp1', name: '–ü—Ä–æ–¥—É–∫—Ç—ã', icon: 'fa-solid fa-cart-shopping', budget: 900, color: '#ef4444' },
                { id: 'exp2', name: '–¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç', icon: 'fa-solid fa-bus', budget: 1500, color: '#f97316' },
                { id: 'exp3', name: '–†–∞–∑–≤–ª–µ—á–µ–Ω–∏—è', icon: 'fa-solid fa-film', budget: 1, color: '#eab308' },
                { id: 'exp4', name: '–ñ–ö–•', icon: 'fa-solid fa-house-chimney', budget: 9, color: '#84cc16' },
                { id: 'exp5', name: '–û–¥–µ–∂–¥–∞', icon: 'fa-solid fa-shirt', budget: 1000, color: '#22c55e' },
                { id: 'exp6', name: '–ö–∞—Ä—Ç–∞', icon: 'fa-solid fa-credit-card', budget: 1111, color: '#00BFFF' }
            ]
        };
        let accounts = [ // –°–ø–∏—Å–æ–∫ —Å—á–µ—Ç–æ–≤
            { id: 'acc1', name: '–ù–∞–ª–∏—á–Ω—ã–µ', balance: 0 },
            { id: 'acc2', name: '–ë–∞–Ω–∫–æ–≤—Å–∫–∞—è –∫–∞—Ä—Ç–∞', balance: 0 }
        ];
        let recurringTransactions = []; // –®–∞–±–ª–æ–Ω—ã –ø–æ–≤—Ç–æ—Ä—è—é—â–∏—Ö—Å—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
        let savingGoals = []; // –¶–µ–ª–∏ –Ω–∞–∫–æ–ø–ª–µ–Ω–∏—è
        let debts = []; // –ù–û–í–û–ï: –î–æ–ª–≥–∏

        // --- –°–æ—Å—Ç–æ—è–Ω–∏–µ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –¥–∏–∞–≥—Ä–∞–º–º–∞–º–∏ ---
        let chartInstances = { // –û–±—ä–µ–∫—Ç –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è —ç–∫–∑–µ–º–ø–ª—è—Ä–æ–≤ Chart.js
            categoryPie: null,
            monthlyBar: null,
            balanceLine: null,
            cumulativeArea: null
        };
        let currentChartType = 'pie'; // –ê–∫—Ç–∏–≤–Ω—ã–π —Ç–∏–ø –¥–∏–∞–≥—Ä–∞–º–º—ã: 'pie', 'monthlyBar', 'balanceLine', 'cumulativeArea'
        let currentCategoryChartDataType = 'expense'; // –¢–∏–ø –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –∫–∞—Ç–µ–≥–æ—Ä–∏–π–Ω—ã—Ö –¥–∏–∞–≥—Ä–∞–º–º: 'expense', 'income'

        // --- –°–æ—Å—Ç–æ—è–Ω–∏–µ —Ñ–∏–ª—å—Ç—Ä–æ–≤ ---
        let currentFilters = {
            type: 'all',
            category: 'all',
            account: 'all',
            description: '',
            amountMin: null,
            amountMax: null,
            dateStart: null,
            dateEnd: null,
            sortOrder: 'date-desc'
        };

        // --- –°–æ—Å—Ç–æ—è–Ω–∏–µ –ø–∞–≥–∏–Ω–∞—Ü–∏–∏ ---
        let currentPage = 0;
        const transactionsPerPage = 4; // –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–∞—Ä—Ç–æ—á–µ–∫ –Ω–∞ –æ–¥–Ω–æ–π "—Å—Ç—Ä–∞–Ω–∏—Ü–µ"

        // --- –î–ª—è —Ñ—É–Ω–∫—Ü–∏–∏ –û—Ç–º–µ–Ω—ã ---
        let lastDeletedItem = null; // Stores { type: 'transaction'|'category'|'account'|'recurringTransaction'|'savingGoal'|'debt', data: {...} }
        let undoTimeoutId = null; // Stores the ID for the setTimeout to hide the undo button
        const UNDO_TIMEOUT_MS = 10000; // 10 —Å–µ–∫—É–Ω–¥, —á–µ—Ä–µ–∑ –∫–æ—Ç–æ—Ä—ã–µ –∫–Ω–æ–ø–∫–∞ –û—Ç–º–µ–Ω–∏—Ç—å –∏—Å—á–µ–∑–Ω–µ—Ç

        // --- DOM –≠–ª–µ–º–µ–Ω—Ç—ã ---
        const appContainer = document.getElementById('app-container');
        const transactionModal = document.getElementById('transaction-modal');
        const viewModal = document.getElementById('view-modal');
        const confirmModal = document.getElementById('confirm-modal');
        const debtModal = document.getElementById('debt-modal'); // –ù–û–í–û–ï: –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–æ–ª–≥–æ–≤
        const helpModal = document.getElementById('help-modal');
        // –ù–û–í–´–ï –≠–õ–ï–ú–ï–ù–¢–´ –î–õ–Ø –ü–û–î–î–ï–†–ñ–ö–ò
        const supportModal = document.getElementById('support-modal'); 
        const openSupportModalBtnDesktop = document.getElementById('open-support-modal-desktop');
        const openSupportModalBtnMobile = document.getElementById('open-support-modal-mobile');
        // –ö–û–ù–ï–¶ –ù–û–í–´–• –≠–õ–ï–ú–ï–ù–¢–û–í
        const openHelpModalBtn = document.getElementById('open-help-modal-btn');
        const closeHelpModalBtn = document.getElementById('close-help-modal-btn');
        const confirmModalTitle = document.getElementById('confirm-modal-title');
        const confirmModalMessage = document.getElementById('confirm-modal-message');
        const confirmOkBtn = document.getElementById('confirm-ok-btn');
        const confirmCancelBtn = document.getElementById('confirm-cancel-btn');
        const transactionForm = document.getElementById('transaction-form');
        const debtForm = document.getElementById('debt-form'); // –ù–û–í–û–ï: –§–æ—Ä–º–∞ –¥–æ–ª–≥–æ–≤
        const toastContainer = document.getElementById('toast-container');
        
        const undoContainer = document.getElementById('undo-container');
        const undoBtn = document.getElementById('undo-btn');

        const mobileMenu = document.getElementById('mobile-menu');
        const mobileMenuOverlay = document.getElementById('mobile-menu-overlay');
        const mobileHeader = document.getElementById('mobile-header');
        let lastScrollTop = 0;

        // --- –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ ---
        const generateUniqueId = (prefix = 'id') => `${prefix}${Date.now()}-${Math.random().toString(36).substr(2, 9)}`;
        const formatDate = (dateString) => {
            if (!dateString) return '–ù–µ —É–∫–∞–∑–∞–Ω–æ';
            const date = new Date(dateString);
            if (isNaN(date.getTime())) return '–ù–µ–≤–µ—Ä–Ω–∞—è –¥–∞—Ç–∞';
            return date.toLocaleDateString('ru-RU');
        };
        const formatCurrency = (amount) => parseFloat(amount).toLocaleString('ru-RU', { style: 'currency', currency: 'RUB', minimumFractionDigits: 0, maximumFractionDigits: 2 });
        const getCategoryById = (id, type) => categories[type]?.find(cat => cat.id === id);
        const getAccountById = (id) => accounts.find(acc => acc.id === id);
        const getSavingGoalById = (id) => savingGoals.find(goal => goal.id === id);
        const getDebtById = (id) => debts.find(debt => debt.id === id); // –ù–û–í–û–ï: –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–æ–ª–≥–∞ –ø–æ ID

        // --- –¶–≤–µ—Ç–∞ –¥–ª—è –≥—Ä–∞—Ñ–∏–∫–æ–≤ ---
        const CHART_COLORS = {
            income: ['#22c55e', '#14b8a6', '#0ea5e9', '#6366f1', '#a855f7', '#d946ef', '#f472b6', '#fb7185', '#f87171', '#fb923c'],
            expense: ['#ef4444', '#f97316', '#eab308', '#84cc16', '#22c55e', '#14b8a6', '#0ea5e9', '#6366f1', '#a855f7', '#d946ef'],
            balance: '#6366f1', // violet-500
            lightBlue: '#38bdf8', // sky-400
            red: '#ef4444', // red-500
            green: '#22c55e', // green-500
            gray: '#6b7280' // gray-500
        };

        const generateDynamicColors = (numColors) => {
            const colors = [];
            for (let i = 0; i < numColors; i++) {
                const hue = (i * 137.508) % 360;
                colors.push(`hsl(${hue}, 70%, 50%)`);
            }
            return colors;
        };


        // --- –£–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–∫—Ä—É—Ç–∫–æ–π —Ç–µ–ª–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –∏ —Ä–∞–∑–º—ã—Ç–∏–µ–º ---
        const updateBodyScrollAndBlur = () => {
            const isAnyModalOpen = !transactionModal.classList.contains('hidden') ||
                                   !viewModal.classList.contains('hidden') ||
                                   !confirmModal.classList.contains('hidden') ||
                                   !debtModal.classList.contains('hidden') || // –î–æ–±–∞–≤–ª–µ–Ω–æ –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–æ–ª–≥–æ–≤
                                   !helpModal.classList.contains('hidden') ||
                                   !supportModal.classList.contains('hidden'); // –î–û–ë–ê–í–õ–ï–ù–û
            const isMobileMenuOpen = mobileMenu.classList.contains('translate-x-0');

            if (isMobileMenuOpen || isAnyModalOpen) {
                document.body.classList.add('overflow-hidden');
                appContainer.classList.add('blur-sm', 'pointer-events-none');
            } else {
                // –ó–∞–¥–µ—Ä–∂–∫–∞, —á—Ç–æ–±—ã –∞–Ω–∏–º–∞—Ü–∏—è –∑–∞–∫—Ä—ã—Ç–∏—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ —É—Å–ø–µ–ª–∞ –æ—Ç—Ä–∞–±–æ—Ç–∞—Ç—å
                setTimeout(() => { 
                    // –£–±–µ–¥–∏–º—Å—è, —á—Ç–æ –Ω–∏–∫–∞–∫–∏–µ –º–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ –Ω–µ –æ—Ç–∫—Ä—ã—Ç—ã
                    if (!mobileMenu.classList.contains('translate-x-0') &&
                        transactionModal.classList.contains('hidden') &&
                        viewModal.classList.contains('hidden') &&
                        confirmModal.classList.contains('hidden') &&
                        debtModal.classList.contains('hidden') && // –î–æ–±–∞–≤–ª–µ–Ω–æ –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–æ–ª–≥–æ–≤
                        helpModal.classList.contains('hidden') &&
                        supportModal.classList.contains('hidden')) { // –î–û–ë–ê–í–õ–ï–ù–û
                        
                        document.body.classList.remove('overflow-hidden');
                        appContainer.classList.remove('blur-sm', 'pointer-events-none');
                    }
                }, 350); // –î–æ–ª–∂–Ω–æ –±—ã—Ç—å –Ω–µ–º–Ω–æ–≥–æ –±–æ–ª—å—à–µ, —á–µ–º transition-duration –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
            }
        };

        // --- –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–∫–∞–∑–∞ —Ç–æ—Å—Ç-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π ---
        const showToast = (message, type = 'info', duration = 3000) => {
            const toast = document.createElement('div');
            let icon = '';
            let classes = 'p-4 rounded-lg shadow-lg flex items-center gap-3 transition-all duration-300 transform translate-x-full opacity-0 ';

            switch (type) {
                case 'success':
                    icon = '‚úÖ';
                    classes += 'bg-green-100 text-green-800 border-l-4 border-green-500';
                    break;
                case 'error':
                    icon = '‚ùå';
                    classes += 'bg-red-100 text-red-800 border-l-4 border-red-500';
                    break;
                case 'warning':
                    icon = '‚ö†Ô∏è';
                    classes += 'bg-yellow-100 text-yellow-800 border-l-4 border-yellow-500';
                    break;
                case 'info':
                default:
                    icon = '‚ÑπÔ∏è';
                    classes += 'bg-blue-100 text-blue-800 border-l-4 border-blue-500';
                    break;
            }

            toast.className = classes;
            toast.innerHTML = `
                <span class="text-2xl">${icon}</span>
                <p class="flex-1">${message}</p>
                <button class="ml-auto text-gray-500 hover:text-gray-700 text-xl font-bold leading-none" onclick="this.closest('div').remove()">&times;`;
            

            toastContainer.appendChild(toast);

            setTimeout(() => {
                toast.classList.remove('translate-x-full', 'opacity-0');
                toast.classList.add('translate-x-0', 'opacity-100');
            }, 50);

            setTimeout(() => {
                toast.classList.remove('translate-x-0', 'opacity-100');
                toast.classList.add('translate-x-full', 'opacity-0');
                toast.addEventListener('transitionend', () => toast.remove());
            }, duration);
        };
        
        // --- –ù–û–í–ê–Ø –§–£–ù–ö–¶–ò–Ø: –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞ ---
        const copyToClipboard = async (elementId) => {
            const element = document.getElementById(elementId);
            if (!element) return;

            const textToCopy = element.textContent.trim().replace(/\s/g, ''); // –£–¥–∞–ª—è–µ–º –ø—Ä–æ–±–µ–ª—ã
            const button = document.querySelector(`.copy-btn[data-copy-target="${elementId}"]`);
            const icon = button.querySelector('i');
            
            try {
                await navigator.clipboard.writeText(textToCopy);
                showToast(`"${textToCopy}" —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞!`, 'success', 2000);

                // –í–∏–∑—É–∞–ª—å–Ω—ã–π —Ñ–∏–¥–±—ç–∫
                if (icon) {
                    icon.classList.remove('fa-regular', 'fa-clipboard', 'text-violet-600');
                    icon.classList.add('fa-solid', 'fa-check', 'text-green-500'); // –ú–µ–Ω—è–µ–º –∏–∫–æ–Ω–∫—É –Ω–∞ –≥–∞–ª–æ—á–∫—É
                    setTimeout(() => {
                        icon.classList.remove('fa-solid', 'fa-check', 'text-green-500');
                        icon.classList.add('fa-regular', 'fa-clipboard', 'text-violet-600');
                    }, 1500);
                }

            } catch (err) {
                console.error('Failed to copy text: ', err);
                showToast('–û—à–∏–±–∫–∞ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤–∞—à –±—Ä–∞—É–∑–µ—Ä —Ä–∞–∑—Ä–µ—à–∞–µ—Ç –¥–æ—Å—Ç—É–ø –∫ –±—É—Ñ–µ—Ä—É –æ–±–º–µ–Ω–∞.', 'error', 3000);
            }
        };
        // --- –ö–û–ù–ï–¶ –ù–û–í–û–ô –§–£–ù–ö–¶–ò–ò –ö–û–ü–ò–†–û–í–ê–ù–ò–Ø ---

        // --- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ–º ---
        const saveData = () => {
            localStorage.setItem('budgetAppData', JSON.stringify({ transactions, categories, accounts, recurringTransactions, savingGoals, debts })); // –ù–û–í–û–ï: –¥–æ–±–∞–≤–∏–ª–∏ debts
        };

        const loadData = () => {
            const data = localStorage.getItem('budgetAppData');
            if (data) {
                const parsedData = JSON.parse(data);
                transactions = parsedData.transactions || [];
                accounts = parsedData.accounts || accounts;
                recurringTransactions = parsedData.recurringTransactions || [];
                savingGoals = parsedData.savingGoals || []; 
                debts = parsedData.debts || []; // –ù–û–í–û–ï: –∑–∞–≥—Ä—É–∂–∞–µ–º debts

                // --- –õ–æ–≥–∏–∫–∞ –º–∏–≥—Ä–∞—Ü–∏–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–π: –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –∏–∫–æ–Ω–æ–∫ –∏ —Ü–≤–µ—Ç–æ–≤, –µ—Å–ª–∏ –∏—Ö –Ω–µ—Ç ---
                ['income', 'expense'].forEach(type => {
                    if (parsedData.categories && parsedData.categories[type]) {
                        categories[type] = parsedData.categories[type].map(cat => {
                            // –ï—Å–ª–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏—è - —ç—Ç–æ –ø—Ä–æ—Å—Ç–æ —Å—Ç—Ä–æ–∫–∞, –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º –≤ –æ–±—ä–µ–∫—Ç
                            if (typeof cat === 'string') {
                                return { 
                                    id: generateUniqueId(type.slice(0, 3)), 
                                    name: cat, 
                                    icon: type === 'income' ? 'fa-solid fa-money-bill-wave' : 'fa-solid fa-cart-shopping', 
                                    color: type === 'income' ? '#22c55e' : '#ef4444',
                                    budget: type === 'expense' ? 0 : undefined 
                                };
                            }
                            // –ï—Å–ª–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏—è —É–∂–µ –æ–±—ä–µ–∫—Ç, –Ω–æ –±–µ–∑ –∏–∫–æ–Ω–∫–∏/–±—é–¥–∂–µ—Ç–∞/—Ü–≤–µ—Ç–∞, –¥–æ–±–∞–≤–ª—è–µ–º –∏—Ö
                            return { 
                                ...cat, 
                                icon: cat.icon || (type === 'income' ? 'fa-solid fa-money-bill-wave' : 'fa-solid fa-cart-shopping'),
                                color: cat.color || (type === 'income' ? '#22c55e' : '#ef4444'),
                                budget: (type === 'expense' && cat.budget === undefined) ? 0 : cat.budget
                            };
                        });
                    } else if (parsedData.categories) { 
                         categories[type] = [];
                    }
                });

                // –¢–æ–ª—å–∫–æ –µ—Å–ª–∏ –±—ã–ª–∞ –º–∏–≥—Ä–∞—Ü–∏—è —Å—Ç—Ä–æ–∫–æ–≤—ã—Ö –∫–∞—Ç–µ–≥–æ—Ä–∏–π –≤ –æ–±—ä–µ–∫—Ç—ã
                if (parsedData.categories && parsedData.categories.income.length > 0 && typeof parsedData.categories.income[0] === 'string') {
                     showToast('–°—Ç–∞—Ä—ã–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –æ–±–Ω–æ–≤–ª–µ–Ω—ã –¥–æ –Ω–æ–≤–æ–≥–æ —Ñ–æ—Ä–º–∞—Ç–∞ (—Å –∏–∫–æ–Ω–∫–∞–º–∏ –∏ —Ü–≤–µ—Ç–∞–º–∏).', 'info');
                }
                
                // –ú–∏–≥—Ä–∞—Ü–∏—è –¥–ª—è –¥–æ–ª–≥–æ–≤: –µ—Å–ª–∏ –Ω–µ—Ç transactions array –∏–ª–∏ paidAmount, –¥–æ–±–∞–≤–ª—è–µ–º
                debts = debts.map(debt => ({
                    ...debt,
                    paidAmount: debt.paidAmount !== undefined ? debt.paidAmount : (debt.currentAmount !== undefined ? debt.originalAmount - debt.currentAmount : 0), // handle old `currentAmount` if exists
                    transactions: debt.transactions || []
                }));
            }
        };

        // --- –õ–æ–≥–∏–∫–∞ Recurring Transactions ---
        const generateRecurringTransactions = () => {
            const today = new Date();
            today.setHours(0, 0, 0, 0); 
            let generatedCount = 0;

            recurringTransactions.forEach(rt => {
                const startDate = new Date(rt.startDate);
                startDate.setHours(0, 0, 0, 0);
                const endDate = rt.endDate ? new Date(rt.endDate) : null;
                if (endDate) endDate.setHours(0, 0, 0, 0);

                let lastGenerated = rt.lastGeneratedDate ? new Date(rt.lastGeneratedDate) : new Date(startDate);
                lastGenerated.setHours(0, 0, 0, 0);

                let nextGenerationDate = new Date(lastGenerated);

                if (lastGenerated < startDate) {
                    nextGenerationDate = new Date(startDate);
                } else {
                    switch (rt.frequency) {
                        case 'daily': nextGenerationDate.setDate(nextGenerationDate.getDate() + 1); break;
                        case 'weekly': nextGenerationDate.setDate(nextGenerationDate.getDate() + 7); break;
                        case 'monthly': nextGenerationDate.setMonth(nextGenerationDate.getMonth() + 1); break;
                        case 'yearly': nextGenerationDate.setFullYear(nextGenerationDate.getFullYear() + 1); break;
                    }
                }
                
                while (nextGenerationDate <= today) {
                    if (nextGenerationDate >= startDate && (!endDate || nextGenerationDate <= endDate)) {
                        const newTransaction = {
                            id: generateUniqueId('T'),
                            type: rt.type,
                            amount: rt.amount,
                            category: rt.category,
                            account: rt.account,
                            date: nextGenerationDate.toISOString().split('T')[0],
                            time: rt.time || '12:00',
                            description: rt.description + ' (–ø–æ–≤—Ç–æ—Ä—è—é—â–∞—è—Å—è)',
                            savingGoalId: rt.savingGoalId || undefined,
                            debtId: rt.debtId || undefined // –ù–û–í–û–ï: –ø—Ä–∏–≤—è–∑–∫–∞ –¥–æ–ª–≥–∞ –¥–ª—è –ø–æ–≤—Ç–æ—Ä—è—é—â–∏—Ö—Å—è
                        };
                        transactions.push(newTransaction);
                        generatedCount++;
                    }

                    switch (rt.frequency) {
                        case 'daily': nextGenerationDate.setDate(nextGenerationDate.getDate() + 1); break;
                        case 'weekly': nextGenerationDate.setDate(nextGenerationDate.getDate() + 7); break;
                        case 'monthly': nextGenerationDate.setMonth(nextGenerationDate.getMonth() + 1); break;
                        case 'yearly': nextGenerationDate.setFullYear(nextGenerationDate.getFullYear() + 1); break;
                    }

                    if (endDate && nextGenerationDate > endDate) break; 
                }

                if (generatedCount > 0) {
                    let newLastGeneratedDate = new Date(today);
                    newLastGeneratedDate.setHours(0,0,0,0);
                    if (newLastGeneratedDate < startDate) {
                         newLastGeneratedDate = new Date(startDate);
                    }
                    rt.lastGeneratedDate = newLastGeneratedDate.toISOString().split('T')[0];
                }
            });

            if (generatedCount > 0) {
                saveData();
                showToast(`–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–æ ${generatedCount} –ø–æ–≤—Ç–æ—Ä—è—é—â–∏—Ö—Å—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π.`, 'info');
            }
        };

        // --- –§—É–Ω–∫—Ü–∏–∏ —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞ (–æ–±–Ω–æ–≤–ª–µ–Ω–∏—è UI) ---
        const renderAll = () => {
            renderSummary();
            renderAccountsSummary();
            renderBudgetSummary();
            renderSavingGoalsSummary();
            renderDashboardDebtsSummary(); // –ù–û–í–û–ï: –†–µ–Ω–¥–µ—Ä–∏–Ω–≥ —Å–≤–æ–¥–∫–∏ –¥–æ–ª–≥–æ–≤ –Ω–∞ –¥–∞—à–±–æ—Ä–¥–µ
            renderTransactionFilters(); 
            currentPage = 0; 
            renderTransactions(); 
            renderCategories();
            renderAccounts();
            renderRecurringTransactions();
            renderSavingGoalsSettings();
            renderDebtsSettings(); // –ù–û–í–û–ï: –†–µ–Ω–¥–µ—Ä–∏–Ω–≥ –¥–æ–ª–≥–æ–≤ –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö
            renderCharts(); 
            updateNavLinks(window.location.hash || '#dashboard');
            updateSavingGoalOptions();
            updateDebtLinkingOptions(); // –ù–û–í–û–ï: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ–ø—Ü–∏–π –¥–æ–ª–≥–æ–≤ –≤ —Ñ–æ—Ä–º–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
        };

        const renderSummary = () => {
            let totalIncome = 0;
            let totalExpenses = 0;

            transactions.forEach(t => {
                const amount = parseFloat(t.amount);
                if (t.type === 'income') {
                    totalIncome += amount;
                } else {
                    totalExpenses += amount;
                }
            });
            const balance = totalIncome - totalExpenses;

            document.getElementById('total-income').textContent = formatCurrency(totalIncome);
            document.getElementById('total-expenses').textContent = formatCurrency(totalExpenses);
            document.getElementById('total-balance').textContent = formatCurrency(balance);
            
            const balanceCard = document.getElementById('total-balance-card');
            balanceCard.classList.remove('bg-green-100', 'border-green-500', 'text-green-800', 'bg-red-100', 'border-red-500', 'text-red-800', 'bg-violet-100', 'border-violet-500', 'text-violet-800');
            if (balance > 0) {
                balanceCard.classList.add('bg-green-100', 'border-green-500', 'text-green-800');
            } else if (balance < 0) {
                balanceCard.classList.add('bg-red-100', 'border-red-500', 'text-red-800');
            } else {
                balanceCard.classList.add('bg-violet-100', 'border-violet-500', 'text-violet-800');
            }
        };

        const renderAccountsSummary = () => {
            const accountsSummaryDiv = document.getElementById('accounts-summary');
            accountsSummaryDiv.innerHTML = ''; 

            if (accounts.length === 0) {
                accountsSummaryDiv.innerHTML = '<p class="text-gray-500">–î–æ–±–∞–≤—å—Ç–µ —Å—á–µ—Ç–∞ –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö.</p>';
                return;
            }

            accounts.forEach(account => {
                let currentBalance = 0;
                transactions.forEach(t => {
                    if (t.account === account.id) {
                        const amount = parseFloat(t.amount);
                        if (t.type === 'income') {
                            currentBalance += amount;
                        } else {
                            currentBalance -= amount;
                        }
                    }
                });
                
                const card = document.createElement('div');
                card.className = `p-3 rounded-lg shadow-sm border-l-4 ${currentBalance >= 0 ? 'bg-blue-100 border-blue-500 text-blue-800' : 'bg-red-100 border-red-500 text-red-800'}`;
                card.innerHTML = `
                    <h4 class="font-semibold text-sm">${account.name}</h4>
                    <p class="text-xl font-bold">${formatCurrency(currentBalance)}</p>
                `;
                accountsSummaryDiv.appendChild(card);
            });
        };

        // –ò–ó–ú–ï–ù–ï–ù–ù–ê–Ø –§–£–ù–ö–¶–ò–Ø: –†–µ–Ω–¥–µ—Ä–∏–Ω–≥ –±—é–¥–∂–µ—Ç–∞ –≤ –≤–∏–¥–µ –∞–¥–∞–ø—Ç–∏–≤–Ω—ã—Ö –∫–∞—Ä—Ç–æ—á–µ–∫
        const renderBudgetSummary = () => {
            const budgetSummaryList = document.getElementById('budget-summary-list');
            budgetSummaryList.innerHTML = '';

            const expenseCategoriesWithBudget = categories.expense.filter(cat => cat.budget !== undefined && cat.budget > 0);

            if (expenseCategoriesWithBudget.length === 0) {
                // –ï—Å–ª–∏ –Ω–µ—Ç –±—é–¥–∂–µ—Ç–æ–≤, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
                budgetSummaryList.innerHTML = '<p class="text-gray-500">–î–æ–±–∞–≤—å—Ç–µ –±—é–¥–∂–µ—Ç—ã –∫ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º —Ä–∞—Å—Ö–æ–¥–æ–≤ –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö.</p>';
                return;
            }

            const now = new Date();
            const currentMonth = now.getMonth();
            const currentYear = now.getFullYear();

            const monthlyExpensesByCategory = transactions
                .filter(t => {
                    if (t.type !== 'expense') return false;
                    const transactionDate = new Date(t.date);
                    return transactionDate.getMonth() === currentMonth && transactionDate.getFullYear() === currentYear;
                })
                .reduce((acc, t) => {
                    const categoryObj = categories.expense.find(cat => cat.id === t.category);
                    if (categoryObj) {
                        acc[categoryObj.id] = (acc[categoryObj.id] || 0) + parseFloat(t.amount);
                    }
                    return acc;
                }, {});

            expenseCategoriesWithBudget.forEach(cat => {
                const spent = monthlyExpensesByCategory[cat.id] || 0;
                const budget = parseFloat(cat.budget);
                const remaining = budget - spent;
                const percentage = (spent / budget) * 100;

                let progressBarColor = 'bg-green-500';
                let cardBorderColor = 'border-violet-500'; 
                let remainingTextColor = 'text-slate-500';

                if (percentage >= 100) {
                    progressBarColor = 'bg-red-500';
                    cardBorderColor = 'border-red-500';
                    remainingTextColor = 'text-red-500';
                } else if (percentage >= 75) {
                    progressBarColor = 'bg-yellow-500';
                }

                const item = document.createElement('div');
                // –ö–∞—Ä—Ç–æ—á–∫–∞ –≤ —Å–µ—Ç–∫–µ: —É–±—Ä–∞–Ω—ã –∫–ª–∞—Å—Å—ã flex-shrink-0 –∏ min-w-[280px]
                item.className = `bg-white p-4 rounded-xl shadow-md border-t-4 ${cardBorderColor} transition-all duration-300 hover:shadow-lg`;
                item.innerHTML = `
                    <div class="flex items-center gap-2 mb-2">
                        <span class="text-2xl" style="color: ${cat.color}"><i class="${cat.icon}"></i></span>
                        <span class="font-bold text-lg text-slate-800">${cat.name}</span>
                    </div>
                    
                    <p class="text-sm text-slate-600 mb-2">
                        –ü–æ—Ç—Ä–∞—á–µ–Ω–æ: <span class="font-semibold text-violet-600">${formatCurrency(spent)}</span>
                        (–ë—é–¥–∂–µ—Ç: ${formatCurrency(budget)})
                    </p>

                    <div class="budget-progress-bar mb-2">
                        <div class="budget-progress-fill ${progressBarColor}" style="width: ${Math.min(100, percentage)}%;"></div>
                    </div>
                    
                    <div class="flex justify-between items-center text-sm">
                        <span class="text-slate-500">–ü—Ä–æ–≥—Ä–µ—Å—Å: ${percentage.toFixed(1)}%</span>
                        <span class="${remainingTextColor} font-semibold">
                            ${remaining >= 0 ? `–û—Å—Ç–∞–ª–æ—Å—å: ${formatCurrency(remaining)}` : `–ü—Ä–µ–≤—ã—à–µ–Ω–æ: ${formatCurrency(Math.abs(remaining))}`}
                        </span>
                    </div>
                `;
                budgetSummaryList.appendChild(item);
            });
        };

        const renderSavingGoalsSummary = () => {
            const savingGoalsSummaryList = document.getElementById('saving-goals-summary-list');
            savingGoalsSummaryList.innerHTML = '';

            if (savingGoals.length === 0) {
                savingGoalsSummaryList.innerHTML = '<p class="text-gray-500">–î–æ–±–∞–≤—å—Ç–µ —Ü–µ–ª–∏ –Ω–∞–∫–æ–ø–ª–µ–Ω–∏—è –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö.</p>';
                return;
            }

            savingGoals.forEach(goal => {
                const currentContribution = transactions
                    .filter(t => t.type === 'income' && t.savingGoalId === goal.id)
                    .reduce((sum, t) => sum + parseFloat(t.amount), 0);
                
                const targetAmount = parseFloat(goal.targetAmount);
                const percentage = (currentContribution / targetAmount) * 100;
                const remaining = targetAmount - currentContribution;

                let progressBarColor = 'bg-blue-500';
                if (percentage >= 100) {
                    progressBarColor = 'bg-emerald-500';
                } else if (percentage >= 75) {
                    progressBarColor = 'bg-sky-500';
                }

                const item = document.createElement('div');
                item.className = 'bg-white p-4 rounded-lg shadow-sm border-l-4 border-blue-500';
                item.innerHTML = `
                    <h4 class="font-bold text-slate-700 mb-1">üéØ ${goal.name}</h4>
                    <p class="text-sm text-slate-500">–í–Ω–µ—Å–µ–Ω–æ: ${formatCurrency(currentContribution)} –∏–∑ ${formatCurrency(targetAmount)}</p>
                    <div class="saving-goal-progress-bar mt-2">
                        <div class="saving-goal-progress-fill ${progressBarColor}" style="width: ${Math.min(100, percentage)}%;"></div>
                    </div>
                    <p class="text-xs text-right mt-1 ${percentage >= 100 ? 'text-emerald-600' : 'text-slate-500'}">
                        ${percentage >= 100 ? `–¶–µ–ª—å –¥–æ—Å—Ç–∏–≥–Ω—É—Ç–∞!` : `–û—Å—Ç–∞–ª–æ—Å—å: ${formatCurrency(remaining)}`}
                    </p>
                `;
                savingGoalsSummaryList.appendChild(item);
            });
        };

        // –ù–û–í–û–ï: –†–µ–Ω–¥–µ—Ä–∏–Ω–≥ —Å–≤–æ–¥–∫–∏ –¥–æ–ª–≥–æ–≤ –Ω–∞ –¥–∞—à–±–æ—Ä–¥–µ
        const renderDashboardDebtsSummary = () => {
            const dashboardDebtsList = document.getElementById('dashboard-debts-list');
            dashboardDebtsList.innerHTML = '';

            if (debts.length === 0) {
                dashboardDebtsList.innerHTML = '<p class="text-gray-500">–î–æ–±–∞–≤—å—Ç–µ –¥–æ–ª–≥–∏ –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö.</p>';
                return;
            }

            const today = new Date();
            today.setHours(0,0,0,0);

            debts.forEach(debt => {
                const remaining = debt.originalAmount - debt.paidAmount;
                if (remaining <= 0) return; // –ù–µ –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –ø–æ–ª–Ω–æ—Å—Ç—å—é –ø–æ–≥–∞—à–µ–Ω–Ω—ã–µ –¥–æ–ª–≥–∏

                const percentage = (debt.paidAmount / debt.originalAmount) * 100;
                const isOverdue = new Date(debt.dueDate) < today;

                let progressBarColor = 'bg-blue-500';
                let cardBorderColor = 'border-blue-500';
                let textColor = 'text-slate-500';
                if (isOverdue) {
                    cardBorderColor = 'border-red-500';
                    textColor = 'text-red-600';
                    progressBarColor = 'bg-red-500';
                } else if (percentage >= 75) {
                    progressBarColor = 'bg-sky-500';
                } else if (percentage >= 100) { // Should not happen with remaining <= 0 filter, but just in case
                     progressBarColor = 'bg-emerald-500';
                }

                const icon = debt.type === 'iOwe' ? 'üí∏' : 'üí∞';
                const typeText = debt.type === 'iOwe' ? '–Ø –¥–æ–ª–∂–µ–Ω' : '–ú–Ω–µ –¥–æ–ª–∂–Ω—ã';
                const personPrefix = debt.type === 'iOwe' ? '–ö–æ–º—É:' : '–û—Ç –∫–æ–≥–æ:';

                const item = document.createElement('div');
                item.className = `bg-white p-4 rounded-lg shadow-sm border-l-4 ${cardBorderColor}`;
                item.innerHTML = `
                    <h4 class="font-bold text-slate-700 mb-1">${icon} ${typeText} ${debt.description ? `(${debt.description})` : ''}</h4>
                    <p class="text-sm text-slate-600">${personPrefix} <span class="font-semibold">${debt.person}</span></p>
                    <p class="text-sm text-slate-500">–û—Å—Ç–∞–ª–æ—Å—å: ${formatCurrency(remaining)} –∏–∑ ${formatCurrency(debt.originalAmount)}</p>
                    <div class="debt-progress-bar mt-2">
                        <div class="debt-progress-fill ${progressBarColor}" style="width: ${Math.min(100, percentage)}%;"></div>
                    </div>
                    <p class="text-xs text-right mt-1 ${textColor}">
                        ${isOverdue ? `–ü—Ä–æ—Å—Ä–æ—á–µ–Ω–æ! (${formatDate(debt.dueDate)})` : `–î–æ: ${formatDate(debt.dueDate)}`}
                    </p>
                `;
                dashboardDebtsList.appendChild(item);
            });
        };


        const renderTransactions = () => {
            const listContainer = document.getElementById('transaction-list');
            listContainer.innerHTML = '';
            
            let filteredTransactions = [...transactions];

            // –ü—Ä–∏–º–µ–Ω—è–µ–º —Ñ–∏–ª—å—Ç—Ä—ã
            if (currentFilters.type !== 'all') {
                filteredTransactions = filteredTransactions.filter(t => t.type === currentFilters.type);
            }
            if (currentFilters.category !== 'all') {
                const filterCategoryObj = [...categories.income, ...categories.expense].find(cat => cat.id === currentFilters.category);
                if (filterCategoryObj) {
                    filteredTransactions = filteredTransactions.filter(t => t.category === currentFilters.category);
                } else if (currentFilters.category !== 'all') { 
                    filteredTransactions = []; 
                }
            }
            if (currentFilters.account !== 'all') {
                filteredTransactions = filteredTransactions.filter(t => t.account === currentFilters.account);
            }
            if (currentFilters.description) {
                const searchTerm = currentFilters.description.toLowerCase();
                filteredTransactions = filteredTransactions.filter(t => t.description && t.description.toLowerCase().includes(searchTerm));
            }
            if (currentFilters.amountMin !== null && !isNaN(currentFilters.amountMin)) {
                filteredTransactions = filteredTransactions.filter(t => parseFloat(t.amount) >= currentFilters.amountMin);
            }
            if (currentFilters.amountMax !== null && !isNaN(currentFilters.amountMax)) {
                filteredTransactions = filteredTransactions.filter(t => parseFloat(t.amount) <= currentFilters.amountMax);
            }
            if (currentFilters.dateStart) {
                filteredTransactions = filteredTransactions.filter(t => t.date >= currentFilters.dateStart);
            }
            if (currentFilters.dateEnd) {
                filteredTransactions = filteredTransactions.filter(t => t.date <= currentFilters.dateEnd);
            }

            // –ü—Ä–∏–º–µ–Ω—è–µ–º —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫—É
            filteredTransactions.sort((a, b) => {
                switch (currentFilters.sortOrder) {
                    case 'date-desc': return new Date(b.date + 'T' + (b.time || '00:00')) - new Date(a.date + 'T' + (a.time || '00:00'));
                    case 'date-asc': return new Date(a.date + 'T' + (a.time || '00:00')) - new Date(b.date + 'T' + (b.time || '00:00'));
                    case 'amount-desc': return parseFloat(b.amount) - parseFloat(a.amount);
                    case 'amount-asc': return parseFloat(a.amount) - parseFloat(b.amount);
                    default: return 0;
                }
            });

            // --- –õ–æ–≥–∏–∫–∞ –ø–∞–≥–∏–Ω–∞—Ü–∏–∏ ---
            const totalTransactions = filteredTransactions.length;
            const totalPages = Math.ceil(totalTransactions / transactionsPerPage);

            if (currentPage >= totalPages && totalPages > 0) { currentPage = totalPages - 1; }
            else if (totalPages === 0) { currentPage = 0; }

            const startIndex = currentPage * transactionsPerPage;
            const endIndex = Math.min(startIndex + transactionsPerPage, totalTransactions);

            const transactionsToDisplay = filteredTransactions.slice(startIndex, endIndex);

            const prevBtn = document.getElementById('prev-page-btn');
            const nextBtn = document.getElementById('next-page-btn');
            const pageInfoSpan = document.getElementById('page-info');
            const paginationControls = document.getElementById('pagination-controls');

            prevBtn.disabled = currentPage === 0 || totalPages <= 1;
            nextBtn.disabled = currentPage >= totalPages - 1 || totalPages <= 1;
            pageInfoSpan.textContent = totalPages > 0 ? `${currentPage + 1}/${totalPages}` : '';
            
            if (totalPages <= 1) { paginationControls.classList.add('hidden'); }
            else { paginationControls.classList.remove('hidden'); }
            // --- –ö–æ–Ω–µ—Ü –ª–æ–≥–∏–∫–∏ –ø–∞–≥–∏–Ω–∞—Ü–∏–∏ ---

            if (transactionsToDisplay.length === 0) {
                listContainer.innerHTML = `<p class="p-8 text-center bg-white rounded-lg text-gray-500">–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –ø–æ –≤–∞—à–∏–º –∫—Ä–∏—Ç–µ—Ä–∏—è–º –Ω–µ –Ω–∞–π–¥–µ–Ω–æ.</p>`;
                return;
            }

            transactionsToDisplay.forEach(t => {
                const isIncome = t.type === 'income';
                const categoryObj = getCategoryById(t.category, t.type);
                const accountObj = getAccountById(t.account);
                const debtObj = getDebtById(t.debtId); // –ù–û–í–û–ï: –ø–æ–ª—É—á–∞–µ–º –æ–±—ä–µ–∫—Ç –¥–æ–ª–≥–∞
                
                const debtInfo = debtObj ? `<span class="text-xs ml-2 py-0.5 px-2 bg-blue-100 text-blue-800 rounded-full">ü§ù ${debtObj.person}</span>` : '';

                const item = document.createElement('div');
                item.className = `bg-white rounded-lg shadow p-4 flex items-center justify-between gap-4 border-l-4 ${isIncome ? 'border-l-green-500' : 'border-l-red-500'} transition-transform hover:scale-[1.02] duration-300`;
                item.innerHTML = `
                    <div class="flex-1 cursor-pointer" onclick="viewTransaction('${t.id}')">
                        <div class="flex items-center gap-3">
                            <div class="text-2xl" style="color: ${categoryObj ? categoryObj.color : '#6b7280'};"><i class="${categoryObj ? categoryObj.icon : 'fa-solid fa-tag'}"></i></div>
                            <div>
                                <p class="font-bold">${categoryObj ? categoryObj.name : '–ë–µ–∑ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏'}${debtInfo}</p>
                                <p class="text-sm text-slate-500">${formatDate(t.date)} ${t.time || ''} (${accountObj ? accountObj.name : '–ë–µ–∑ —Å—á–µ—Ç–∞'})</p>
                            </div>
                        </div>
                    </div>
                    <div class="flex items-center gap-4 text-right">
                        <p class="font-bold text-lg ${isIncome ? 'text-green-600' : 'text-red-600'}">${isIncome ? '+' : '-'} ${formatCurrency(t.amount)}</p>
                        <div class="flex gap-2">
                             <button onclick="editTransaction('${t.id}')" class="text-blue-500 hover:text-blue-700 p-1 rounded-full text-lg">‚úèÔ∏è</button>
                             <button onclick="deleteTransaction('${t.id}')" class="text-red-500 hover:text-red-700 p-1 rounded-full text-lg">üóëÔ∏è</button>
                        </div>
                    </div>
                `;
                listContainer.appendChild(item);
            });
        };

        const renderCategories = () => {
            const createCategoryEditor = (category, type) => {
                const chip = document.createElement('div');
                chip.className = 'category-item'; // –ü—Ä–∏–º–µ–Ω—è–µ–º –Ω–æ–≤—ã–π –∫–ª–∞—Å—Å –¥–ª—è —Å—Ç–∏–ª–µ–π
                chip.innerHTML = `
                    <div class="icon-color-display">
                        <span class="icon-preview text-lg" style="color: ${category.color};"><i class="${category.icon || 'fa-solid fa-tag'}"></i></span>
                        <span>${category.name}</span>
                    </div>
                    <div class="category-controls">
                        ${type === 'expense' ? `
                            <input type="number" 
                                   data-category-id="${category.id}" 
                                   value="${category.budget || 0}" 
                                   min="0" 
                                   placeholder="–ë—é–¥–∂–µ—Ç" 
                                   class="budget-input text-center p-0.5 border border-slate-300 rounded-md bg-white text-slate-800 text-xs" 
                                   onchange="updateCategoryBudget('${category.id}', this.value)">` : ''}
                        <button onclick="editCategory('${type}', '${category.id}')" class="text-blue-500 hover:text-blue-700 transition-colors">‚úèÔ∏è</button>
                        <button onclick="deleteCategory('${type}', '${category.id}')" class="ml-2 text-red-500 hover:text-red-700 transition-colors">&times;</button>
                    </div>
                `;
                return chip;
            };
            const incomeList = document.getElementById('income-categories-list');
            const expenseList = document.getElementById('expense-categories-list');
            incomeList.innerHTML = ''; expenseList.innerHTML = '';
            categories.income.forEach(cat => incomeList.appendChild(createCategoryEditor(cat, 'income')));
            categories.expense.forEach(cat => expenseList.appendChild(createCategoryEditor(cat, 'expense')));
        };

        const renderAccounts = () => {
            const accountsList = document.getElementById('accounts-list');
            accountsList.innerHTML = '';
            if (accounts.length === 0) {
                accountsList.innerHTML = '<p class="text-gray-500 text-sm">–ù–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω–Ω—ã—Ö —Å—á–µ—Ç–æ–≤.</p>';
                return;
            }
            accounts.forEach(account => {
                const accountItem = document.createElement('div');
                accountItem.className = 'flex justify-between items-center text-sm bg-slate-200 px-2 py-1 rounded-full';
                accountItem.innerHTML = `
                    <span>${account.name}</span>
                    <button onclick="deleteAccount('${account.id}')" class="ml-2 text-red-500 hover:text-red-700 transition-colors">&times;</button>
                `;
                accountsList.appendChild(accountItem);
            });
        };

        const renderRecurringTransactions = () => {
            const recurringList = document.getElementById('recurring-transactions-list');
            recurringList.innerHTML = '';

            if (recurringTransactions.length === 0) {
                recurringList.innerHTML = '<p class="text-gray-500">–ü–æ–≤—Ç–æ—Ä—è—é—â–∏–µ—Å—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –±—É–¥—É—Ç –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è –∑–¥–µ—Å—å –ø–æ—Å–ª–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è.</p>';
                return;
            }

            recurringTransactions.forEach(rt => {
                const categoryObj = getCategoryById(rt.category, rt.type);
                const accountObj = getAccountById(rt.account);
                const savingGoalObj = rt.savingGoalId ? getSavingGoalById(rt.savingGoalId) : null;
                const debtObj = rt.debtId ? getDebtById(rt.debtId) : null; // –ù–û–í–û–ï:
                const item = document.createElement('div');
                item.className = `bg-white rounded-lg shadow p-4 flex items-center justify-between gap-4 border-l-4 ${rt.type === 'income' ? 'border-l-green-500' : 'border-l-red-500'}`;
                item.innerHTML = `
                    <div class="flex-1">
                        <p class="font-bold">${rt.description || '–ë–µ–∑ –æ–ø–∏—Å–∞–Ω–∏—è'}</p>
                        <p class="text-sm text-slate-500">
                            ${rt.type === 'income' ? '–î–æ—Ö–æ–¥' : '–†–∞—Å—Ö–æ–¥'} –≤ ${formatCurrency(rt.amount)} –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ "<i class="${categoryObj ? categoryObj.icon : 'fa-solid fa-tag'} mr-1" style="color: ${categoryObj ? categoryObj.color : '#6b7280'}"></i>${categoryObj ? categoryObj.name : 'N/A'}" –Ω–∞ —Å—á–µ—Ç "${accountObj ? accountObj.name : 'N/A'}"
                            ${savingGoalObj ? ` (–∫ —Ü–µ–ª–∏: ${savingGoalObj.name})` : ''}
                            ${debtObj ? ` (–∫ –¥–æ–ª–≥—É: ${debtObj.person} - ${debtObj.description || '–±–µ–∑ –æ–ø–∏—Å–∞–Ω–∏—è'})` : ''}
                        </p>
                        <p class="text-xs text-slate-500 mt-1">
                            –ß–∞—Å—Ç–æ—Ç–∞: ${rt.frequency === 'daily' ? '–ï–∂–µ–¥–Ω–µ–≤–Ω–æ' : rt.frequency === 'weekly' ? '–ï–∂–µ–Ω–µ–¥–µ–ª—å–Ω–æ' : rt.frequency === 'monthly' ? '–ï–∂–µ–º–µ—Å—è—á–Ω–æ' : '–ï–∂–µ–≥–æ–¥–Ω–æ'}
                            —Å ${formatDate(rt.startDate)} ${rt.endDate ? `–ø–æ ${formatDate(rt.endDate)}` : ''}
                        </p>
                    </div>
                    <div class="flex gap-2">
                        <button onclick="editRecurringTransaction('${rt.id}')" class="text-blue-500 hover:text-blue-700 p-1 rounded-full text-lg">‚úèÔ∏è</button>
                        <button onclick="deleteRecurringTransaction('${rt.id}')" class="text-red-500 hover:text-red-700 p-1 rounded-full text-lg">üóëÔ∏è</button>
                    </div>
                `;
                recurringList.appendChild(item);
            });
        };

        const renderSavingGoalsSettings = () => {
            const savingGoalsListDiv = document.getElementById('saving-goals-list');
            savingGoalsListDiv.innerHTML = '';

            if (savingGoals.length === 0) {
                savingGoalsListDiv.innerHTML = '<p class="text-gray-500">–¶–µ–ª–∏ –Ω–∞–∫–æ–ø–ª–µ–Ω–∏—è –±—É–¥—É—Ç –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è –∑–¥–µ—Å—å.</p>';
                return;
            }

            savingGoals.forEach(goal => {
                const item = document.createElement('div');
                item.className = 'flex justify-between items-center text-sm bg-slate-200 px-2 py-1 rounded-full';
                item.innerHTML = `
                    <span>üéØ ${goal.name} (${formatCurrency(goal.targetAmount)})</span>
                    <div class="flex gap-2">
                        <button onclick="editSavingGoal('${goal.id}')" class="text-blue-500 hover:text-blue-700 transition-colors">‚úèÔ∏è</button>
                        <button onclick="deleteSavingGoal('${goal.id}')" class="ml-2 text-red-500 hover:text-red-700 transition-colors">&times;</button>
                    </div>
                `;
                savingGoalsListDiv.appendChild(item);
            });
        };

        // –ù–û–í–û–ï: –†–µ–Ω–¥–µ—Ä–∏–Ω–≥ –¥–æ–ª–≥–æ–≤ –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö (—É–ø—Ä–æ—â–µ–Ω–Ω–æ–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ)
        const renderDebtsSettings = () => {
            const debtsListDiv = document.getElementById('debts-list');
            debtsListDiv.innerHTML = '';

            if (debts.length === 0) {
                debtsListDiv.innerHTML = '<p class="text-gray-500">–î–æ–ª–≥–∏ –±—É–¥—É—Ç –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è –∑–¥–µ—Å—å.</p>';
                return;
            }

            debts.forEach(debt => {
                const item = document.createElement('div');
                item.className = 'debt-item bg-slate-200 px-3 py-2 rounded-full'; // –ò—Å–ø–æ–ª—å–∑—É–µ–º –∫–ª–∞—Å—Å debt-item
                
                const typeText = debt.type === 'iOwe' ? '–Ø –¥–æ–ª–∂–µ–Ω' : '–ú–Ω–µ –¥–æ–ª–∂–Ω—ã';
                const descriptionText = debt.description ? ` (${debt.description})` : '';

                item.innerHTML = `
                    <div class="flex-1">
                        <p class="font-semibold text-slate-800">
                            ${typeText} <span class="font-bold">${debt.person}</span>${descriptionText}
                        </p>
                    </div>
                    <div class="debt-controls">
                        <button onclick="editDebt('${debt.id}')" class="text-blue-500 hover:text-blue-700 transition-colors">‚úèÔ∏è</button>
                        <button onclick="deleteDebt('${debt.id}')" class="ml-2 text-red-500 hover:text-red-700 transition-colors">&times;</button>
                    </div>
                `;
                debtsListDiv.appendChild(item);
            });
        };

        // --- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–∏–∞–≥—Ä–∞–º–º–∞–º–∏ ---
        const destroyChart = (chartId) => {
            if (chartInstances[chartId]) {
                chartInstances[chartId].destroy();
                chartInstances[chartId] = null;
            }
        };

        const renderCharts = () => {
            Object.keys(chartInstances).forEach(destroyChart);
            document.querySelectorAll('.chart-canvas').forEach(canvas => canvas.classList.add('hidden'));

            const categorySubToggle = document.getElementById('category-sub-toggle');
            const chartSectionTitle = document.getElementById('chart-section-title');

            switch (currentChartType) {
                case 'pie':
                    document.getElementById('categoryPieChartCanvas').classList.remove('hidden');
                    renderCategoryPieChart(currentCategoryChartDataType);
                    categorySubToggle.classList.remove('hidden');
                    chartSectionTitle.textContent = `–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ ${currentCategoryChartDataType === 'expense' ? '—Ä–∞—Å—Ö–æ–¥–æ–≤' : '–¥–æ—Ö–æ–¥–æ–≤'} –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º`;
                    break;
                case 'monthlyBar':
                    document.getElementById('monthlyBarChartCanvas').classList.remove('hidden');
                    renderMonthlyBarChart();
                    categorySubToggle.classList.add('hidden');
                    chartSectionTitle.textContent = '–ï–∂–µ–º–µ—Å—è—á–Ω—ã–µ –¥–æ—Ö–æ–¥—ã –∏ —Ä–∞—Å—Ö–æ–¥—ã';
                    break;
                case 'balanceLine':
                    document.getElementById('balanceLineChartCanvas').classList.remove('hidden');
                    renderBalanceLineChart();
                    categorySubToggle.classList.add('hidden');
                    chartSectionTitle.textContent = '–î–∏–Ω–∞–º–∏–∫–∞ –æ–±—â–µ–≥–æ –±–∞–ª–∞–Ω—Å–∞';
                    break;
                case 'cumulativeArea':
                    document.getElementById('cumulativeAreaChartCanvas').classList.remove('hidden');
                    renderCumulativeAreaChart();
                    categorySubToggle.classList.add('hidden');
                    chartSectionTitle.textContent = '–ö—É–º—É–ª—è—Ç–∏–≤–Ω—ã–µ —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã–µ –ø–æ—Ç–æ–∫–∏';
                    break;
            }
            updateChartTypeButtons();
        };

        const updateChartTypeButtons = () => {
            document.querySelectorAll('.chart-toggle-type-btn').forEach(btn => btn.classList.remove('active'));
            const activeChartBtn = document.getElementById(`show-${currentChartType}-chart-btn`);
            if (activeChartBtn) activeChartBtn.classList.add('active');

            document.querySelectorAll('#category-sub-toggle .chart-toggle-btn').forEach(btn => btn.classList.remove('active'));
            const activeCategoryBtn = document.getElementById(`show-category-${currentCategoryChartDataType}-btn`);
            if (activeCategoryBtn) activeCategoryBtn.classList.add('active');
        };

        const renderCategoryPieChart = (type) => {
            destroyChart('categoryPie');

            const dataMap = transactions.filter(t => t.type === type).reduce((acc, t) => {
                acc[t.category] = (acc[t.category] || 0) + parseFloat(t.amount);
                return acc;
            }, {});

            const ctx = document.getElementById('categoryPieChartCanvas').getContext('2d');
            
            const categoryNames = Object.keys(dataMap).map(catId => {
                const categoryObj = getCategoryById(catId, type);
                return categoryObj ? categoryObj.name : '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è';
            });
            const values = Object.values(dataMap);
            // –ò—Å–ø–æ–ª—å–∑—É–µ–º —Ü–≤–µ—Ç–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–π, –µ—Å–ª–∏ –æ–Ω–∏ –µ—Å—Ç—å, –∏–Ω–∞—á–µ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ–º –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏
            const backgroundColors = Object.keys(dataMap).map(catId => {
                const categoryObj = getCategoryById(catId, type);
                return categoryObj && categoryObj.color ? categoryObj.color : generateDynamicColors(1)[0];
            });
            // –ï—Å–ª–∏ –∫–∞–∫–∏–µ-—Ç–æ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –Ω–µ –∏–º–µ—é—Ç —Ü–≤–µ—Ç–∞, –∑–∞–ø–æ–ª–Ω—è–µ–º –æ—Å—Ç–∞–≤—à–∏–µ—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–º–∏
            if (backgroundColors.length < values.length) {
                const dynamicColors = generateDynamicColors(values.length - backgroundColors.length);
                backgroundColors.push(...dynamicColors);
            }


            chartInstances.categoryPie = new Chart(ctx, {
                type: 'pie',
                data: {
                    labels: categoryNames,
                    datasets: [{
                        data: values,
                        backgroundColor: backgroundColors, 
                        borderColor: '#ffffff',
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { position: 'top', labels: { color: CHART_COLORS.gray } },
                        tooltip: { 
                            callbacks: { 
                                label: c => `${c.label || ''}: ${formatCurrency(c.parsed)} (${(c.parsed / values.reduce((a,b)=>a+b,0) * 100).toFixed(1)}%)`
                            },
                            titleColor: CHART_COLORS.gray,
                            bodyColor: CHART_COLORS.gray,
                            backgroundColor: 'rgba(255, 255, 255, 0.9)',
                            borderColor: '#d1d5db',
                            borderWidth: 1
                        }
                    }
                }
            });
        };

        const renderMonthlyBarChart = () => {
            destroyChart('monthlyBar');

            const monthlyData = transactions.reduce((acc, t) => {
                const date = new Date(t.date);
                const yearMonth = `${date.getFullYear()}-${(date.getMonth() + 1).toString().padStart(2, '0')}`;
                
                if (!acc[yearMonth]) {
                    acc[yearMonth] = { income: 0, expense: 0 };
                }
                const amount = parseFloat(t.amount);
                if (t.type === 'income') {
                    acc[yearMonth].income += amount;
                } else {
                    acc[yearMonth].expense += amount;
                }
                return acc;
            }, {});

            const sortedMonths = Object.keys(monthlyData).sort();
            const labels = sortedMonths.map(ym => {
                const [year, month] = ym.split('-');
                return new Date(year, parseInt(month) - 1).toLocaleString('ru-RU', { month: 'short', year: '2-digit' });
            });
            const incomeData = sortedMonths.map(ym => monthlyData[ym].income);
            const expenseData = sortedMonths.map(ym => monthlyData[ym].expense);

            const ctx = document.getElementById('monthlyBarChartCanvas').getContext('2d');
            chartInstances.monthlyBar = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [
                        {
                            label: '–î–æ—Ö–æ–¥—ã',
                            data: incomeData,
                            backgroundColor: CHART_COLORS.green,
                            borderColor: CHART_COLORS.green,
                            borderWidth: 1
                        },
                        {
                            label: '–†–∞—Å—Ö–æ–¥—ã',
                            data: expenseData,
                            backgroundColor: CHART_COLORS.red,
                            borderColor: CHART_COLORS.red,
                            borderWidth: 1
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { position: 'top', labels: { color: CHART_COLORS.gray } },
                        tooltip: { 
                            callbacks: { label: c => `${c.dataset.label}: ${formatCurrency(c.parsed.y)}` },
                            titleColor: CHART_COLORS.gray,
                            bodyColor: CHART_COLORS.gray,
                            backgroundColor: 'rgba(255, 255, 255, 0.9)',
                            borderColor: '#d1d5db',
                            borderWidth: 1
                        }
                    },
                    scales: {
                        x: { stacked: false, ticks: { color: CHART_COLORS.gray } },
                        y: { stacked: false, beginAtZero: true, ticks: { color: CHART_COLORS.gray, callback: (value) => formatCurrency(value) } }
                    }
                }
            });
        };

        const renderBalanceLineChart = () => {
            destroyChart('balanceLine');

            const sortedTransactions = [...transactions].sort((a, b) => {
                const dateA = new Date(a.date + 'T' + (a.time || '00:00'));
                const dateB = new Date(b.date + 'T' + (b.time || '00:00'));
                return dateA - dateB;
            });

            if (sortedTransactions.length === 0) {
                const ctx = document.getElementById('balanceLineChartCanvas').getContext('2d');
                ctx.clearRect(0, 0, ctx.canvas.width, ctx.canvas.height); 
                return;
            }

            const labels = [];
            const balanceData = [];
            let currentBalance = 0;
            let lastDate = null;

            sortedTransactions.forEach(t => {
                const transactionDate = new Date(t.date + 'T' + (t.time || '00:00'));
                if (lastDate && transactionDate.toDateString() !== lastDate.toDateString()) {
                    labels.push(formatDate(lastDate));
                    balanceData.push(currentBalance);
                }
                
                if (t.type === 'income') {
                    currentBalance += parseFloat(t.amount);
                } else {
                    currentBalance -= parseFloat(t.amount);
                }
                lastDate = transactionDate;
            });
            if (lastDate) {
                labels.push(formatDate(lastDate));
                balanceData.push(currentBalance);
            }

            const ctx = document.getElementById('balanceLineChartCanvas').getContext('2d');
            chartInstances.balanceLine = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: '–û–±—â–∏–π –±–∞–ª–∞–Ω—Å',
                        data: balanceData,
                        fill: false,
                        borderColor: CHART_COLORS.balance,
                        tension: 0.1,
                        pointBackgroundColor: CHART_COLORS.balance,
                        pointBorderColor: '#ffffff',
                        pointRadius: 3,
                        pointHoverRadius: 5
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { position: 'top', labels: { color: CHART_COLORS.gray } },
                        tooltip: { 
                            callbacks: { label: c => `${c.dataset.label}: ${formatCurrency(c.parsed.y)}` },
                            titleColor: CHART_COLORS.gray,
                            bodyColor: CHART_COLORS.gray,
                            backgroundColor: 'rgba(255, 255, 255, 0.9)',
                            borderColor: '#d1d5db',
                            borderWidth: 1
                        }
                    },
                    scales: {
                        x: { ticks: { color: CHART_COLORS.gray } },
                        y: { beginAtZero: false, ticks: { color: CHART_COLORS.gray, callback: (value) => formatCurrency(value) } }
                    }
                }
            });
        };

        const renderCumulativeAreaChart = () => {
            destroyChart('cumulativeArea');

            const sortedTransactions = [...transactions].sort((a, b) => {
                const dateA = new Date(a.date + 'T' + (a.time || '00:00'));
                const dateB = new Date(b.date + 'T' + (b.time || '00:00'));
                return dateA - dateB;
            });

            if (sortedTransactions.length === 0) {
                const ctx = document.getElementById('cumulativeAreaChartCanvas').getContext('2d');
                ctx.clearRect(0, 0, ctx.canvas.width, ctx.canvas.height);
                return;
            }

            const labels = [];
            const cumulativeIncome = [];
            const cumulativeExpense = [];
            let currentIncome = 0;
            let currentExpense = 0;
            let lastDate = null;

            sortedTransactions.forEach(t => {
                const transactionDate = new Date(t.date + 'T' + (t.time || '00:00'));

                if (lastDate && transactionDate.toDateString() !== lastDate.toDateString()) {
                    labels.push(formatDate(lastDate));
                    cumulativeIncome.push(currentIncome);
                    cumulativeExpense.push(currentExpense);
                }

                if (t.type === 'income') {
                    currentIncome += parseFloat(t.amount);
                } else {
                    currentExpense += parseFloat(t.amount);
                }
                lastDate = transactionDate;
            });
            if (lastDate) {
                labels.push(formatDate(lastDate));
                cumulativeIncome.push(currentIncome);
                cumulativeExpense.push(currentExpense);
            }

            const ctx = document.getElementById('cumulativeAreaChartCanvas').getContext('2d');
            chartInstances.cumulativeArea = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [
                        {
                            label: '–ö—É–º—É–ª—è—Ç–∏–≤–Ω—ã–µ –¥–æ—Ö–æ–¥—ã',
                            data: cumulativeIncome,
                            backgroundColor: 'rgba(34, 197, 94, 0.5)',
                            borderColor: CHART_COLORS.green,
                            fill: true,
                            tension: 0.2,
                            stack: 'CombinedStack'
                        },
                        {
                            label: '–ö—É–º—É–ª—è—Ç–∏–≤–Ω—ã–µ —Ä–∞—Å—Ö–æ–¥—ã',
                            data: cumulativeExpense,
                            backgroundColor: 'rgba(239, 68, 68, 0.5)',
                            borderColor: CHART_COLORS.red,
                            fill: true,
                            tension: 0.2,
                            stack: 'CombinedStack'
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { position: 'top', labels: { color: CHART_COLORS.gray } },
                        tooltip: { 
                            callbacks: { label: c => `${c.dataset.label}: ${formatCurrency(c.parsed.y)}` },
                            titleColor: CHART_COLORS.gray,
                            bodyColor: CHART_COLORS.gray,
                            backgroundColor: 'rgba(255, 255, 255, 0.9)',
                            borderColor: '#d1d5db',
                            borderWidth: 1
                        }
                    },
                    scales: {
                        x: { ticks: { color: CHART_COLORS.gray } },
                        y: { beginAtZero: true, stacked: true, ticks: { color: CHART_COLORS.gray, callback: (value) => formatCurrency(value) } }
                    }
                }
            });
        };


        // --- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –º–æ–¥–∞–ª—å–Ω—ã–º–∏ –æ–∫–Ω–∞–º–∏ –∏ –º–æ–±–∏–ª—å–Ω—ã–º –º–µ–Ω—é ---
        const toggleMobileMenu = (open) => {
            if (open) {
                mobileMenu.classList.remove('-translate-x-full');
                mobileMenu.classList.add('translate-x-0');
                mobileMenuOverlay.classList.remove('hidden');
                setTimeout(() => mobileMenuOverlay.classList.add('opacity-100'), 10);
            } else {
                mobileMenu.classList.remove('translate-x-0');
                mobileMenu.classList.add('-translate-x-full');
                mobileMenuOverlay.classList.remove('opacity-100');
                setTimeout(() => mobileMenuOverlay.classList.add('hidden'), 300); 
            }
            updateBodyScrollAndBlur();
        };

        const openFormModal = (transaction = null, isRecurring = false, recurringItem = null) => {
            transactionForm.reset();
            document.getElementById('transaction-id').value = '';
            document.getElementById('is-recurring-edit').value = isRecurring;

            const isRecurringCheckbox = document.getElementById('is-recurring');
            const recurringOptionsDiv = document.getElementById('recurring-options');
            const dateField = document.getElementById('date').closest('div');
            const timeField = document.getElementById('time').closest('div');
            const savingGoalField = document.getElementById('saving-goal-field');
            const savingGoalSelect = document.getElementById('saving-goal');
            const debtLinkingField = document.getElementById('debt-linking-field'); 
            const linkDebtSelect = document.getElementById('link-debt'); 


            if (isRecurring || recurringItem) {
                isRecurringCheckbox.checked = true;
                recurringOptionsDiv.classList.remove('hidden');
                dateField.classList.add('hidden');
                timeField.classList.add('hidden');
            } else {
                isRecurringCheckbox.checked = false;
                recurringOptionsDiv.classList.add('hidden');
                dateField.classList.remove('hidden');
                timeField.classList.remove('hidden');
            }

            const today = new Date();
            document.getElementById('date').valueAsDate = today;
            document.getElementById('time').value = today.toTimeString().slice(0, 5);
            document.getElementById('recurring-start-date').valueAsDate = today;
            
            const currentType = transaction?.type || recurringItem?.type || document.querySelector('input[name="type"]:checked')?.value || 'income';
            document.querySelector(`input[name="type"][value="${currentType}"]`).checked = true;
            updateCategoryOptions(currentType); 
            updateAccountOptions();
            updateSavingGoalOptions();
            updateDebtLinkingOptions(currentType); 

            if (transaction) {
                document.getElementById('modal-title').textContent = '–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é';
                document.getElementById('transaction-id').value = transaction.id;
                document.getElementById('amount').value = transaction.amount;
                document.getElementById('date').value = transaction.date;
                document.getElementById('time').value = transaction.time || '00:00';
                document.getElementById('description').value = transaction.description;
                document.getElementById('category').value = transaction.category;
                document.getElementById('account').value = transaction.account;
                savingGoalSelect.value = transaction.savingGoalId || '';
                linkDebtSelect.value = transaction.debtId || ''; 
            } else if (recurringItem) {
                document.getElementById('modal-title').textContent = '–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ–≤—Ç–æ—Ä—è—é—â—É—é—Å—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é';
                document.getElementById('transaction-id').value = recurringItem.id;
                document.getElementById('amount').value = recurringItem.amount;
                document.getElementById('description').value = recurringItem.description;
                document.getElementById('category').value = recurringItem.category;
                document.getElementById('account').value = recurringItem.account;
                
                document.getElementById('frequency').value = recurringItem.frequency;
                document.getElementById('recurring-start-date').value = recurringItem.startDate;
                document.getElementById('recurring-end-date').value = recurringItem.endDate || '';
                savingGoalSelect.value = recurringItem.savingGoalId || '';
                linkDebtSelect.value = recurringItem.debtId || ''; 
            } else {
                document.getElementById('modal-title').textContent = '–ù–æ–≤–∞—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è';
            }

            // –õ–æ–≥–∏–∫–∞ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –ø–æ–ª—è "–ü—Ä–∏–≤—è–∑–∞—Ç—å –∫ —Ü–µ–ª–∏"
            if (currentType === 'income') {
                savingGoalField.classList.remove('hidden');
            } else {
                savingGoalField.classList.add('hidden');
                savingGoalSelect.value = '';
            }
            
            // –õ–æ–≥–∏–∫–∞ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –ø–æ–ª—è "–ü—Ä–∏–≤—è–∑–∞—Ç—å –∫ –¥–æ–ª–≥—É"
            if (linkDebtSelect.options.length > 1) { 
                debtLinkingField.classList.remove('hidden');
            } else {
                debtLinkingField.classList.add('hidden');
            }


            transactionModal.classList.remove('hidden');
            updateBodyScrollAndBlur();
        };

        const closeModals = () => {
            transactionModal.classList.add('hidden');
            viewModal.classList.add('hidden');
            confirmModal.classList.add('hidden');
            debtModal.classList.add('hidden'); // –ù–û–í–û–ï: –°–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–æ–ª–≥–æ–≤
            helpModal.classList.add('hidden');
            supportModal.classList.add('hidden'); // –î–û–ë–ê–í–õ–ï–ù–û
            document.getElementById('date').closest('div').classList.remove('hidden');
            document.getElementById('time').closest('div').classList.remove('hidden');
            updateBodyScrollAndBlur();
        };

        let confirmResolver;
        const showConfirmModal = (title, message) => {
            confirmModalTitle.textContent = title;
            confirmModalMessage.textContent = message;
            confirmModal.classList.remove('hidden');
            updateBodyScrollAndBlur();

            return new Promise(resolve => {
                confirmResolver = resolve;
            });
        };

        const handleConfirmAction = (result) => {
            closeModals();
            if (confirmResolver) {
                confirmResolver(result);
                confirmResolver = null;
            }
        };

        const showUndoButton = () => {
            clearTimeout(undoTimeoutId);
            undoContainer.classList.remove('opacity-0', 'scale-0', 'pointer-events-none');
            undoContainer.classList.add('opacity-100', 'scale-100', 'pointer-events-auto');

            undoTimeoutId = setTimeout(() => {
                hideUndoButton();
                lastDeletedItem = null;
            }, UNDO_TIMEOUT_MS);
        };

        const hideUndoButton = () => {
            undoContainer.classList.remove('opacity-100', 'scale-100', 'pointer-events-auto');
            undoContainer.classList.add('opacity-0', 'scale-0', 'pointer-events-none');
            clearTimeout(undoTimeoutId);
        };

        const undoLastDeletion = () => {
            if (!lastDeletedItem) {
                showToast('–ù–µ—Ç –¥–µ–π—Å—Ç–≤–∏—è –¥–ª—è –æ—Ç–º–µ–Ω—ã.', 'info');
                return;
            }

            const { type, data } = lastDeletedItem;

            if (type === 'transaction') {
                transactions.push(data);
                // –û—Ç–º–µ–Ω–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –¥–æ–ª–≥–∞
                if (data.debtId) {
                    const debt = getDebtById(data.debtId);
                    if (debt) {
                        debt.paidAmount += parseFloat(data.amount); // –ë—ã–ª–æ -=, —Ç–µ–ø–µ—Ä—å += –ø—Ä–∏ –æ—Ç–º–µ–Ω–µ —É–¥–∞–ª–µ–Ω–∏—è
                        debt.transactions.push(data.id); // –í–æ–∑–≤—Ä–∞—â–∞–µ–º ID —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –≤ —Å–ø–∏—Å–æ–∫
                    }
                }
                showToast('–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è —É—Å–ø–µ—à–Ω–æ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞.', 'success');
            } else if (type === 'incomeCategory' || type === 'expenseCategory') {
                categories[data.type].push(data.category);
                categories[data.type].sort((a, b) => a.name.localeCompare(b.name));
                showToast(`–ö–∞—Ç–µ–≥–æ—Ä–∏—è "${data.category.name}" —É—Å–ø–µ—à–Ω–æ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞.`, 'success');
            } else if (type === 'account') {
                accounts.push(data);
                accounts.sort((a, b) => a.name.localeCompare(b.name));
                showToast(`–°—á–µ—Ç "${data.name}" —É—Å–ø–µ—à–Ω–æ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω.`, 'success');
            } else if (type === 'recurringTransaction') {
                recurringTransactions.push(data);
                showToast(`–ü–æ–≤—Ç–æ—Ä—è—é—â–∞—è—Å—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è —É—Å–ø–µ—à–Ω–æ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞.`, 'success');
            } else if (type === 'savingGoal') {
                savingGoals.push(data);
                savingGoals.sort((a, b) => a.name.localeCompare(b.name));
                showToast(`–¶–µ–ª—å "${data.name}" —É—Å–ø–µ—à–Ω–æ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞.`, 'success');
            } else if (type === 'debt') { // –ù–û–í–û–ï: –û—Ç–º–µ–Ω–∞ —É–¥–∞–ª–µ–Ω–∏—è –¥–æ–ª–≥–∞
                debts.push(data);
                debts.sort((a, b) => a.person.localeCompare(b.person));
                showToast(`–î–æ–ª–≥ "${data.person} - ${data.originalAmount}" —É—Å–ø–µ—à–Ω–æ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω.`, 'success');
            }

            lastDeletedItem = null;
            hideUndoButton();
            saveData();
            renderAll();
        };

        // --- –ì–ª–æ–±–∞–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ (–¥–ª—è onclick) ---
        window.viewTransaction = (id) => {
            const t = transactions.find(t => t.id === id);
            if (!t) return;
            const isIncome = t.type === 'income';
            const categoryObj = getCategoryById(t.category, t.type);
            const accountObj = getAccountById(t.account);
            const savingGoalObj = t.savingGoalId ? getSavingGoalById(t.savingGoalId) : null;
            const debtObj = t.debtId ? getDebtById(t.debtId) : null; 

            document.getElementById('view-type').textContent = isIncome ? '–î–æ—Ö–æ–¥' : '–†–∞—Å—Ö–æ–¥';
            document.getElementById('view-type').className = `font-bold ${isIncome ? 'text-green-600' : 'text-red-600'}`;
            document.getElementById('view-amount').textContent = `${isIncome ? '+' : '-'} ${formatCurrency(t.amount)}`;
            document.getElementById('view-amount').className = `font-bold text-lg ${isIncome ? 'text-green-600' : 'text-red-600'}`;
            
            // –ò—Å–ø–æ–ª—å–∑—É–µ–º –≤—ã–±—Ä–∞–Ω–Ω—ã–π —Ü–≤–µ—Ç –∏ –∏–∫–æ–Ω–∫—É
            document.getElementById('view-category').innerHTML = `<i class="${categoryObj ? categoryObj.icon : 'fa-solid fa-tag'} mr-1" style="color: ${categoryObj ? categoryObj.color : '#6b7280'};"></i>${categoryObj ? categoryObj.name : '–ë–µ–∑ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏'}`;
            document.getElementById('view-account').textContent = accountObj ? accountObj.name : '–ë–µ–∑ —Å—á–µ—Ç–∞';
            document.getElementById('view-date').textContent = formatDate(t.date);
            document.getElementById('view-time').textContent = t.time || '–ù–µ —É–∫–∞–∑–∞–Ω–æ';
            document.getElementById('view-description').textContent = t.description || '–û–ø–∏—Å–∞–Ω–∏–µ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç.';
            
            const viewSavingGoalRow = document.getElementById('view-saving-goal-row');
            const viewSavingGoal = document.getElementById('view-saving-goal');
            if (savingGoalObj) {
                viewSavingGoal.textContent = savingGoalObj.name;
                viewSavingGoalRow.classList.remove('hidden');
            } else {
                viewSavingGoalRow.classList.add('hidden');
            }

            // –ù–û–í–û–ï: –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ø—Ä–∏–≤—è–∑–∞–Ω–Ω–æ–≥–æ –¥–æ–ª–≥–∞
            const viewDebtRow = document.getElementById('view-debt-row');
            const viewDebt = document.getElementById('view-debt');
            if (debtObj) {
                viewDebt.textContent = `${debtObj.person} - ${debtObj.description || '–ë–µ–∑ –æ–ø–∏—Å–∞–Ω–∏—è'}`;
                viewDebtRow.classList.remove('hidden');
            } else {
                viewDebtRow.classList.add('hidden');
            }

            viewModal.classList.remove('hidden');
            updateBodyScrollAndBlur();
        };

        window.editTransaction = (id) => {
            const transaction = transactions.find(t => t.id === id);
            if (transaction) openFormModal(transaction, false, null);
        };

        window.deleteTransaction = async (id) => {
            const confirmed = await showConfirmModal('–£–¥–∞–ª–∏—Ç—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é?', '–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç—É —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é? –ï—ë –º–æ–∂–Ω–æ –±—É–¥–µ—Ç –æ—Ç–º–µ–Ω–∏—Ç—å –≤ —Ç–µ—á–µ–Ω–∏–µ 10 —Å–µ–∫—É–Ω–¥.');
            if (confirmed) {
                const index = transactions.findIndex(t => t.id === id);
                if (index > -1) {
                    const deletedTransaction = transactions[index];
                    lastDeletedItem = { type: 'transaction', data: deletedTransaction };
                    transactions.splice(index, 1);

                    // –ù–û–í–û–ï: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–≤—è–∑–∞–Ω–Ω–æ–≥–æ –¥–æ–ª–≥–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
                    if (deletedTransaction.debtId) {
                        const debt = getDebtById(deletedTransaction.debtId);
                        if (debt) {
                            debt.paidAmount -= parseFloat(deletedTransaction.amount);
                            debt.transactions = debt.transactions.filter(tId => tId !== deletedTransaction.id);
                        }
                    }

                    saveData();
                    renderAll();
                    showToast('–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è —É—Å–ø–µ—à–Ω–æ —É–¥–∞–ª–µ–Ω–∞.', 'success');
                    showUndoButton();
                }
            } else {
                showToast('–£–¥–∞–ª–µ–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –æ—Ç–º–µ–Ω–µ–Ω–æ.', 'info');
            }
        };

        // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è –∫–∞—Ç–µ–≥–æ—Ä–∏–π
        window.addCategory = (type) => {
            // –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —à–∞–±–ª–æ–Ω `new-${type}-category-name` –¥–ª—è –æ–±–æ–∏—Ö —Ç–∏–ø–æ–≤
            const nameInput = document.getElementById(`new-${type}-category-name`);
            const colorInput = document.getElementById(`new-${type}-category-color`);
            const iconInput = document.getElementById(`new-${type}-category-icon`);

            const newCategoryName = nameInput.value.trim();
            const newCategoryColor = colorInput.value;
            const newCategoryIcon = iconInput.value.trim();

            if (!newCategoryName) { showToast('–ù–∞–∑–≤–∞–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—É—Å—Ç—ã–º.', 'warning'); return; }
            if (!newCategoryIcon) { showToast('–ò–∫–æ–Ω–∫–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—É—Å—Ç–æ–π. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ Font Awesome –∫–ª–∞—Å—Å—ã (–Ω–∞–ø—Ä–∏–º–µ—Ä, fa-solid fa-tag).', 'warning'); return; }

            if (categories[type].some(cat => cat.name === newCategoryName)) {
                showToast('–¢–∞–∫–∞—è –∫–∞—Ç–µ–≥–æ—Ä–∏—è —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç.', 'warning');
                return;
            }

            const newCategory = {
                id: generateUniqueId(type.slice(0, 3)),
                name: newCategoryName,
                icon: newCategoryIcon,
                color: newCategoryColor,
                budget: type === 'expense' ? 0 : undefined 
            };
            categories[type].push(newCategory);
            categories[type].sort((a, b) => a.name.localeCompare(b.name));
            saveData();
            renderCategories();
            updateCategoryOptions('income'); 
            updateCategoryOptions('expense');
            if (type === 'expense') { renderBudgetSummary(); }
            renderCharts(); // –û–±–Ω–æ–≤–ª—è–µ–º –≥—Ä–∞—Ñ–∏–∫–∏ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
            showToast(`–ö–∞—Ç–µ–≥–æ—Ä–∏—è "${newCategoryName}" (${type === 'income' ? '–î–æ—Ö–æ–¥' : '–†–∞—Å—Ö–æ–¥'}) —É—Å–ø–µ—à–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω–∞.`, 'success');
            nameInput.value = '';
            // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Ü–≤–µ—Ç–∞ –Ω–∞ –¥–µ—Ñ–æ–ª—Ç–Ω—ã–µ –¥–ª—è —Ç–∏–ø–∞
            colorInput.value = (type === 'income' ? '#22c55e' : '#ef4444');
            iconInput.value = (type === 'income' ? 'fa-solid fa-money-bill-wave' : 'fa-solid fa-cart-shopping');
        };

        // –î–æ–±–∞–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
        window.editCategory = async (type, id) => {
            const category = getCategoryById(id, type);
            if (!category) return;

            const newName = prompt('–í–≤–µ–¥–∏—Ç–µ –Ω–æ–≤–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏:', category.name);
            if (newName === null) return; // –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–º–µ–Ω–∏–ª
            if (!newName.trim()) { showToast('–ù–∞–∑–≤–∞–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—É—Å—Ç—ã–º.', 'warning'); return; }
            if (newName.trim() !== category.name && categories[type].some(cat => cat.name === newName.trim() && cat.id !== id)) {
                showToast('–ö–∞—Ç–µ–≥–æ—Ä–∏—è —Å —Ç–∞–∫–∏–º –Ω–∞–∑–≤–∞–Ω–∏–µ–º —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç.', 'warning');
                return;
            }

            const newIcon = prompt('–í–≤–µ–¥–∏—Ç–µ –Ω–æ–≤—ã–π CSS-–∫–ª–∞—Å—Å Font Awesome –¥–ª—è –∏–∫–æ–Ω–∫–∏:', category.icon);
            if (newIcon === null) return; // –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–º–µ–Ω–∏–ª
            if (!newIcon.trim()) { showToast('–ò–∫–æ–Ω–∫–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—É—Å—Ç–æ–π.', 'warning'); return; }

            const newColor = prompt('–í–≤–µ–¥–∏—Ç–µ –Ω–æ–≤—ã–π —Ü–≤–µ—Ç –≤ —Ñ–æ—Ä–º–∞—Ç–µ HEX (–Ω–∞–ø—Ä–∏–º–µ—Ä, #RRGGBB):', category.color);
            if (newColor === null) return; // –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–º–µ–Ω–∏–ª
            if (!/^#([A-Fa-f0-9]{6}|[A-Fa-f0-9]{3})$/.test(newColor)) {
                showToast('–ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç —Ü–≤–µ—Ç–∞. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ HEX (–Ω–∞–ø—Ä–∏–º–µ—Ä, #RRGGBB).', 'warning');
                return;
            }

            category.name = newName.trim();
            category.icon = newIcon.trim();
            category.color = newColor.trim();

            saveData();
            renderCategories();
            updateCategoryOptions(type);
            if (type === 'expense') { renderBudgetSummary(); }
            renderCharts(); // –û–±–Ω–æ–≤–ª—è–µ–º –≥—Ä–∞—Ñ–∏–∫–∏ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
            showToast(`–ö–∞—Ç–µ–≥–æ—Ä–∏—è "${category.name}" —É—Å–ø–µ—à–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∞.`, 'success');
        };


        window.deleteCategory = async (type, id) => {
            const categoryObj = getCategoryById(id, type);
            if (!categoryObj) return;

            if (transactions.some(t => t.category === id && t.type === type)) {
                showToast('–ù–µ–ª—å–∑—è —É–¥–∞–ª–∏—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é, —Ç–∞–∫ –∫–∞–∫ –æ–Ω–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è—Ö.', 'error');
                return;
            }
            if (recurringTransactions.some(rt => rt.category === id && rt.type === type)) {
                 showToast('–ù–µ–ª—å–∑—è —É–¥–∞–ª–∏—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é, —Ç–∞–∫ –∫–∞–∫ –æ–Ω–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ –ø–æ–≤—Ç–æ—Ä—è—é—â–∏—Ö—Å—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è—Ö.', 'error');
                 return;
            }

            const confirmed = await showConfirmModal('–£–¥–∞–ª–∏—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é?', `–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é "${categoryObj.name}"? –ï—ë –º–æ–∂–Ω–æ –±—É–¥–µ—Ç –æ—Ç–º–µ–Ω–∏—Ç—å –≤ —Ç–µ—á–µ–Ω–∏–µ 10 —Å–µ–∫—É–Ω–¥.`);
            if (confirmed) {
                const index = categories[type].findIndex(cat => cat.id === id);
                if (index > -1) {
                    lastDeletedItem = { type: type === 'income' ? 'incomeCategory' : 'expenseCategory', data: { type, category: categories[type][index] } };
                    categories[type].splice(index, 1);
                    saveData();
                    renderCategories();
                    updateCategoryOptions('income');
                    updateCategoryOptions('expense');
                    renderCharts();
                    if (type === 'expense') { renderBudgetSummary(); }
                    showToast(`–ö–∞—Ç–µ–≥–æ—Ä–∏—è "${categoryObj.name}" —É—Å–ø–µ—à–Ω–æ —É–¥–∞–ª–µ–Ω–∞.', 'success`);
                    showUndoButton();
                }
            } else {
                showToast('–£–¥–∞–ª–µ–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –æ—Ç–º–µ–Ω–µ–Ω–æ.', 'info');
            }
        };

        window.updateCategoryBudget = (id, newBudget) => {
            const category = categories.expense.find(cat => cat.id === id);
            if (category) {
                const budgetValue = parseFloat(newBudget);
                if (!isNaN(budgetValue) && budgetValue >= 0) {
                    category.budget = budgetValue;
                    saveData();
                    renderBudgetSummary();
                    showToast(`–ë—é–¥–∂–µ—Ç –¥–ª—è "${category.name}" –æ–±–Ω–æ–≤–ª–µ–Ω –¥–æ ${formatCurrency(budgetValue)}.`, 'success', 1500);
                } else {
                    showToast('–ù–µ–≤–µ—Ä–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –±—é–¥–∂–µ—Ç–∞. –í–≤–µ–¥–∏—Ç–µ —á–∏—Å–ª–æ >= 0.', 'warning', 2000);
                }
            }
        };

        // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Å—á–µ—Ç–æ–≤
        window.addAccount = () => {
            const input = document.getElementById('new-account-name');
            const newAccountName = input.value.trim();
            if (newAccountName) {
                if (!accounts.some(acc => acc.name === newAccountName)) {
                    const newAccount = { id: generateUniqueId('acc'), name: newAccountName, balance: 0 };
                    accounts.push(newAccount);
                    accounts.sort((a, b) => a.name.localeCompare(b.name));
                    saveData();
                    renderAccounts();
                    updateAccountOptions(); 
                    showToast(`–°—á–µ—Ç "${newAccountName}" —É—Å–ø–µ—à–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω.`, 'success');
                    input.value = '';
                } else {
                    showToast('–°—á–µ—Ç —Å —Ç–∞–∫–∏–º –Ω–∞–∑–≤–∞–Ω–∏–µ–º —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç.', 'warning');
                }
            } else {
                showToast('–ù–∞–∑–≤–∞–Ω–∏–µ —Å—á–µ—Ç–∞ –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—É—Å—Ç—ã–º.', 'warning');
            }
        };

        window.deleteAccount = async (id) => {
            const accountObj = getAccountById(id);
            if (!accountObj) return;

            if (transactions.some(t => t.account === id)) {
                showToast('–ù–µ–ª—å–∑—è —É–¥–∞–ª–∏—Ç—å —Å—á–µ—Ç, —Ç–∞–∫ –∫–∞–∫ –æ–Ω –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è—Ö.', 'error');
                return;
            }
            if (recurringTransactions.some(rt => rt.account === id)) {
                showToast('–ù–µ–ª—å–∑—è —É–¥–∞–ª–∏—Ç—å —Å—á–µ—Ç, —Ç–∞–∫ –∫–∞–∫ –æ–Ω –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ –ø–æ–≤—Ç–æ—Ä—è—é—â–∏—Ö—Å—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è—Ö.', 'error');
                return;
            }

            const confirmed = await showConfirmModal('–£–¥–∞–ª–∏—Ç—å —Å—á–µ—Ç?', `–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —Å—á–µ—Ç "${accountObj.name}"? –ï–≥–æ –º–æ–∂–Ω–æ –±—É–¥–µ—Ç –æ—Ç–º–µ–Ω–∏—Ç—å –≤ —Ç–µ—á–µ–Ω–∏–µ 10 —Å–µ–∫—É–Ω–¥.`);
            if (confirmed) {
                const index = accounts.findIndex(acc => acc.id === id);
                if (index > -1) {
                    lastDeletedItem = { type: 'account', data: accounts[index] };
                    accounts.splice(index, 1);
                    saveData();
                    renderAccounts();
                    updateAccountOptions();
                    renderAccountsSummary(); 
                    showToast(`–°—á–µ—Ç "${accountObj.name}" —É—Å–ø–µ—à–Ω–æ —É–¥–∞–ª–µ–Ω.`, 'success');
                    showUndoButton();
                }
            } else {
                showToast('–£–¥–∞–ª–µ–Ω–∏–µ —Å—á–µ—Ç–∞ –æ—Ç–º–µ–Ω–µ–Ω–æ.', 'info');
            }
        };

        // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è –ø–æ–≤—Ç–æ—Ä—è—é—â–∏—Ö—Å—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
        window.editRecurringTransaction = (id) => {
            const recurringItem = recurringTransactions.find(rt => rt.id === id);
            if (recurringItem) openFormModal(null, true, recurringItem);
        };

        window.deleteRecurringTransaction = async (id) => {
            const recurringItem = recurringTransactions.find(rt => rt.id === id);
            if (!recurringItem) return;

            const confirmed = await showConfirmModal('–£–¥–∞–ª–∏—Ç—å –ø–æ–≤—Ç–æ—Ä—è—é—â—É—é—Å—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é?', `–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —à–∞–±–ª–æ–Ω –¥–ª—è "${recurringItem.description || '–ë–µ–∑ –æ–ø–∏—Å–∞–Ω–∏—è'}"? –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –æ—Å—Ç–∞–Ω—É—Ç—Å—è. –ï—ë –º–æ–∂–Ω–æ –±—É–¥–µ—Ç –æ—Ç–º–µ–Ω–∏—Ç—å –≤ —Ç–µ—á–µ–Ω–∏–µ 10 —Å–µ–∫—É–Ω–¥.`);
            if (confirmed) {
                const index = recurringTransactions.findIndex(rt => rt.id === id);
                if (index > -1) {
                    lastDeletedItem = { type: 'recurringTransaction', data: recurringTransactions[index] };
                    recurringTransactions.splice(index, 1);
                    saveData();
                    renderRecurringTransactions();
                    showToast('–ü–æ–≤—Ç–æ—Ä—è—é—â–∞—è—Å—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è —É—Å–ø–µ—à–Ω–æ —É–¥–∞–ª–µ–Ω–∞.', 'success');
                    showUndoButton();
                }
            } else {
                showToast('–£–¥–∞–ª–µ–Ω–∏–µ –ø–æ–≤—Ç–æ—Ä—è—é—â–µ–π—Å—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –æ—Ç–º–µ–Ω–µ–Ω–æ.', 'info');
            }
        };

        // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ü–µ–ª–µ–π –Ω–∞–∫–æ–ø–ª–µ–Ω–∏—è
        window.addSavingGoal = () => {
            const nameInput = document.getElementById('new-saving-goal-name');
            const amountInput = document.getElementById('new-saving-goal-amount');
            const name = nameInput.value.trim();
            const targetAmount = parseFloat(amountInput.value);

            if (!name) { showToast('–ù–∞–∑–≤–∞–Ω–∏–µ —Ü–µ–ª–∏ –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—É—Å—Ç—ã–º.', 'warning'); return; }
            if (isNaN(targetAmount) || targetAmount <= 0) { showToast('–¶–µ–ª–µ–≤–∞—è —Å—É–º–º–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–º —á–∏—Å–ª–æ–º.', 'warning'); return; }
            if (savingGoals.some(goal => goal.name === name)) { showToast('–¶–µ–ª—å —Å —Ç–∞–∫–∏–º –Ω–∞–∑–≤–∞–Ω–∏–µ–º —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç.', 'warning'); return; }

            const newGoal = {
                id: generateUniqueId('SG'),
                name: name,
                targetAmount: targetAmount,
            };
            savingGoals.push(newGoal);
            savingGoals.sort((a, b) => a.name.localeCompare(b.name));
            saveData();
            renderSavingGoalsSettings();
            renderSavingGoalsSummary();
            updateSavingGoalOptions();
            showToast(`–¶–µ–ª—å "${name}" —É—Å–ø–µ—à–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω–∞.`, 'success');
            nameInput.value = '';
            amountInput.value = '';
        };

        window.editSavingGoal = async (id) => {
            const goal = getSavingGoalById(id);
            if (!goal) return;

            const newName = prompt('–ù–æ–≤–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —Ü–µ–ª–∏:', goal.name);
            if (newName === null) return;
            const newAmountStr = prompt('–ù–æ–≤–∞—è —Ü–µ–ª–µ–≤–∞—è —Å—É–º–º–∞:', goal.targetAmount);
            if (newAmountStr === null) return;

            const newTargetAmount = parseFloat(newAmountStr);

            if (!newName.trim()) { showToast('–ù–∞–∑–≤–∞–Ω–∏–µ —Ü–µ–ª–∏ –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—É—Å—Ç—ã–º.', 'warning'); return; }
            if (isNaN(newTargetAmount) || newTargetAmount <= 0) { showToast('–¶–µ–ª–µ–≤–∞—è —Å—É–º–º–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–º —á–∏—Å–ª–æ–º.', 'warning'); return; }
            if (newName.trim() !== goal.name && savingGoals.some(g => g.name === newName.trim() && g.id !== goal.id)) {
                showToast('–¶–µ–ª—å —Å —Ç–∞–∫–∏–º –Ω–∞–∑–≤–∞–Ω–∏–µ–º —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç.', 'warning');
                return;
            }

            goal.name = newName.trim();
            goal.targetAmount = newTargetAmount;
            saveData();
            renderSavingGoalsSettings();
            renderSavingGoalsSummary();
            updateSavingGoalOptions();
            showToast(`–¶–µ–ª—å "${goal.name}" —É—Å–ø–µ—à–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∞.`, 'success');
        };

        window.deleteSavingGoal = async (id) => {
            const goal = getSavingGoalById(id);
            if (!goal) return;

            if (transactions.some(t => t.savingGoalId === id)) {
                showToast('–ù–µ–ª—å–∑—è —É–¥–∞–ª–∏—Ç—å —Ü–µ–ª—å, —Ç–∞–∫ –∫–∞–∫ –æ–Ω–∞ –ø—Ä–∏–≤—è–∑–∞–Ω–∞ –∫ –æ–¥–Ω–æ–π –∏–ª–∏ –Ω–µ—Å–∫–æ–ª—å–∫–∏–º —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è–º.', 'error');
                return;
            }
            if (recurringTransactions.some(rt => rt.savingGoalId === id)) {
                showToast('–ù–µ–ª—å–∑—è —É–¥–∞–ª–∏—Ç—å —Ü–µ–ª—å, —Ç–∞–∫ –∫–∞–∫ –æ–Ω–∞ –ø—Ä–∏–≤—è–∑–∞–Ω–∞ –∫ –ø–æ–≤—Ç–æ—Ä—è—é—â–∏–º—Å—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è–º.', 'error');
                return;
            }

            const confirmed = await showConfirmModal('–£–¥–∞–ª–∏—Ç—å —Ü–µ–ª—å?', `–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —Ü–µ–ª—å –Ω–∞–∫–æ–ø–ª–µ–Ω–∏—è "${goal.name}"? –ï—ë –º–æ–∂–Ω–æ –±—É–¥–µ—Ç –æ—Ç–º–µ–Ω–∏—Ç—å –≤ —Ç–µ—á–µ–Ω–∏–µ 10 —Å–µ–∫—É–Ω–¥.`);
            if (confirmed) {
                const index = savingGoals.findIndex(g => g.id === id);
                if (index > -1) {
                    lastDeletedItem = { type: 'savingGoal', data: savingGoals[index] };
                    savingGoals.splice(index, 1);
                    saveData();
                    renderSavingGoalsSettings();
                    renderSavingGoalsSummary();
                    updateSavingGoalOptions();
                    showToast(`–¶–µ–ª—å "${goal.name}" —É—Å–ø–µ—à–Ω–æ —É–¥–∞–ª–µ–Ω–∞.`, 'success');
                    showUndoButton();
                }
            } else {
                showToast('–£–¥–∞–ª–µ–Ω–∏–µ —Ü–µ–ª–∏ –æ—Ç–º–µ–Ω–µ–Ω–æ.', 'info');
            }
        };

        // –ù–û–í–û–ï: –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –¥–æ–ª–≥–æ–≤ –∏ –∏—Ö –æ–±—Ä–∞–±–æ—Ç–∫–∏
        const openDebtModal = (debt = null) => {
            debtForm.reset();
            document.getElementById('debt-form-id').value = '';
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('debt-form-due-date').value = today;

            if (debt) {
                document.getElementById('debt-modal-title').textContent = '–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –¥–æ–ª–≥';
                document.getElementById('debt-form-id').value = debt.id;
                document.getElementById('debt-form-type').value = debt.type;
                document.getElementById('debt-form-person').value = debt.person;
                document.getElementById('debt-form-amount').value = debt.originalAmount;
                document.getElementById('debt-form-due-date').value = debt.dueDate;
                document.getElementById('debt-form-description').value = debt.description;
            } else {
                document.getElementById('debt-modal-title').textContent = '–î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π –¥–æ–ª–≥';
            }
            debtModal.classList.remove('hidden');
            updateBodyScrollAndBlur();
        };

        const closeDebtModal = () => {
            debtModal.classList.add('hidden');
            debtForm.reset();
            updateBodyScrollAndBlur();
        };

        const handleDebtFormSubmit = (e) => {
            e.preventDefault();
            const id = document.getElementById('debt-form-id').value;
            const type = document.getElementById('debt-form-type').value;
            const person = document.getElementById('debt-form-person').value.trim();
            const originalAmount = parseFloat(document.getElementById('debt-form-amount').value);
            const dueDate = document.getElementById('debt-form-due-date').value;
            const description = document.getElementById('debt-form-description').value.trim();

            if (!person) { showToast('–ü–æ–ª–µ "–ö–æ–º—É/–ö—Ç–æ –¥–æ–ª–∂–µ–Ω" –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—É—Å—Ç—ã–º.', 'warning'); return; }
            if (isNaN(originalAmount) || originalAmount <= 0) { showToast('–°—É–º–º–∞ –¥–æ–ª–≥–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–º —á–∏—Å–ª–æ–º.', 'warning'); return; }
            if (!dueDate) { showToast('–£–∫–∞–∂–∏—Ç–µ —Å—Ä–æ–∫ –ø–æ–≥–∞—à–µ–Ω–∏—è –¥–æ–ª–≥–∞.', 'warning'); return; }

            if (id) {
                // –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –¥–æ–ª–≥–∞
                const debtIndex = debts.findIndex(d => d.id === id);
                if (debtIndex > -1) {
                    const existingDebt = debts[debtIndex];
                    existingDebt.type = type;
                    existingDebt.person = person;
                    existingDebt.originalAmount = originalAmount;
                    existingDebt.dueDate = dueDate;
                    existingDebt.description = description;

                    // –ï—Å–ª–∏ –Ω–æ–≤–∞—è –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–∞—è —Å—É–º–º–∞ –º–µ–Ω—å—à–µ —É–∂–µ –ø–æ–≥–∞—à–µ–Ω–Ω–æ–π, –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä—É–µ–º –ø–æ–≥–∞—à–µ–Ω–Ω—É—é
                    if (existingDebt.paidAmount > existingDebt.originalAmount) {
                        existingDebt.paidAmount = existingDebt.originalAmount;
                    }
                    showToast(`–î–æ–ª–≥ "${person}" —É—Å–ø–µ—à–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω.`, 'success');
                }
            } else {
                // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –¥–æ–ª–≥–∞
                const newDebt = {
                    id: generateUniqueId('Debt'),
                    type,
                    person,
                    originalAmount,
                    paidAmount: 0,
                    dueDate,
                    description,
                    transactions: []
                };
                debts.push(newDebt);
                debts.sort((a, b) => a.person.localeCompare(b.person));
                showToast(`–î–æ–ª–≥ "${person} - ${formatCurrency(originalAmount)}" —É—Å–ø–µ—à–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω.`, 'success');
            }
            saveData();
            renderAll();
            closeDebtModal();
        };

        // window.editDebt —Ç–µ–ø–µ—Ä—å –ø—Ä–æ—Å—Ç–æ –≤—ã–∑—ã–≤–∞–µ—Ç openDebtModal
        window.editDebt = (id) => {
            const debt = getDebtById(id);
            if (debt) openDebtModal(debt);
        };

        window.deleteDebt = async (id) => {
            const debt = getDebtById(id);
            if (!debt) return;

            if (debt.transactions && debt.transactions.length > 0) {
                showToast('–ù–µ–ª—å–∑—è —É–¥–∞–ª–∏—Ç—å –¥–æ–ª–≥, —Ç–∞–∫ –∫–∞–∫ –∫ –Ω–µ–º—É –ø—Ä–∏–≤—è–∑–∞–Ω—ã —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏. –°–Ω–∞—á–∞–ª–∞ —É–¥–∞–ª–∏—Ç–µ –∏–ª–∏ –æ—Ç–≤—è–∂–∏—Ç–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏.', 'error');
                return;
            }
            if (recurringTransactions.some(rt => rt.debtId === id)) {
                showToast('–ù–µ–ª—å–∑—è —É–¥–∞–ª–∏—Ç—å –¥–æ–ª–≥, —Ç–∞–∫ –∫–∞–∫ –æ–Ω –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ –ø–æ–≤—Ç–æ—Ä—è—é—â–∏—Ö—Å—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è—Ö. –°–Ω–∞—á–∞–ª–∞ –æ—Ç–≤—è–∂–∏—Ç–µ –µ–≥–æ.', 'error');
                return;
            }

            const confirmed = await showConfirmModal('–£–¥–∞–ª–∏—Ç—å –¥–æ–ª–≥?', `–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å –∑–∞–ø–∏—Å—å –æ –¥–æ–ª–≥–µ "${debt.person} - ${debt.description || '–±–µ–∑ –æ–ø–∏—Å–∞–Ω–∏—è'}"? –ï—ë –º–æ–∂–Ω–æ –±—É–¥–µ—Ç –æ—Ç–º–µ–Ω–∏—Ç—å –≤ —Ç–µ—á–µ–Ω–∏–µ 10 —Å–µ–∫—É–Ω–¥.`);
            if (confirmed) {
                const index = debts.findIndex(d => d.id === id);
                if (index > -1) {
                    lastDeletedItem = { type: 'debt', data: debts[index] };
                    debts.splice(index, 1);
                    saveData();
                    renderDebtsSettings();
                    renderDashboardDebtsSummary();
                    updateDebtLinkingOptions(document.querySelector('input[name="type"]:checked')?.value || 'income');
                    showToast(`–î–æ–ª–≥ "${debt.person}" —É—Å–ø–µ—à–Ω–æ —É–¥–∞–ª–µ–Ω.`, 'success');
                    showUndoButton();
                }
            } else {
                showToast('–£–¥–∞–ª–µ–Ω–∏–µ –¥–æ–ª–≥–∞ –æ—Ç–º–µ–Ω–µ–Ω–æ.', 'info');
            }
        };

        window.exportData = () => {
            const dataStr = JSON.stringify({ transactions, categories, accounts, recurringTransactions, savingGoals, debts }, null, 2); // –ù–û–í–û–ï: –¥–æ–±–∞–≤–∏–ª–∏ debts
            const blob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `budget_backup_${new Date().toISOString().slice(0, 10)}.json`;
            showToast('–î–∞–Ω–Ω—ã–µ —É—Å–ø–µ—à–Ω–æ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã.', 'success');
            a.click();
            URL.revokeObjectURL(url);
        };

        // --- –ù–û–í–ê–Ø –§–£–ù–ö–¶–ò–Ø: –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∏–º–ø–æ—Ä—Ç–∞ –¥–∞–Ω–Ω—ã—Ö ---
        const importDataHandler = (event) => {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = (e) => {
                try {
                    const importedData = JSON.parse(e.target.result);

                    // –ë–∞–∑–æ–≤–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è —Å—Ç—Ä—É–∫—Ç—É—Ä—ã
                    if (!importedData || !importedData.transactions || !importedData.categories) {
                        showToast('–û—à–∏–±–∫–∞ –∏–º–ø–æ—Ä—Ç–∞: –§–∞–π–ª –Ω–µ —Å–æ–¥–µ—Ä–∂–∏—Ç –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã—Ö —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö (—Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –∏–ª–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–π).', 'error');
                        return;
                    }

                    // 1. –ó–∞–º–µ–Ω—è–µ–º –≤—Å–µ –≥–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –Ω–∞ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
                    transactions = importedData.transactions || [];
                    categories = importedData.categories || { income: [], expense: [] };
                    accounts = importedData.accounts || [];
                    recurringTransactions = importedData.recurringTransactions || [];
                    savingGoals = importedData.savingGoals || [];
                    debts = importedData.debts || []; 
                    
                    // 2. –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –ª–æ–≥–∏–∫–∞ –º–∏–≥—Ä–∞—Ü–∏–∏ –¥–ª—è –∫–∞—Ç–µ–≥–æ—Ä–∏–π (–≤–∞–∂–Ω–æ –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏)
                    ['income', 'expense'].forEach(type => {
                        if (!categories[type]) categories[type] = []; 
                        categories[type] = categories[type].map(cat => {
                            if (typeof cat === 'string') {
                                return { 
                                    id: generateUniqueId(type.slice(0, 3)), 
                                    name: cat, 
                                    icon: type === 'income' ? 'fa-solid fa-money-bill-wave' : 'fa-solid fa-cart-shopping', 
                                    color: type === 'income' ? '#22c55e' : '#ef4444',
                                    budget: type === 'expense' ? 0 : undefined 
                                };
                            }
                            return { 
                                ...cat, 
                                icon: cat.icon || (type === 'income' ? 'fa-solid fa-money-bill-wave' : 'fa-solid fa-cart-shopping'),
                                color: cat.color || (type === 'income' ? '#22c55e' : '#ef4444'),
                                budget: (type === 'expense' && cat.budget === undefined) ? 0 : cat.budget
                            };
                        });
                    });


                    // 3. –°–æ—Ö—Ä–∞–Ω—è–µ–º –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –≤ localStorage –∏ –æ–±–Ω–æ–≤–ª—è–µ–º UI
                    saveData(); 
                    renderAll(); 
                    
                    showToast('–î–∞–Ω–Ω—ã–µ —É—Å–ø–µ—à–Ω–æ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã –∏ –∑–∞–≥—Ä—É–∂–µ–Ω—ã.', 'success');

                } catch (error) {
                    console.error('JSON Parsing Error:', error);
                    showToast('–û—à–∏–±–∫–∞ –∏–º–ø–æ—Ä—Ç–∞: –í—ã–±—Ä–∞–Ω –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –∏–ª–∏ –ø–æ–≤—Ä–µ–∂–¥–µ–Ω–Ω—ã–π JSON —Ñ–∞–π–ª.', 'error');
                } finally {
                    // –û—á–∏—â–∞–µ–º –∏–Ω–ø—É—Ç, —á—Ç–æ–±—ã –º–æ–∂–Ω–æ –±—ã–ª–æ –∑–∞–≥—Ä—É–∑–∏—Ç—å —Ç–æ—Ç –∂–µ —Ñ–∞–π–ª —Å–Ω–æ–≤–∞
                    event.target.value = ''; 
                }
            };
            reader.readAsText(file);
        };
        // --- –ö–û–ù–ï–¶ –ù–û–í–û–ô –§–£–ù–ö–¶–ò–ò ---


        // --- –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Å–µ–ª–µ–∫—Ç–æ–≤ ---
        const updateCategoryOptions = (typeForFormModal) => { 
            const selectFormCategory = document.getElementById('category'); 
            const selectFilterCategory = document.getElementById('filter-category'); 

            selectFormCategory.innerHTML = '';
            const categoriesForForm = categories[typeForFormModal];

            if (categoriesForForm.length === 0) {
                selectFormCategory.add(new Option('–ù–µ—Ç –∫–∞—Ç–µ–≥–æ—Ä–∏–π', '', true, true));
                selectFormCategory.lastChild.disabled = true;
            } else {
                categoriesForForm.sort((a,b) => a.name.localeCompare(b.name)).forEach(cat => {
                    selectFormCategory.add(new Option(cat.name, cat.id));
                });
            }

            if (selectFilterCategory) {
                const currentFilterCategory = selectFilterCategory.value; 
                selectFilterCategory.innerHTML = '<option value="all">–í—Å–µ</option>'; 

                [...categories.income].sort((a, b) => a.name.localeCompare(b.name)).forEach(cat => {
                    selectFilterCategory.add(new Option(`${cat.name} (–î–æ—Ö–æ–¥)`, cat.id));
                });

                [...categories.expense].sort((a, b) => a.name.localeCompare(b.name)).forEach(cat => {
                    selectFilterCategory.add(new Option(`${cat.name} (–†–∞—Å—Ö–æ–¥)`, cat.id));
                });

                if (selectFilterCategory.querySelector(`option[value="${currentFilterCategory}"]`)) {
                    selectFilterCategory.value = currentFilterCategory; 
                } else {
                    selectFilterCategory.value = 'all';
                }
            }
        };

        const updateAccountOptions = () => {
            const select = document.getElementById('account');
            const filterSelect = document.getElementById('filter-account');

            const currentFormAccount = select ? select.value : '';
            const currentFilterAccount = filterSelect ? filterSelect.value : 'all';

            select.innerHTML = '';
            if (filterSelect) {
                filterSelect.innerHTML = '<option value="all">–í—Å–µ</option>';
            }

            if (accounts.length === 0) {
                select.add(new Option('–ù–µ—Ç —Å—á–µ—Ç–æ–≤', '', true, true));
                select.lastChild.disabled = true;
            } else {
                [...accounts].sort((a, b) => a.name.localeCompare(b.name)).forEach(acc => {
                    select.add(new Option(acc.name, acc.id));
                });
            }

            if (filterSelect) {
                [...accounts].sort((a, b) => a.name.localeCompare(b.name)).forEach(acc => {
                    filterSelect.add(new Option(acc.name, acc.id));
                });
                if (filterSelect.querySelector(`option[value="${currentFilterAccount}"]`)) {
                    filterSelect.value = currentFilterAccount;
                } else {
                    filterSelect.value = 'all';
                }
            }
            if (select.querySelector(`option[value="${currentFormAccount}"]`)) {
                select.value = currentFormAccount;
            } else {
                select.selectedIndex = 0;
            }
        };

        const updateSavingGoalOptions = () => {
            const select = document.getElementById('saving-goal');
            select.innerHTML = '<option value="">–ù–µ –ø—Ä–∏–≤—è–∑—ã–≤–∞—Ç—å</option>';

            if (savingGoals.length === 0) {
            } else {
                [...savingGoals].sort((a, b) => a.name.localeCompare(b.name)).forEach(goal => {
                    select.add(new Option(goal.name, goal.id));
                });
            }
        };

        // –ù–û–í–û–ï: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ–ø—Ü–∏–π –¥–ª—è –ø—Ä–∏–≤—è–∑–∫–∏ –¥–æ–ª–≥–æ–≤ –≤ –º–æ–¥–∞–ª—å–Ω–æ–º –æ–∫–Ω–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
        const updateDebtLinkingOptions = (transactionType = 'income') => {
            const select = document.getElementById('link-debt');
            const debtLinkingField = document.getElementById('debt-linking-field');
            select.innerHTML = '<option value="">–ù–µ –ø—Ä–∏–≤—è–∑—ã–≤–∞—Ç—å</option>';
            
            let hasOptions = false;

            [...debts].sort((a, b) => a.person.localeCompare(b.person)).forEach(debt => {
                const remaining = debt.originalAmount - debt.paidAmount;
                if (remaining <= 0) return; // –ù–µ –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –ø–æ–ª–Ω–æ—Å—Ç—å—é –ø–æ–≥–∞—à–µ–Ω–Ω—ã–µ –¥–æ–ª–≥–∏

                let optionText = `${debt.person} (${formatCurrency(remaining)} –∏–∑ ${formatCurrency(debt.originalAmount)})`;
                if (debt.description) optionText += ` - ${debt.description}`;
                
                if (transactionType === 'income' && debt.type === 'owedToMe') {
                    select.add(new Option(optionText, debt.id));
                    hasOptions = true;
                } else if (transactionType === 'expense' && debt.type === 'iOwe') {
                    select.add(new Option(optionText, debt.id));
                    hasOptions = true;
                }
            });

            if (hasOptions) {
                debtLinkingField.classList.remove('hidden');
            } else {
                debtLinkingField.classList.add('hidden');
            }
        };


        const updateNavLinks = (hash) => {
            document.querySelectorAll('.nav-link, .nav-link-mobile').forEach(link => {
                link.classList.remove('active', 'active-parent', 'dropdown-expanded');
                const chevron = link.querySelector('.fas.fa-chevron-down');
                if (chevron) chevron.classList.remove('rotate-180');
            });
            document.querySelectorAll('.nav-dropdown-content').forEach(dropdown => {
                dropdown.classList.remove('open');
            });

            const currentActiveLink = document.querySelector(`[href="${hash}"]`);
            
            if (currentActiveLink) {
                currentActiveLink.classList.add('active');

                const parentDropdownToggle = currentActiveLink.closest('.nav-dropdown-toggle') || currentActiveLink.closest('.nav-dropdown-toggle-mobile');
                if (parentDropdownToggle) {
                    const parentLink = parentDropdownToggle.querySelector('a');
                    if (parentLink) {
                        parentLink.classList.add('active-parent', 'dropdown-expanded');
                        const chevron = parentLink.querySelector('.fas.fa-chevron-down');
                        if (chevron) chevron.classList.add('rotate-180');
                    }
                    const dropdownContent = parentDropdownToggle.querySelector('.nav-dropdown-content');
                    if (dropdownContent) dropdownContent.classList.add('open');
                }
            } else {
                const dashboardLinkDesktop = document.getElementById('dashboard-toggle-desktop');
                const dashboardLinkMobile = document.getElementById('dashboard-toggle-mobile');

                if (hash === '#dashboard' || hash === '') { 
                    [dashboardLinkDesktop, dashboardLinkMobile].forEach(link => {
                        if (link) {
                            link.classList.add('active', 'active-parent', 'dropdown-expanded'); 
                            const chevron = link.querySelector('.fas.fa-chevron-down');
                            if (chevron) chevron.classList.add('rotate-180');
                            const dropdownContent = link.nextElementSibling;
                            if (dropdownContent) dropdownContent.classList.add('open'); 
                        }
                    });
                }
            }
        };

        // --- –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è –ø–∞–≥–∏–Ω–∞—Ü–∏–∏ ---
        const goToPage = (pageIndex) => {
            currentPage = pageIndex;
            renderTransactions();
        };

        const nextPage = () => {
            let filteredTransactionsCount = transactions.filter(t => {
                const categoryTypeMap = [...categories.income, ...categories.expense].reduce((acc, cat) => {
                    acc[cat.id] = cat.budget !== undefined ? 'expense' : 'income';
                    return acc;
                }, {});

                const typeMatch = currentFilters.type === 'all' || t.type === currentFilters.type;
                const categoryMatch = currentFilters.category === 'all' || (t.category === currentFilters.category && t.type === categoryTypeMap[currentFilters.category]);
                const accountMatch = currentFilters.account === 'all' || t.account === currentFilters.account;
                const descriptionMatch = !currentFilters.description || (t.description && t.description.toLowerCase().includes(currentFilters.description.toLowerCase()));
                const amountMinMatch = currentFilters.amountMin === null || parseFloat(t.amount) >= currentFilters.amountMin;
                const amountMaxMatch = currentFilters.amountMax === null || parseFloat(t.amount) <= currentFilters.amountMax;
                const dateStartMatch = !currentFilters.dateStart || t.date >= currentFilters.dateStart;
                const dateEndMatch = !currentFilters.dateEnd || t.date <= currentFilters.dateEnd;

                return typeMatch && categoryMatch && accountMatch && descriptionMatch && amountMinMatch && amountMaxMatch && dateStartMatch && dateEndMatch;
            }).length;

            const totalPages = Math.ceil(filteredTransactionsCount / transactionsPerPage);

            if (currentPage < totalPages - 1) {
                goToPage(currentPage + 1);
            }
        };

        const prevPage = () => {
            if (currentPage > 0) {
                goToPage(currentPage - 1);
            }
        };

        const renderTransactionFilters = () => {
            updateCategoryOptions('income');
            updateAccountOptions();

            document.getElementById('filter-type').value = currentFilters.type;
            document.getElementById('filter-description').value = currentFilters.description;
            document.getElementById('filter-amount-min').value = currentFilters.amountMin || '';
            document.getElementById('filter-amount-max').value = currentFilters.amountMax || '';
            document.getElementById('filter-date-start').value = currentFilters.dateStart || '';
            document.getElementById('filter-date-end').value = currentFilters.dateEnd || '';
            document.getElementById('sort-order').value = currentFilters.sortOrder;
        };

        const applyFilters = () => {
            currentFilters.type = document.getElementById('filter-type').value;
            currentFilters.category = document.getElementById('filter-category').value;
            currentFilters.account = document.getElementById('filter-account').value;
            currentFilters.description = document.getElementById('filter-description').value.trim();
            currentFilters.amountMin = parseFloat(document.getElementById('filter-amount-min').value) || null;
            currentFilters.amountMax = parseFloat(document.getElementById('filter-amount-max').value) || null;
            currentFilters.dateStart = document.getElementById('filter-date-start').value;
            currentFilters.dateEnd = document.getElementById('filter-date-end').value;
            currentFilters.sortOrder = document.getElementById('sort-order').value;
            currentPage = 0; 
            renderTransactions();
        };

        const resetAllFilters = () => {
            currentFilters = {
                type: 'all',
                category: 'all',
                account: 'all',
                description: '',
                amountMin: null,
                amountMax: null,
                dateStart: null,
                dateEnd: null,
                sortOrder: 'date-desc'
            };
            renderTransactionFilters(); 
            applyFilters(); 
            showToast('–í—Å–µ —Ñ–∏–ª—å—Ç—Ä—ã —Å–±—Ä–æ—à–µ–Ω—ã.', 'info');
        };

        // --- –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ —Å–æ–±—ã—Ç–∏–π ---
        const setupEventListeners = () => {
            // –ú–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞
            document.getElementById('add-transaction-btn').addEventListener('click', () => openFormModal());
            document.getElementById('close-modal-btn').addEventListener('click', closeModals);
            document.getElementById('close-view-modal-btn').addEventListener('click', closeModals);
            transactionModal.addEventListener('click', e => e.target === transactionModal && closeModals());
            viewModal.addEventListener('click', e => e.target === viewModal && closeModals());
            confirmOkBtn.addEventListener('click', () => handleConfirmAction(true));
            confirmCancelBtn.addEventListener('click', () => handleConfirmAction(false));
            confirmModal.addEventListener('click', e => e.target === confirmModal && handleConfirmAction(false));

            // Help Modal handlers
            openHelpModalBtn.addEventListener('click', () => {
                helpModal.classList.remove('hidden');
                updateBodyScrollAndBlur();
            });
            document.getElementById('close-help-modal-btn').addEventListener('click', closeModals);
            helpModal.addEventListener('click', e => e.target === helpModal && closeModals());
            
            // Support Modal handlers (–ù–û–í–´–ô –ë–õ–û–ö)
            const openSupportModal = (e) => {
                e.preventDefault();
                supportModal.classList.remove('hidden');
                updateBodyScrollAndBlur();
                toggleMobileMenu(false); // –ó–∞–∫—Ä—ã—Ç—å –º–æ–±–∏–ª—å–Ω–æ–µ –º–µ–Ω—é, –µ—Å–ª–∏ –æ—Ç–∫—Ä—ã—Ç–æ
            };

            openSupportModalBtnDesktop.addEventListener('click', openSupportModal);
            openSupportModalBtnMobile.addEventListener('click', openSupportModal);
            document.getElementById('close-support-modal-btn').addEventListener('click', closeModals);
            supportModal.addEventListener('click', e => e.target === supportModal && closeModals());

            // Copy buttons handlers
            document.querySelectorAll('.copy-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const targetId = e.currentTarget.getAttribute('data-copy-target');
                    copyToClipboard(targetId);
                });
            });


            // –ù–û–í–û–ï: –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –¥–æ–ª–≥–æ–≤
            document.getElementById('add-debt-btn').addEventListener('click', () => openDebtModal());
            document.getElementById('close-debt-modal-btn').addEventListener('click', closeDebtModal);
            debtForm.addEventListener('submit', handleDebtFormSubmit);
            debtModal.addEventListener('click', e => e.target === debtModal && closeDebtModal());


            // –ö–Ω–æ–ø–∫–∞ –û—Ç–º–µ–Ω–∏—Ç—å
            undoBtn.addEventListener('click', undoLastDeletion);

            // –ú–æ–±–∏–ª—å–Ω–æ–µ –º–µ–Ω—é
            document.getElementById('open-mobile-menu-btn').addEventListener('click', () => toggleMobileMenu(true));
            document.getElementById('close-mobile-menu-btn').addEventListener('click', () => toggleMobileMenu(false));
            mobileMenuOverlay.addEventListener('click', () => toggleMobileMenu(false));
            
            document.querySelector('#mobile-menu .nav-dropdown-toggle-mobile > a').addEventListener('click', (e) => {
                const link = e.currentTarget;
                const dropdownContent = link.nextElementSibling;
                const chevronIcon = link.querySelector('.fas.fa-chevron-down');
                
                const isExpanded = link.classList.contains('dropdown-expanded');
                
                document.querySelectorAll('#mobile-menu nav a').forEach(navLink => {
                    if (navLink === link) return; 
                    navLink.classList.remove('active', 'active-parent', 'dropdown-expanded');
                    const navChevron = navLink.querySelector('.fas.fa-chevron-down');
                    if(navChevron) navChevron.classList.remove('rotate-180');
                });
                document.querySelectorAll('#mobile-menu .nav-dropdown-content').forEach(content => {
                    if (content === dropdownContent) return;
                    content.classList.remove('open');
                });

                if (!isExpanded) {
                    link.classList.add('dropdown-expanded', 'active-parent');
                    if (dropdownContent) dropdownContent.classList.add('open');
                    if (chevronIcon) chevronIcon.classList.add('rotate-180');
                    e.preventDefault();
                    updateNavLinks(link.getAttribute('href'));
                } else {
                    updateNavLinks(''); 
                }
            });

            document.querySelectorAll('#mobile-menu nav a:not(.nav-dropdown-toggle-mobile > a)').forEach(link => {
                link.addEventListener('click', (e) => {
                    updateNavLinks(e.currentTarget.getAttribute('href'));
                    // –ï—Å–ª–∏ —ç—Ç–æ –Ω–µ —Å—Å—ã–ª–∫–∞ –Ω–∞ –º–æ–¥–∞–ª–∫—É –ø–æ–¥–¥–µ—Ä–∂–∫–∏ (–∫–æ—Ç–æ—Ä–∞—è –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è –≤—ã—à–µ), —Ç–æ –∑–∞–∫—Ä—ã–≤–∞–µ–º –º–µ–Ω—é
                    if (e.currentTarget.id !== 'open-support-modal-mobile') {
                         toggleMobileMenu(false);
                    }
                });
            });

            document.querySelectorAll('aside .nav-dropdown-toggle .nav-dropdown-content a').forEach(link => {
                link.addEventListener('click', (e) => {
                    updateNavLinks(e.currentTarget.getAttribute('href'));
                });
            });

            // –§–æ—Ä–º–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
            transactionForm.addEventListener('submit', e => {
                e.preventDefault();
                const id = document.getElementById('transaction-id').value;
                const type = document.querySelector('input[name="type"]:checked').value;
                const amount = document.getElementById('amount').value;
                const category = document.getElementById('category').value;
                const account = document.getElementById('account').value;
                const date = document.getElementById('date').value;
                const time = document.getElementById('time').value;
                const description = document.getElementById('description').value;
                const isRecurringCheckbox = document.getElementById('is-recurring').checked;
                const isRecurringEdit = document.getElementById('is-recurring-edit').value === 'true';
                const savingGoalId = document.getElementById('saving-goal').value || undefined;
                const debtId = document.getElementById('link-debt').value || undefined; 


                if (!category) { showToast('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ –∏–ª–∏ —Å–æ–∑–¥–∞–π—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é.', 'warning'); return; }
                if (accounts.length > 0 && !account) { showToast('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ —Å—á–µ—Ç.', 'warning'); return; }
                if (parseFloat(amount) <= 0) { showToast('–°—É–º–º–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω–æ–π.', 'warning'); return; }

                // –ù–û–í–û–ï: –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Ç–∏–ø–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –∏ —Ç–∏–ø–∞ –¥–æ–ª–≥–∞
                if (debtId) {
                    const selectedDebt = getDebtById(debtId);
                    if (selectedDebt) {
                        if ((type === 'income' && selectedDebt.type !== 'owedToMe') || (type === 'expense' && selectedDebt.type !== 'iOwe')) {
                            showToast('–¢–∏–ø —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –Ω–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —Ç–∏–ø—É –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ –¥–æ–ª–≥–∞.', 'error');
                            return;
                        }
                    }
                }


                if (isRecurringCheckbox || isRecurringEdit) {
                    const frequency = document.getElementById('frequency').value;
                    const recurringStartDate = document.getElementById('recurring-start-date').value;
                    const recurringEndDate = document.getElementById('recurring-end-date').value || null;

                    if (!recurringStartDate) { showToast('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —É–∫–∞–∂–∏—Ç–µ –¥–∞—Ç—É –Ω–∞—á–∞–ª–∞ –¥–ª—è –ø–æ–≤—Ç–æ—Ä—è—é—â–µ–π—Å—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏.', 'warning'); return; }

                    const newRecurring = {
                        id: id || generateUniqueId('RT'),
                        type, amount, category, account, description, frequency,
                        startDate: recurringStartDate,
                        endDate: recurringEndDate,
                        lastGeneratedDate: id ? recurringTransactions.find(rt => rt.id === id)?.lastGeneratedDate : null,
                        time: time,
                        savingGoalId: savingGoalId,
                        debtId: debtId 
                    };

                    if (id && isRecurringEdit) {
                        recurringTransactions = recurringTransactions.map(rt => rt.id === id ? newRecurring : rt);
                        showToast('–ü–æ–≤—Ç–æ—Ä—è—é—â–∞—è—Å—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è —É—Å–ø–µ—à–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∞.', 'success');
                    } else {
                        recurringTransactions.push(newRecurring);
                        showToast('–ü–æ–≤—Ç–æ—Ä—è—é—â–∞—è—Å—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è —É—Å–ø–µ—à–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω–∞.', 'success');
                    }
                } else { 
                    const newTransaction = {
                        id: id || generateUniqueId('T'),
                        type, amount, category, account, date, time, description,
                        savingGoalId: savingGoalId,
                        debtId: debtId 
                    };

                    if (id) {
                        // –ù–û–í–û–ï: –ö–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∞ —Å—Ç–∞—Ä–æ–≥–æ –¥–æ–ª–≥–∞ –ø—Ä–∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
                        const oldTransaction = transactions.find(t => t.id === id);
                        if (oldTransaction && oldTransaction.debtId) {
                            const oldDebt = getDebtById(oldTransaction.debtId);
                            if (oldDebt) {
                                oldDebt.paidAmount -= parseFloat(oldTransaction.amount);
                                oldDebt.transactions = oldDebt.transactions.filter(tId => tId !== oldTransaction.id);
                            }
                        }

                        transactions = transactions.map(t => t.id === id ? newTransaction : t);
                        showToast('–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è —É—Å–ø–µ—à–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∞.', 'success');
                    } else {
                        transactions.push(newTransaction);
                        showToast('–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è —É—Å–ø–µ—à–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω–∞.', 'success');
                    }

                    // –ù–û–í–û–ï: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –¥–æ–ª–≥–∞
                    if (newTransaction.debtId) {
                        const debt = getDebtById(newTransaction.debtId);
                        if (debt) {
                            debt.paidAmount += parseFloat(newTransaction.amount);
                            if (!debt.transactions.includes(newTransaction.id)) {
                                debt.transactions.push(newTransaction.id);
                            }
                        }
                    }
                }
                saveData();
                renderAll();
                closeModals();
            });

            document.querySelectorAll('input[name="type"]').forEach(radio => {
                radio.addEventListener('change', e => {
                    const selectedType = e.target.value;
                    updateCategoryOptions(selectedType);
                    
                    const savingGoalField = document.getElementById('saving-goal-field');
                    if (selectedType === 'income') {
                        savingGoalField.classList.remove('hidden');
                        updateSavingGoalOptions();
                    } else {
                        savingGoalField.classList.add('hidden');
                        document.getElementById('saving-goal').value = '';
                    }

                    // –ù–û–í–û–ï: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ–ø—Ü–∏–π –¥–æ–ª–≥–æ–≤ –ø—Ä–∏ —Å–º–µ–Ω–µ —Ç–∏–ø–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
                    updateDebtLinkingOptions(selectedType);
                });
            });

            document.getElementById('is-recurring').addEventListener('change', (e) => {
                const recurringOptionsDiv = document.getElementById('recurring-options');
                const dateField = document.getElementById('date').closest('div');
                const timeField = document.getElementById('time').closest('div');

                if (e.target.checked) {
                    recurringOptionsDiv.classList.remove('hidden');
                    dateField.classList.add('hidden');
                    timeField.classList.add('hidden');
                } else {
                    recurringOptionsDiv.classList.add('hidden');
                    dateField.classList.remove('hidden');
                    timeField.classList.remove('hidden');
                }
            });

            // –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã –∏ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞
            document.getElementById('filter-type').addEventListener('change', applyFilters);
            document.getElementById('filter-category').addEventListener('change', applyFilters);
            document.getElementById('filter-account').addEventListener('change', applyFilters);
            document.getElementById('filter-description').addEventListener('input', applyFilters);
            document.getElementById('filter-amount-min').addEventListener('input', applyFilters);
            document.getElementById('filter-amount-max').addEventListener('input', applyFilters);
            document.getElementById('filter-date-start').addEventListener('change', applyFilters);
            document.getElementById('filter-date-end').addEventListener('change', applyFilters);
            document.getElementById('sort-order').addEventListener('change', applyFilters);
            document.getElementById('reset-filters-btn').addEventListener('click', resetAllFilters);

            // –ö–Ω–æ–ø–∫–∏ –ø–∞–≥–∏–Ω–∞—Ü–∏–∏
            document.getElementById('prev-page-btn').addEventListener('click', prevPage);
            document.getElementById('next-page-btn').addEventListener('click', nextPage);

            // Swipe Logic for Pagination
            const transactionListElement = document.getElementById('transaction-list');
            let touchStartX = 0; let touchStartY = 0; const swipeThreshold = 75; const verticalTolerance = 50;
            transactionListElement.addEventListener('touchstart', (e) => { if (e.touches.length === 1) { touchStartX = e.touches[0].clientX; touchStartY = e.touches[0].clientY; } }, { passive: true });
            transactionListElement.addEventListener('touchend', (e) => {
                if (e.changedTouches.length === 1) {
                    const touchEndX = e.changedTouches[0].clientX; const touchEndY = e.changedTouches[0].clientY;
                    const diffX = touchEndX - touchStartX; const diffY = touchEndY - touchStartY;
                    if (Math.abs(diffX) > swipeThreshold && Math.abs(diffY) < verticalTolerance) { diffX > 0 ? prevPage() : nextPage(); }
                }
            });

            // --- –ù–æ–≤—ã–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è —Ç–∏–ø–æ–≤ –¥–∏–∞–≥—Ä–∞–º–º ---
            document.getElementById('show-pie-chart-btn').addEventListener('click', () => { 
                currentChartType = 'pie'; 
                renderCharts(); 
                showToast('–ü–æ–∫–∞–∑–∞–Ω–∞ –∫—Ä—É–≥–æ–≤–∞—è –¥–∏–∞–≥—Ä–∞–º–º–∞ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º.', 'info');
            });
            document.getElementById('show-monthly-bar-chart-btn').addEventListener('click', () => { 
                currentChartType = 'monthlyBar'; 
                renderCharts(); 
                showToast('–ü–æ–∫–∞–∑–∞–Ω–∞ —Å—Ç–æ–ª–±—á–∞—Ç–∞—è –¥–∏–∞–≥—Ä–∞–º–º–∞ –¥–æ—Ö–æ–¥–æ–≤ –∏ —Ä–∞—Å—Ö–æ–¥–æ–≤ –ø–æ –º–µ—Å—è—Ü–∞–º.', 'info');
            });
            document.getElementById('show-balance-line-chart-btn').addEventListener('click', () => { 
                currentChartType = 'balanceLine'; 
                renderCharts(); 
                showToast('–ü–æ–∫–∞–∑–∞–Ω–∞ –ª–∏–Ω–µ–π–Ω–∞—è –¥–∏–∞–≥—Ä–∞–º–º–∞ –¥–∏–Ω–∞–º–∏–∫–∏ –±–∞–ª–∞–Ω—Å–∞.', 'info');
            });
            document.getElementById('show-cumulative-area-chart-btn').addEventListener('click', () => { 
                currentChartType = 'cumulativeArea'; 
                renderCharts(); 
                showToast('–ü–æ–∫–∞–∑–∞–Ω–∞ –¥–∏–∞–≥—Ä–∞–º–º–∞ –∫—É–º—É–ª—è—Ç–∏–≤–Ω—ã—Ö —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã—Ö –ø–æ—Ç–æ–∫–æ–≤.', 'info');
            });

            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –ø–æ–¥-–ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—è –∫–∞—Ç–µ–≥–æ—Ä–∏–π–Ω–æ–π –¥–∏–∞–≥—Ä–∞–º–º—ã (—Ä–∞—Å—Ö–æ–¥—ã/–¥–æ—Ö–æ–¥—ã)
            document.getElementById('show-category-expense-btn').addEventListener('click', () => {
                if (currentCategoryChartDataType !== 'expense') {
                    currentCategoryChartDataType = 'expense';
                    renderCategoryPieChart('expense');
                    updateChartTypeButtons();
                    showToast('–ü–æ–∫–∞–∑–∞–Ω—ã —Ä–∞—Å—Ö–æ–¥—ã –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º.', 'info');
                    document.getElementById('chart-section-title').textContent = '–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ä–∞—Å—Ö–æ–¥–æ–≤ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º';
                }
            });
            document.getElementById('show-category-income-btn').addEventListener('click', () => {
                if (currentCategoryChartDataType !== 'income') {
                    currentCategoryChartDataType = 'income';
                    renderCategoryPieChart('income');
                    updateChartTypeButtons();
                    showToast('–ü–æ–∫–∞–∑–∞–Ω—ã –¥–æ—Ö–æ–¥—ã –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º.', 'info');
                    document.getElementById('chart-section-title').textContent = '–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –¥–æ—Ö–æ–¥–æ–≤ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º';
                }
            });

            // –ù–∞–≤–∏–≥–∞—Ü–∏—è (–¥–µ—Å–∫—Ç–æ–ø) –∏ hashchange
            document.querySelectorAll('.nav-link').forEach(link => {
                link.addEventListener('click', (e) => {
                    updateNavLinks(e.currentTarget.getAttribute('href'));
                });
            });
            window.addEventListener('hashchange', () => {
                updateNavLinks(window.location.hash || '#dashboard');
            });

            // –õ–æ–≥–∏–∫–∞ —Å–∫—Ä—ã—Ç–∏—è/–ø–æ—è–≤–ª–µ–Ω–∏—è —à–∞–ø–∫–∏ –ø—Ä–∏ –ø—Ä–æ–∫—Ä—É—Ç–∫–µ
            window.addEventListener('scroll', () => {
                const currentScroll = window.pageYOffset || document.documentElement.scrollTop;
                if (mobileHeader && currentScroll > 50) {
                    if (currentScroll > lastScrollTop) { mobileHeader.classList.add('-translate-y-full'); }
                    else { mobileHeader.classList.remove('-translate-y-full'); }
                } else if (mobileHeader) { mobileHeader.classList.remove('-translate-y-full'); }
                lastScrollTop = currentScroll <= 0 ? 0 : currentScroll;
            });
            
            // –ù–û–í–´–ô –û–ë–†–ê–ë–û–¢–ß–ò–ö –î–õ–Ø –ò–ú–ü–û–†–¢–ê
            document.getElementById('import-file').addEventListener('change', importDataHandler);
        };

        // --- –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è ---
        loadData();
        generateRecurringTransactions();
        setupEventListeners();
        renderAll();
        updateBodyScrollAndBlur();

        window.showToast = showToast;
        window.editTransaction = editTransaction; // –î–µ–ª–∞–µ–º –≥–ª–æ–±–∞–ª—å–Ω—ã–º–∏ –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤ onclick
        window.deleteTransaction = deleteTransaction; 
        window.viewTransaction = viewTransaction;
        window.updateCategoryBudget = updateCategoryBudget;
        window.editCategory = editCategory;
        window.deleteCategory = deleteCategory;
        window.exportData = exportData; // –î–µ–ª–∞–µ–º –≥–ª–æ–±–∞–ª—å–Ω–æ–π
        // –ù–û–í–û–ï: –ì–ª–æ–±–∞–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è –¥–æ–ª–≥–æ–≤
        window.addDebt = openDebtModal; // –¢–µ–ø–µ—Ä—å addDebt –≤—ã–∑—ã–≤–∞–µ—Ç openDebtModal
        window.editDebt = editDebt;
        window.deleteDebt = deleteDebt;
        window.copyToClipboard = copyToClipboard; // –î–µ–ª–∞–µ–º –≥–ª–æ–±–∞–ª—å–Ω–æ–π
    });
    </script>
</body>
</html>